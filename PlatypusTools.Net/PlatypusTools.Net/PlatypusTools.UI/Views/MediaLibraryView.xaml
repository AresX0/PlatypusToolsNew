<UserControl x:Class="PlatypusTools.UI.Views.MediaLibraryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignHeight="600" d:DesignWidth="1000">
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Directory Selection -->
        <GroupBox Header="Media Library Directory" Grid.Row="0" Margin="0,0,0,8">
            <StackPanel Orientation="Horizontal" Margin="8">
                <TextBlock VerticalAlignment="Center" Width="100">Directory Path:</TextBlock>
                <TextBox Width="500" Text="{Binding DirectoryPath, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0" />
                <Button Content="Browse..." Command="{Binding BrowseDirectoryCommand}" Width="90" Margin="0,0,8,0" />
                <Button Content="Scan" Command="{Binding ScanCommand}" Width="90" FontWeight="Bold" />
                <Button Content="Cancel" Command="{Binding CancelScanCommand}" Width="70" Margin="4,0,0,0" />
            </StackPanel>
        </GroupBox>

        <!-- Filter and Actions -->
        <GroupBox Header="Filters &amp; Actions" Grid.Row="1" Margin="0,0,0,8">
            <StackPanel Orientation="Horizontal" Margin="8">
                <TextBlock VerticalAlignment="Center" Margin="0,0,8,0">File Type:</TextBlock>
                <ComboBox Width="120" SelectedItem="{Binding SelectedType}" Margin="0,0,16,0">
                    <ComboBoxItem Content="All" IsSelected="True" />
                    <ComboBoxItem Content="Video" />
                    <ComboBoxItem Content="Audio" />
                    <ComboBoxItem Content="Image" />
                </ComboBox>
                <Button Content="Refresh" Command="{Binding RefreshCommand}" Width="90" Margin="0,0,8,0" />
                <TextBlock VerticalAlignment="Center" Margin="16,0,0,0" FontWeight="Bold">
                    Total Files: <Run Text="{Binding TotalFiles, Mode=OneWay}" />
                </TextBlock>
            </StackPanel>
        </GroupBox>

        <!-- Media Files DataGrid -->
        <GroupBox Header="Media Files" Grid.Row="2" Margin="0,0,0,8">
            <DataGrid ItemsSource="{Binding MediaItems}" 
                      AutoGenerateColumns="False"
                      CanUserAddRows="False"
                      CanUserDeleteRows="False"
                      CanUserResizeColumns="True"
                      CanUserReorderColumns="True"
                      CanUserSortColumns="True"
                      IsReadOnly="True"
                      SelectionMode="Single"
                      AlternatingRowBackground="#F5F5F5"
                      GridLinesVisibility="Horizontal"
                      HeadersVisibility="Column"
                      ScrollViewer.HorizontalScrollBarVisibility="Auto"
                      ScrollViewer.VerticalScrollBarVisibility="Auto">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="File Name" Binding="{Binding FileName}" Width="250" MinWidth="150"/>
                    <DataGridTextColumn Header="Type" Binding="{Binding FileType}" Width="60" MinWidth="50"/>
                    <DataGridTextColumn Header="Size (MB)" Binding="{Binding FileSize, Converter={StaticResource BytesToMBConverter}}" Width="90" MinWidth="80"/>
                    <DataGridTextColumn Header="Resolution" Binding="{Binding Resolution}" Width="100" MinWidth="80"/>
                    <DataGridTextColumn Header="Duration" Binding="{Binding Duration}" Width="100" MinWidth="80"/>
                    <DataGridTextColumn Header="Date Modified" Binding="{Binding DateModified, StringFormat='yyyy-MM-dd HH:mm'}" Width="140" MinWidth="120"/>
                    <DataGridTextColumn Header="Full Path" Binding="{Binding FilePath}" Width="*" MinWidth="200"/>
                </DataGrid.Columns>
                <DataGrid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Load Metadata" Command="{Binding LoadMetadataCommand}" CommandParameter="{Binding PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                        <MenuItem Header="Open File Location" />
                        <MenuItem Header="Play" />
                    </ContextMenu>
                </DataGrid.ContextMenu>
            </DataGrid>
        </GroupBox>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" />
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Scanning..." Margin="0,0,8,0" Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}" />
                    <ProgressBar Width="100" Height="16" IsIndeterminate="True" Visibility="{Binding IsScanning, Converter={StaticResource BooleanToVisibilityConverter}}" />
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>
