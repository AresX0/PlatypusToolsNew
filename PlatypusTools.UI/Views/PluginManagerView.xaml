<UserControl x:Class="PlatypusTools.UI.Views.PluginManagerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:PlatypusTools.UI.ViewModels">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto" MinHeight="50"/>
            <RowDefinition Height="5"/>
            <RowDefinition Height="*" MinHeight="100"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,15">
            <TextBlock Text="ðŸ”Œ Plugin Manager" FontSize="24" FontWeight="Bold" Margin="0,0,0,5"/>
            <TextBlock Text="Extend PlatypusTools with custom plugins. Plugins can add new menu items, file processors, and more." 
                       Foreground="Gray" TextWrapping="Wrap"/>
        </StackPanel>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="{DynamicResource CardBackgroundBrush}" Padding="10" Margin="0,0,0,10" CornerRadius="5">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
            <StackPanel Orientation="Horizontal">
                <Button Content="ðŸ”„ Refresh" Command="{Binding RefreshPluginsCommand}" 
                        Padding="10,5" Margin="0,0,5,0" ToolTip="Scan for plugins"/>
                <Button Content="ðŸ“‚ Open Plugins Folder" Command="{Binding OpenPluginsFolderCommand}" 
                        Padding="10,5" Margin="0,0,5,0" ToolTip="Open the plugins directory"/>
                <Button Content="ðŸ“¥ Install Plugin..." Command="{Binding InstallPluginCommand}" 
                        Padding="10,5" Margin="0,0,5,0" Background="#4CAF50" Foreground="White"
                        ToolTip="Install a new plugin from a DLL file"/>
                <Separator Margin="10,0"/>
                <Button Content="âœ“ Enable" Command="{Binding EnablePluginCommand}" 
                        Padding="10,5" Margin="0,0,5,0"
                        ToolTip="Enable selected plugin"/>
                <Button Content="âœ• Disable" Command="{Binding DisablePluginCommand}" 
                        Padding="10,5" Margin="0,0,5,0"
                        ToolTip="Disable selected plugin"/>
                <Button Content="ðŸ—‘ï¸ Uninstall" Command="{Binding UninstallPluginCommand}" 
                        Padding="10,5" Margin="0,0,5,0" Background="#f44336" Foreground="White"
                        ToolTip="Uninstall selected plugin"/>
                <Separator Margin="10,0"/>
                <Button Content="ðŸ”ƒ Reload All" Command="{Binding ReloadPluginsCommand}" 
                        Padding="10,5" ToolTip="Reload all plugins"/>
            </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- GridSplitter -->
        <GridSplitter Grid.Row="2" Height="5" HorizontalAlignment="Stretch" 
                      Background="#CCCCCC" Cursor="SizeNS" ResizeDirection="Rows"/>

        <!-- Plugin List -->
        <GroupBox Grid.Row="3" Header="Installed Plugins" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="300"/>
                </Grid.ColumnDefinitions>

                <!-- Plugins DataGrid -->
                <DataGrid Grid.Column="0" ItemsSource="{Binding Plugins}" SelectedItem="{Binding SelectedPlugin}"
                          AutoGenerateColumns="False" CanUserAddRows="False" IsReadOnly="True"
                          SelectionMode="Single" GridLinesVisibility="Horizontal" Margin="0,0,10,0">
                    <DataGrid.Columns>
                        <DataGridTemplateColumn Header="Enabled" Width="70" MinWidth="50" CanUserResize="True">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <CheckBox IsChecked="{Binding IsEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                              HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="180" MinWidth="100" CanUserResize="True"/>
                        <DataGridTextColumn Header="Version" Binding="{Binding Version}" Width="90" MinWidth="60" CanUserResize="True"/>
                        <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="120" MinWidth="80" CanUserResize="True"/>
                        <DataGridTextColumn Header="Author" Binding="{Binding Author}" Width="140" MinWidth="80" CanUserResize="True"/>
                        <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*" MinWidth="150" CanUserResize="True"/>
                    </DataGrid.Columns>
                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsEnabled}" Value="False">
                                    <Setter Property="Opacity" Value="0.6"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>
                </DataGrid>

                <!-- Plugin Details -->
                <Border Grid.Column="1" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" 
                        Padding="10" CornerRadius="5" Background="{DynamicResource CardBackgroundBrush}">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <TextBlock Text="Plugin Details" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>

                            <TextBlock Text="Name" FontWeight="Bold" Foreground="Gray" FontSize="11"/>
                            <TextBlock Text="{Binding SelectedPlugin.Name, FallbackValue='Select a plugin'}" 
                                       FontSize="14" Margin="0,0,0,10"/>

                            <TextBlock Text="ID" FontWeight="Bold" Foreground="Gray" FontSize="11"/>
                            <TextBlock Text="{Binding SelectedPlugin.Id, FallbackValue='-'}" 
                                       FontSize="12" Margin="0,0,0,10" Foreground="#666"/>

                            <TextBlock Text="Version" FontWeight="Bold" Foreground="Gray" FontSize="11"/>
                            <TextBlock Text="{Binding SelectedPlugin.Version, FallbackValue='-'}" 
                                       FontSize="12" Margin="0,0,0,10"/>

                            <TextBlock Text="Author" FontWeight="Bold" Foreground="Gray" FontSize="11"/>
                            <TextBlock Text="{Binding SelectedPlugin.Author, FallbackValue='-'}" 
                                       FontSize="12" Margin="0,0,0,10"/>

                            <TextBlock Text="Type" FontWeight="Bold" Foreground="Gray" FontSize="11"/>
                            <TextBlock Text="{Binding SelectedPlugin.Type, FallbackValue='-'}" 
                                       FontSize="12" Margin="0,0,0,10"/>

                            <TextBlock Text="Description" FontWeight="Bold" Foreground="Gray" FontSize="11"/>
                            <TextBlock Text="{Binding SelectedPlugin.Description, FallbackValue='-'}" 
                                       FontSize="12" TextWrapping="Wrap" Margin="0,0,0,10"/>

                            <TextBlock Text="Status" FontWeight="Bold" Foreground="Gray" FontSize="11"/>
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                <Ellipse Width="10" Height="10" Margin="0,0,5,0">
                                    <Ellipse.Style>
                                        <Style TargetType="Ellipse">
                                            <Setter Property="Fill" Value="Gray"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding SelectedPlugin.IsEnabled}" Value="True">
                                                    <Setter Property="Fill" Value="#4CAF50"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Ellipse.Style>
                                </Ellipse>
                                <TextBlock FontSize="12">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="Disabled"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding SelectedPlugin.IsEnabled}" Value="True">
                                                    <Setter Property="Text" Value="Enabled"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </Grid>
        </GroupBox>

        <!-- Summary -->
        <Border Grid.Row="4" Background="{DynamicResource CardBackgroundBrush}" Padding="10" CornerRadius="5" Margin="0,0,0,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,30,0">
                    <TextBlock Text="Total Plugins:" FontWeight="Bold" Margin="0,0,5,0"/>
                    <TextBlock Text="{Binding TotalPlugins}" FontSize="16" FontWeight="Bold" Foreground="#2196F3"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="0,0,30,0">
                    <TextBlock Text="Enabled:" FontWeight="Bold" Margin="0,0,5,0"/>
                    <TextBlock Text="{Binding EnabledPlugins}" FontSize="16" FontWeight="Bold" Foreground="#4CAF50"/>
                </StackPanel>

                <TextBlock Grid.Column="2" Text="{Binding PluginsFolder}" Foreground="Gray" FontSize="11" 
                           VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <Border Grid.Row="5" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,1,0,0" Padding="5">
            <TextBlock Text="{Binding Status}" Foreground="Gray"/>
        </Border>
    </Grid>
</UserControl>
