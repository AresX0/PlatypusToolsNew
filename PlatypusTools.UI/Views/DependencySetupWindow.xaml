<Window x:Class="PlatypusTools.UI.Views.DependencySetupWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="PlatypusTools - Dependency Setup" Height="550" Width="650"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource WindowBackgroundBrush}"
        Foreground="{DynamicResource WindowForegroundBrush}">
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="ðŸ”§ Welcome to PlatypusTools!" FontSize="24" FontWeight="Bold" Margin="0,0,0,8"/>
            <TextBlock Text="Some features require external tools to work properly. You can install them now or later from Settings." 
                       TextWrapping="Wrap" Foreground="Gray"/>
        </StackPanel>
        
        <!-- Status Message -->
        <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,16">
            <StackPanel>
                <TextBlock x:Name="StatusMessage" Text="Checking dependencies..." FontSize="14"/>
            </StackPanel>
        </Border>
        
        <!-- Dependencies List -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <StackPanel x:Name="DependenciesPanel">
                <!-- FFmpeg -->
                <Border x:Name="FFmpegCard" Background="{DynamicResource SurfaceBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock x:Name="FFmpegStatus" Text="â³" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="FFmpeg" FontSize="16" FontWeight="SemiBold"/>
                            </StackPanel>
                            <TextBlock Text="Required for: Video editing, conversion, screen recording, audio processing" 
                                       Foreground="Gray" TextWrapping="Wrap" Margin="24,4,0,0"/>
                            <TextBlock x:Name="FFmpegPath" Text="" Foreground="Green" FontSize="11" Margin="24,4,0,0"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <Button x:Name="FFmpegInstallBtn" Content="Install" MinWidth="100" Click="InstallFFmpeg_Click"/>
                            <Button x:Name="FFmpegManualBtn" Content="Manual â†—" MinWidth="100" Margin="0,4,0,0" Click="OpenFFmpegSite_Click"/>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- ExifTool -->
                <Border x:Name="ExifToolCard" Background="{DynamicResource SurfaceBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock x:Name="ExifToolStatus" Text="â³" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="ExifTool" FontSize="16" FontWeight="SemiBold"/>
                            </StackPanel>
                            <TextBlock Text="Required for: Metadata editing, EXIF data reading/writing" 
                                       Foreground="Gray" TextWrapping="Wrap" Margin="24,4,0,0"/>
                            <TextBlock x:Name="ExifToolPath" Text="" Foreground="Green" FontSize="11" Margin="24,4,0,0"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <Button x:Name="ExifToolInstallBtn" Content="Install" MinWidth="100" Click="InstallExifTool_Click"/>
                            <Button x:Name="ExifToolManualBtn" Content="Manual â†—" MinWidth="100" Margin="0,4,0,0" Click="OpenExifToolSite_Click"/>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- WebView2 -->
                <Border x:Name="WebView2Card" Background="{DynamicResource SurfaceBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock x:Name="WebView2Status" Text="â³" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="WebView2 Runtime" FontSize="16" FontWeight="SemiBold"/>
                            </StackPanel>
                            <TextBlock Text="Required for: Help system, simple browser, PDF viewing" 
                                       Foreground="Gray" TextWrapping="Wrap" Margin="24,4,0,0"/>
                            <TextBlock x:Name="WebView2Path" Text="" Foreground="Green" FontSize="11" Margin="24,4,0,0"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <Button x:Name="WebView2InstallBtn" Content="Install" MinWidth="100" Click="InstallWebView2_Click"/>
                            <Button x:Name="WebView2ManualBtn" Content="Manual â†—" MinWidth="100" Margin="0,4,0,0" Click="OpenWebView2Site_Click"/>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Optional Tools Separator -->
                <TextBlock Text="Optional Remote Access Tools" FontSize="14" FontWeight="SemiBold" 
                           Foreground="#FF9C27B0" Margin="0,12,0,8"/>
                
                <!-- Tailscale -->
                <Border x:Name="TailscaleCard" Background="{DynamicResource SurfaceBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock x:Name="TailscaleStatus" Text="â³" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="Tailscale VPN" FontSize="16" FontWeight="SemiBold"/>
                                <TextBlock Text="(Optional)" Foreground="Gray" FontSize="12" VerticalAlignment="Center" Margin="8,0,0,0"/>
                            </StackPanel>
                            <TextBlock Text="Used for: Secure remote access via mesh VPN network" 
                                       Foreground="Gray" TextWrapping="Wrap" Margin="24,4,0,0"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <Button x:Name="TailscaleDownloadBtn" Content="Download â†—" MinWidth="100" Click="OpenTailscaleSite_Click"/>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- cloudflared -->
                <Border x:Name="CloudflaredCard" Background="{DynamicResource SurfaceBrush}" CornerRadius="8" Padding="16" Margin="0,0,0,12">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock x:Name="CloudflaredStatus" Text="â³" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                <TextBlock Text="cloudflared" FontSize="16" FontWeight="SemiBold"/>
                                <TextBlock Text="(Optional)" Foreground="Gray" FontSize="12" VerticalAlignment="Center" Margin="8,0,0,0"/>
                            </StackPanel>
                            <TextBlock Text="Used for: Cloudflare Tunnel secure external access without port forwarding" 
                                       Foreground="Gray" TextWrapping="Wrap" Margin="24,4,0,0"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" VerticalAlignment="Center">
                            <Button x:Name="CloudflaredInstallBtn" Content="Install" MinWidth="100" Click="InstallCloudflared_Click"/>
                            <Button x:Name="CloudflaredManualBtn" Content="Manual â†—" MinWidth="100" Margin="0,4,0,0" Click="OpenCloudflaredSite_Click"/>
                        </StackPanel>
                    </Grid>
                </Border>
                
                <!-- Manual Install Info -->
                <Border Background="#2D2D30" CornerRadius="8" Padding="16" Margin="0,8,0,0">
                    <StackPanel>
                        <TextBlock Text="ðŸ“ Manual Installation Locations" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <TextBlock TextWrapping="Wrap" Foreground="Gray">
                            <Run Text="If automatic installation fails, download the tools manually and place them in:"/>
                        </TextBlock>
                        <TextBlock x:Name="ToolsPathText" Text="" FontFamily="Consolas" Foreground="#569CD6" Margin="0,8,0,0"/>
                        <TextBlock TextWrapping="Wrap" Foreground="Gray" Margin="0,8,0,0">
                            <Run Text="â€¢ FFmpeg: Place ffmpeg.exe in the Tools folder or add to system PATH"/>
                            <LineBreak/>
                            <Run Text="â€¢ ExifTool: Place exiftool.exe in Tools\exiftool_files\ folder"/>
                            <LineBreak/>
                            <Run Text="â€¢ WebView2: Run the installer from Microsoft"/>
                            <LineBreak/>
                            <Run Text="â€¢ Tailscale: Download and install from tailscale.com"/>
                            <LineBreak/>
                            <Run Text="â€¢ cloudflared: Click Install or download from GitHub releases"/>
                        </TextBlock>
                        <Button Content="Open Tools Folder" MinWidth="120" HorizontalAlignment="Left" Margin="0,12,0,0" Click="OpenToolsFolder_Click"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
        
        <!-- Options -->
        <StackPanel Grid.Row="3" Margin="0,16,0,0">
            <CheckBox x:Name="DontShowAgainCheck" Content="Don't show this again on startup" Margin="0,0,0,8"/>
        </StackPanel>
        
        <!-- Buttons -->
        <WrapPanel Grid.Row="4" HorizontalAlignment="Right" Margin="0,16,0,0">
            <Button Content="Refresh Status" MinWidth="100" Margin="0,0,8,4" Click="RefreshStatus_Click"/>
            <Button Content="Continue" MinWidth="90" Margin="0,0,0,4" Click="Continue_Click" IsDefault="True" 
                    Background="#FF4CAF50" Foreground="White"/>
        </WrapPanel>
    </Grid>
</Window>
