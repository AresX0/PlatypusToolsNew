<Window x:Class="PlatypusTools.UI.Views.TransitionPickerWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Transition Picker" Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        Icon="pack://application:,,,/Assets/platypus.png">
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Window.Resources>
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Select Transition" FontSize="20" FontWeight="Bold"/>
            <TextBlock Text="Choose a transition effect to apply between clips" Foreground="Gray"/>
        </StackPanel>
        
        <!-- Categories and Transitions -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="180"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="280"/>
            </Grid.ColumnDefinitions>
            
            <!-- Categories List -->
            <Border Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="1" CornerRadius="4" Background="#F8F8F8" Margin="0,0,8,0">
                <StackPanel Margin="8">
                    <TextBlock Text="Categories" FontWeight="SemiBold" Margin="0,0,0,8"/>
                    <ListBox x:Name="CategoryList" ItemsSource="{Binding Categories}" 
                             SelectedItem="{Binding SelectedCategory}"
                             BorderThickness="0" Background="Transparent">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="4">
                                    <TextBlock Text="{Binding Icon}" FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding Name}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </StackPanel>
            </Border>
            
            <!-- Transitions Grid -->
            <Border Grid.Column="1" BorderBrush="#CCCCCC" BorderThickness="1" CornerRadius="4" Margin="8,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="8">
                    <ItemsControl ItemsSource="{Binding FilteredTransitions}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{Binding BorderBrush}" 
                                        BorderThickness="2" 
                                        CornerRadius="4" 
                                        Margin="4" 
                                        Padding="8"
                                        Width="110"
                                        Background="{Binding Background}"
                                        Cursor="Hand"
                                        MouseLeftButtonDown="Transition_Click">
                                    <StackPanel HorizontalAlignment="Center">
                                        <Border Width="80" Height="60" Background="#333" CornerRadius="4" Margin="0,0,0,8">
                                            <TextBlock Text="{Binding Icon}" FontSize="28" 
                                                       HorizontalAlignment="Center" VerticalAlignment="Center"
                                                       Foreground="White"/>
                                        </Border>
                                        <TextBlock Text="{Binding Name}" 
                                                   TextAlignment="Center" 
                                                   FontSize="11"
                                                   TextWrapping="Wrap"
                                                   Height="32"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </Border>
            
            <!-- Preview and Settings -->
            <Border Grid.Column="2" BorderBrush="#CCCCCC" BorderThickness="1" CornerRadius="4" Background="#F8F8F8" Margin="8,0,0,0">
                <StackPanel Margin="12">
                    <TextBlock Text="Preview" FontWeight="SemiBold" Margin="0,0,0,8"/>
                    
                    <!-- Animated Preview Box -->
                    <Border Width="200" Height="120" Background="#222" CornerRadius="4" Margin="0,0,0,8" ClipToBounds="True">
                        <Grid x:Name="PreviewContainer">
                            <!-- "Before" image placeholder (left half) -->
                            <Border x:Name="PreviewBefore" Background="#4A90D9" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                                <TextBlock Text="A" FontSize="48" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <!-- "After" image placeholder (right half - animates in) -->
                            <Border x:Name="PreviewAfter" Background="#D94A4A" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Opacity="0">
                                <Border.RenderTransform>
                                    <TransformGroup>
                                        <ScaleTransform x:Name="AfterScaleTransform" ScaleX="1" ScaleY="1" CenterX="100" CenterY="60"/>
                                        <TranslateTransform x:Name="AfterTranslateTransform" X="0" Y="0"/>
                                    </TransformGroup>
                                </Border.RenderTransform>
                                <TextBlock Text="B" FontSize="48" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <!-- Transition icon overlay -->
                            <TextBlock Text="{Binding SelectedTransition.Icon}" 
                                       FontSize="28" Opacity="0.4"
                                       HorizontalAlignment="Center" 
                                       VerticalAlignment="Center"
                                       Foreground="White"/>
                        </Grid>
                    </Border>
                    
                    <!-- Play Preview Button -->
                    <Button x:Name="PlayPreviewBtn" Content="â–¶ Play Preview" Width="120" Height="28"
                            HorizontalAlignment="Center" Margin="0,0,0,16"
                            Click="PlayPreview_Click"
                            IsEnabled="{Binding HasSelection}"/>
                    
                    <TextBlock Text="Settings" FontWeight="SemiBold" Margin="0,0,0,8"/>
                    
                    <!-- Duration -->
                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Duration" FontSize="12"/>
                        <Grid Margin="0,4,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <Slider x:Name="DurationSlider" 
                                    Grid.Column="0"
                                    Minimum="0.1" Maximum="3.0" 
                                    Value="{Binding Duration}" 
                                    TickFrequency="0.1" 
                                    IsSnapToTickEnabled="True"/>
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding Duration, StringFormat={}{0:F1}s}" 
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Right"/>
                        </Grid>
                    </StackPanel>
                    
                    <!-- Easing -->
                    <StackPanel Margin="0,0,0,12">
                        <TextBlock Text="Easing" FontSize="12"/>
                        <ComboBox ItemsSource="{Binding EasingOptions}" 
                                  SelectedItem="{Binding SelectedEasing}"
                                  Margin="0,4,0,0"/>
                    </StackPanel>
                    
                    <!-- Selected Transition Info -->
                    <Border Background="{DynamicResource ControlBackgroundBrush}" CornerRadius="4" Padding="8" Margin="0,8,0,0"
                            Visibility="{Binding HasSelection, Converter={StaticResource BoolToVis}}">
                        <StackPanel>
                            <TextBlock Text="{Binding SelectedTransition.Name}" FontWeight="Bold"/>
                            <TextBlock Text="{Binding SelectedTransition.CategoryName}" 
                                       Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>
        
        <!-- Search and Filter -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,16,0,0">
            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,8,0"/>
            <TextBox x:Name="SearchBox" Width="200" 
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     Padding="8,4"/>
        </StackPanel>
        
        <!-- Buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,16,0,0">
            <Button Content="Apply" Width="100" Height="36" 
                    Click="Apply_Click" 
                    IsEnabled="{Binding HasSelection}"
                    Background="#2563EB" Foreground="White" FontWeight="SemiBold"/>
            <Button Content="Cancel" Width="100" Height="36" 
                    Click="Cancel_Click"
                    Margin="8,0,0,0"/>
        </StackPanel>
    </Grid>
</Window>
