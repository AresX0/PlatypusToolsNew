<UserControl x:Class="PlatypusTools.UI.Views.BootableUSBView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:PlatypusTools.UI.Views"
             xmlns:vm="clr-namespace:PlatypusTools.UI.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900"
             d:DataContext="{d:DesignInstance Type=vm:BootableUSBViewModel}">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Elevation Warning -->
        <Border Grid.Row="0" Background="#FFF4E5" BorderBrush="#FF9800" BorderThickness="1" 
                CornerRadius="5" Padding="15" Margin="0,0,0,20"
                Visibility="{Binding IsElevated, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
            <StackPanel>
                <TextBlock FontWeight="Bold" FontSize="14" Foreground="#E65100" Margin="0,0,0,5">
                    ‚ö†Ô∏è Administrator Privileges Required
                </TextBlock>
                <TextBlock TextWrapping="Wrap" Foreground="#E65100">
                    Creating bootable USB drives requires administrator privileges to format drives and install bootloaders.
                </TextBlock>
                <Button Command="{Binding RequestElevationCommand}" 
                        Content="Request Elevation" 
                        HorizontalAlignment="Left"
                        Margin="0,10,0,0"
                        Padding="15,5"/>
            </StackPanel>
        </Border>

        <!-- ISO Selection -->
        <GroupBox Grid.Row="1" Header="ISO Image" Margin="0,0,0,15">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0" Text="{Binding ISOPath, UpdateSourceTrigger=PropertyChanged}"
                         IsReadOnly="True" Margin="0,0,10,0" Padding="8"/>
                <Button Grid.Column="1" Command="{Binding BrowseISOCommand}" 
                        Content="Browse..." Padding="20,5"/>
            </Grid>
        </GroupBox>

        <!-- USB Drive Selection -->
        <GroupBox Grid.Row="2" Header="USB Drive" Margin="0,0,0,15">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <ComboBox Grid.Column="0" 
                          ItemsSource="{Binding USBDrives}"
                          SelectedItem="{Binding SelectedDrive}"
                          Margin="0,0,10,0"
                          Padding="8">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Caption}" FontWeight="Bold" Margin="0,0,10,0"/>
                                <TextBlock Text="{Binding DriveLetter}" Margin="0,0,10,0"/>
                                <TextBlock Text="{Binding SizeFormatted}" Foreground="Gray"/>
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                <Button Grid.Column="1" Command="{Binding RefreshUSBCommand}"
                        Content="üîÑ Refresh" Padding="15,5"/>
            </Grid>
        </GroupBox>

        <!-- Format Options -->
        <GroupBox Grid.Row="3" Header="Format Options" Margin="0,0,0,15">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="120"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- File System -->
                <TextBlock Grid.Row="0" Grid.Column="0" Text="File System:" 
                           VerticalAlignment="Center" Margin="0,0,0,10"/>
                <ComboBox Grid.Row="0" Grid.Column="1" 
                          SelectedItem="{Binding FileSystem}"
                          Margin="0,0,0,10" Padding="8">
                    <ComboBoxItem Content="NTFS" IsSelected="True"/>
                    <ComboBoxItem Content="FAT32"/>
                    <ComboBoxItem Content="exFAT"/>
                </ComboBox>

                <!-- Volume Label -->
                <TextBlock Grid.Row="1" Grid.Column="0" Text="Volume Label:" 
                           VerticalAlignment="Center" Margin="0,0,0,10"/>
                <TextBox Grid.Row="1" Grid.Column="1" 
                         Text="{Binding VolumeLabel, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,0,0,10" Padding="8" MaxLength="32"/>

                <!-- Boot Mode -->
                <TextBlock Grid.Row="2" Grid.Column="0" Text="Boot Mode:" 
                           VerticalAlignment="Center" Margin="0,0,0,10"/>
                <ComboBox Grid.Row="2" Grid.Column="1" 
                          SelectedItem="{Binding BootMode}"
                          Margin="0,0,0,10" Padding="8">
                    <ComboBoxItem Content="UEFI (GPT)" IsSelected="True" Tag="UEFI_GPT"/>
                    <ComboBoxItem Content="UEFI + Legacy" Tag="UEFI_Legacy"/>
                    <ComboBoxItem Content="Legacy (MBR)" Tag="Legacy_MBR"/>
                </ComboBox>

                <!-- Options -->
                <StackPanel Grid.Row="3" Grid.Column="1" Orientation="Vertical">
                    <CheckBox IsChecked="{Binding QuickFormat}" 
                              Content="Quick Format (Recommended)" 
                              Margin="0,0,0,5"/>
                    <CheckBox IsChecked="{Binding VerifyAfterWrite}" 
                              Content="Verify after write (Slower but safer)"/>
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- Progress -->
        <GroupBox Grid.Row="4" Header="Progress" Margin="0,0,0,15">
            <StackPanel Margin="10">
                <TextBlock Text="{Binding CurrentStage}" FontWeight="Bold" 
                           Margin="0,0,0,5"
                           Visibility="{Binding IsProcessing, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                <ProgressBar Height="25" Value="{Binding Progress}" Maximum="100"
                             Margin="0,0,0,10"/>
                <TextBlock Text="{Binding StatusMessage}" TextWrapping="Wrap"/>
            </StackPanel>
        </GroupBox>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="5" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Command="{Binding FormatDriveCommand}" 
                    Content="Format Drive Only" 
                    Padding="20,10" Margin="0,0,10,0"
                    Background="#FF9800" Foreground="White" BorderThickness="0"/>
            <Button Command="{Binding CreateBootableUSBCommand}" 
                    Content="Create Bootable USB" 
                    Padding="20,10" Margin="0,0,10,0"
                    Background="#4CAF50" Foreground="White" BorderThickness="0"/>
            <Button Command="{Binding CancelCommand}" 
                    Content="Cancel" 
                    Padding="20,10"
                    Background="#F44336" Foreground="White" BorderThickness="0"/>
        </StackPanel>

        <!-- Instructions -->
        <GroupBox Grid.Row="6" Header="Instructions" Margin="0,20,0,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="10">
                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,10">
                        <Bold>How to create a bootable USB drive:</Bold>
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                        1. <Bold>Select an ISO file:</Bold> Click "Browse..." to select a bootable ISO image (Windows, Linux, etc.)
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                        2. <Bold>Select USB drive:</Bold> Choose the target USB drive. Click "Refresh" to detect newly connected drives.
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                        3. <Bold>Configure options:</Bold>
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="20,0,0,5">
                        ‚Ä¢ <Bold>File System:</Bold> NTFS for Windows, FAT32 for legacy systems, exFAT for large files
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="20,0,0,5">
                        ‚Ä¢ <Bold>Boot Mode:</Bold> UEFI (GPT) for modern systems, Legacy (MBR) for older computers
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="20,0,0,10">
                        ‚Ä¢ <Bold>Quick Format:</Bold> Faster but less thorough. Uncheck for problem drives.
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="0,0,0,5">
                        4. <Bold>Create:</Bold> Click "Create Bootable USB" and confirm the warning.
                    </TextBlock>
                    <TextBlock TextWrapping="Wrap" Margin="0,10,0,0" Foreground="#F44336">
                        <Bold>‚ö†Ô∏è WARNING:</Bold> All data on the selected USB drive will be permanently erased!
                    </TextBlock>
                </StackPanel>
            </ScrollViewer>
        </GroupBox>
    </Grid>
</UserControl>
