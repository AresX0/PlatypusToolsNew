<Window x:Class="PlatypusTools.UI.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Settings" Height="600" Width="800"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource WindowBackgroundBrush}"
        Foreground="{DynamicResource WindowForegroundBrush}">
    
    <Grid Background="{DynamicResource WindowBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="{DynamicResource PrimaryBrush}" Padding="20">
            <TextBlock Text="âš™ Settings" FontSize="24" FontWeight="Bold" Foreground="{DynamicResource WindowForegroundBrush}"/>
        </Border>
        
        <!-- Content -->
        <Grid Grid.Row="1" Margin="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Navigation -->
            <ListBox x:Name="NavList" Grid.Column="0" 
                     AutomationProperties.Name="Settings Navigation"
                     Background="{DynamicResource SurfaceBrush}"
                     BorderThickness="0"
                     SelectionChanged="NavList_SelectionChanged">
                <ListBoxItem Tag="General" IsSelected="True">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âš™" Width="24"/>
                        <TextBlock Text="General"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="Appearance">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸŽ¨" Width="24"/>
                        <TextBlock Text="Appearance"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="Keyboard">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="âŒ¨" Width="24"/>
                        <TextBlock Text="Keyboard Shortcuts"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="AI">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ¤–" Width="24"/>
                        <TextBlock Text="AI Features"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="Visualizer">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸŽ¨" Width="24"/>
                        <TextBlock Text="Audio Visualizer"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="LastFm">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸŽµ" Width="24"/>
                        <TextBlock Text="Last.fm"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="Metadata">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸŽ¬" Width="24"/>
                        <TextBlock Text="Metadata / TMDb"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="RemoteControl">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“±" Width="24"/>
                        <TextBlock Text="Remote Control"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="Updates">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ”„" Width="24"/>
                        <TextBlock Text="Updates"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="Backup">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ’¾" Width="24"/>
                        <TextBlock Text="Backup &amp; Restore"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="TabVisibility">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“‘" Width="24"/>
                        <TextBlock Text="Tab Visibility"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="Dependencies">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ“¦" Width="24"/>
                        <TextBlock Text="Dependencies"/>
                    </StackPanel>
                </ListBoxItem>
                <ListBoxItem Tag="Advanced">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="ðŸ”§" Width="24"/>
                        <TextBlock Text="Advanced"/>
                    </StackPanel>
                </ListBoxItem>
            </ListBox>
            
            <!-- Settings Panels -->
            <ScrollViewer Grid.Column="1" Padding="20">
                <Grid>
                    <!-- General Settings -->
                    <StackPanel x:Name="GeneralPanel">
                        <TextBlock Text="General Settings" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        
                        <GroupBox Header="Startup" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="StartWithWindowsCheck" Content="Start with Windows" Margin="0,4"/>
                                <CheckBox x:Name="StartMinimizedCheck" Content="Start minimized" Margin="0,4"/>
                                <CheckBox x:Name="RestoreLastSessionCheck" Content="Restore last session" Margin="0,4"/>
                                <CheckBox x:Name="RequireAdminRightsCheck" Content="Launch with administrator rights" IsChecked="True" Margin="0,4"
                                          ToolTip="When enabled, the application will request administrator privileges on startup. Change takes effect after restart."/>
                                <TextBlock Text="â†³ Restart required for admin rights change to take effect" 
                                           FontSize="11" Foreground="{DynamicResource ForegroundDimBrush}" Margin="20,2,0,0"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="File Operations" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="ConfirmDeleteCheck" Content="Confirm before deleting files" IsChecked="True" Margin="0,4"/>
                                <CheckBox x:Name="UseRecycleBinCheck" Content="Move deleted files to Recycle Bin" IsChecked="True" Margin="0,4"/>
                                <CheckBox x:Name="ShowPreviewCheck" Content="Show preview before applying changes" IsChecked="True" Margin="0,4"/>
                                
                                <Grid Margin="0,8,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Undo history limit:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="UndoLimitText" Grid.Column="1" Text="100" Margin="8,0,0,0"
                                             AutomationProperties.Name="Undo History Limit"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Language" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <TextBlock Text="Application language:" Margin="0,0,0,4"/>
                                <ComboBox x:Name="LanguageCombo" Width="200" HorizontalAlignment="Left"
                                          AutomationProperties.Name="Application Language">
                                    <ComboBoxItem Content="English (US)" Tag="en-US"/>
                                    <ComboBoxItem Content="English (UK)" Tag="en-GB"/>
                                    <ComboBoxItem Content="EspaÃ±ol" Tag="es-ES"/>
                                    <ComboBoxItem Content="FranÃ§ais" Tag="fr-FR"/>
                                    <ComboBoxItem Content="Deutsch" Tag="de-DE"/>
                                    <ComboBoxItem Content="Italiano" Tag="it-IT"/>
                                    <ComboBoxItem Content="PortuguÃªs (BR)" Tag="pt-BR"/>
                                    <ComboBoxItem Content="æ—¥æœ¬èªž" Tag="ja-JP"/>
                                    <ComboBoxItem Content="í•œêµ­ì–´" Tag="ko-KR"/>
                                    <ComboBoxItem Content="ä¸­æ–‡ (ç®€ä½“)" Tag="zh-CN"/>
                                    <ComboBoxItem Content="ä¸­æ–‡ (ç¹é«”)" Tag="zh-TW"/>
                                    <ComboBoxItem Content="Ð ÑƒÑÑÐºÐ¸Ð¹" Tag="ru-RU"/>
                                    <ComboBoxItem Content="Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©" Tag="ar-SA"/>
                                    <ComboBoxItem Content="à¤¹à¤¿à¤¨à¥à¤¦à¥€" Tag="hi-IN"/>
                                    <ComboBoxItem Content="Nederlands" Tag="nl-NL"/>
                                    <ComboBoxItem Content="Polski" Tag="pl-PL"/>
                                    <ComboBoxItem Content="TÃ¼rkÃ§e" Tag="tr-TR"/>
                                    <ComboBoxItem Content="Tiáº¿ng Viá»‡t" Tag="vi-VN"/>
                                    <ComboBoxItem Content="à¹„à¸—à¸¢" Tag="th-TH"/>
                                    <ComboBoxItem Content="Svenska" Tag="sv-SE"/>
                                </ComboBox>
                                <TextBlock Text="â†³ Restart may be required for full language change" 
                                           FontSize="11" Foreground="{DynamicResource ForegroundDimBrush}" Margin="0,4,0,0"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Logging">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="EnableLoggingCheck" Content="Enable application logging" IsChecked="True" Margin="0,4"/>
                                <Grid Margin="0,8,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Log level:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="LogLevelCombo" Grid.Column="1" Margin="8,0,0,0" Width="150" HorizontalAlignment="Left"
                                              AutomationProperties.Name="Log Level">
                                        <ComboBoxItem Content="Debug"/>
                                        <ComboBoxItem Content="Info" IsSelected="True"/>
                                        <ComboBoxItem Content="Warning"/>
                                        <ComboBoxItem Content="Error"/>
                                    </ComboBox>
                                </Grid>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                    
                    <!-- Appearance Settings -->
                    <StackPanel x:Name="AppearancePanel" Visibility="Collapsed">
                        <TextBlock Text="Appearance" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        
                        <GroupBox Header="Theme" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <RadioButton x:Name="LightThemeRadio" Content="Light" GroupName="Theme" IsChecked="True" Margin="0,4"/>
                                <RadioButton x:Name="DarkThemeRadio" Content="Dark" GroupName="Theme" Margin="0,4"/>
                                <RadioButton x:Name="GlassThemeRadio" Content="Aero Glass (Windows 10/11)" GroupName="Theme" Margin="0,4"
                                             Checked="ThemeRadio_Changed" Unchecked="ThemeRadio_Changed"/>
                                <RadioButton x:Name="LCARSThemeRadio" Content="LCARS (Star Trek)" GroupName="Theme" Margin="0,4"/>
                                <RadioButton x:Name="KlingonThemeRadio" Content="Klingon (tlhIngan)" GroupName="Theme" Margin="0,4"/>
                                <RadioButton x:Name="PipBoyThemeRadio" Content="Pip-Boy (Fallout)" GroupName="Theme" Margin="0,4"/>
                                <RadioButton x:Name="KPopDemonHuntersThemeRadio" Content="K-Pop Demon Hunters" GroupName="Theme" Margin="0,4"/>
                                <RadioButton x:Name="HighContrastThemeRadio" Content="High Contrast (Accessibility)" GroupName="Theme" Margin="0,4"/>
                                <RadioButton x:Name="SystemThemeRadio" Content="Use system setting" GroupName="Theme" Margin="0,4"/>
                                <Button Content="Customize Theme..." MinWidth="190" HorizontalAlignment="Left" Margin="0,12,0,0" Click="CustomizeTheme_Click"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Glass Intensity" Margin="0,0,0,16" x:Name="GlassIntensityGroup" IsEnabled="False">
                            <StackPanel Margin="8">
                                <StackPanel Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="Glass Intensity:" VerticalAlignment="Center" Width="100"/>
                                    <ComboBox x:Name="GlassLevelCombo" Width="150" SelectionChanged="GlassLevelCombo_SelectionChanged"
                                              AutomationProperties.Name="Glass Intensity Level">
                                        <ComboBoxItem Content="Subtle" Tag="Low"/>
                                        <ComboBoxItem Content="Medium" Tag="Medium" IsSelected="True"/>
                                        <ComboBoxItem Content="Strong" Tag="High"/>
                                        <ComboBoxItem Content="Auto (System)" Tag="Auto"/>
                                    </ComboBox>
                                </StackPanel>
                                <TextBlock Text="Note: Glass effects require Windows 10 version 1803 or later" 
                                           FontSize="11" Foreground="{DynamicResource ForegroundDimBrush}" Margin="0,4,0,0"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Display" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="ShowStatusBarCheck" Content="Show status bar" IsChecked="True" Margin="0,4"/>
                                <CheckBox x:Name="ShowToolbarCheck" Content="Show toolbar" IsChecked="True" Margin="0,4"/>
                                <CheckBox x:Name="AnimationsCheck" Content="Enable animations" IsChecked="True" Margin="0,4"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Font Settings" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <TextBlock Text="Custom font overrides the theme default. Fonts must be installed on your system." 
                                           TextWrapping="Wrap" FontSize="11" Foreground="{DynamicResource ForegroundDimBrush}" Margin="0,0,0,8"/>
                                <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                    <TextBlock Text="Font Family:" VerticalAlignment="Center" Width="100"/>
                                    <ComboBox x:Name="FontFamilyCombo" Width="200" SelectionChanged="FontFamilyCombo_SelectionChanged"
                                              AutomationProperties.Name="Font Family">
                                        <ComboBoxItem Content="Default (Theme)" Tag="Default" IsSelected="True"/>
                                        <ComboBoxItem Content="Segoe UI" Tag="Segoe UI"/>
                                        <ComboBoxItem Content="Consolas" Tag="Consolas"/>
                                        <ComboBoxItem Content="Arial" Tag="Arial"/>
                                        <ComboBoxItem Content="Klingon Font" Tag="klingon font"/>
                                        <ComboBoxItem Content="Okuda (LCARS)" Tag="Okuda"/>
                                        <ComboBoxItem Content="Monofonto (Pip-Boy)" Tag="Monofonto"/>
                                        <ComboBoxItem Content="Overseer" Tag="Overseer"/>
                                    </ComboBox>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                    <TextBlock Text="Font Scale:" VerticalAlignment="Center" Width="100"/>
                                    <Slider x:Name="FontScaleSlider" Minimum="0.5" Maximum="2.0" Value="1.0" Width="150" 
                                            AutomationProperties.Name="Font Scale"
                                            TickFrequency="0.1" IsSnapToTickEnabled="True" 
                                            ValueChanged="FontScaleSlider_ValueChanged"/>
                                    <TextBlock x:Name="FontScaleLabel" Text="100%" Width="50" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                </StackPanel>
                                <TextBlock Text="Scale affects all text proportionally. 100% = default theme sizes." 
                                           FontSize="11" Foreground="{DynamicResource ForegroundDimBrush}" Margin="0,8,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                    
                    <!-- Keyboard Shortcuts -->
                    <StackPanel x:Name="KeyboardPanel" Visibility="Collapsed">
                        <TextBlock Text="Keyboard Shortcuts" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        
                        <TextBlock Text="Double-click a shortcut cell to reassign. Press the new key combination, then press Enter to confirm or Escape to cancel."
                                   FontSize="11" Foreground="{DynamicResource ForegroundDimBrush}" Margin="0,0,0,8" TextWrapping="Wrap"/>
                        
                        <!-- Search/Filter -->
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="200"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="150"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox x:Name="ShortcutSearchBox" Grid.Column="1" 
                                     TextChanged="ShortcutSearch_TextChanged"
                                     AutomationProperties.Name="Search Shortcuts"/>
                            <TextBlock Text="Category:" Grid.Column="2" VerticalAlignment="Center" Margin="16,0,8,0"/>
                            <ComboBox x:Name="ShortcutCategoryFilter" Grid.Column="3" 
                                      SelectionChanged="ShortcutCategoryFilter_Changed"
                                      AutomationProperties.Name="Filter by Category">
                                <ComboBoxItem Content="All" IsSelected="True"/>
                                <ComboBoxItem Content="File"/>
                                <ComboBoxItem Content="Edit"/>
                                <ComboBoxItem Content="View"/>
                                <ComboBoxItem Content="Tools"/>
                                <ComboBoxItem Content="Audio"/>
                                <ComboBoxItem Content="Help"/>
                            </ComboBox>
                        </Grid>
                        
                        <DataGrid x:Name="ShortcutsGrid" AutoGenerateColumns="False" 
                                  CanUserAddRows="False" CanUserDeleteRows="False"
                                  CanUserResizeColumns="True" CanUserSortColumns="True"
                                  IsReadOnly="True"
                                  SelectionMode="Single" SelectionUnit="FullRow"
                                  Height="350" 
                                  MouseDoubleClick="ShortcutsGrid_MouseDoubleClick"
                                  PreviewKeyDown="ShortcutsGrid_PreviewKeyDown">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Category" Binding="{Binding Category}" Width="80"/>
                                <DataGridTextColumn Header="Command" Binding="{Binding Name}" Width="200" CanUserResize="True" MinWidth="100"/>
                                <DataGridTextColumn Header="Shortcut" Binding="{Binding Shortcut}" Width="150" CanUserResize="True" MinWidth="80"/>
                                <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*" CanUserResize="True" MinWidth="100"/>
                            </DataGrid.Columns>
                        </DataGrid>
                        
                        <TextBlock Text="Double-click a command to assign a new shortcut, then press the key combination."
                                   FontSize="10" Foreground="{DynamicResource ForegroundDimBrush}" Margin="0,4,0,0"/>
                        <TextBlock x:Name="ShortcutConflictText" Text="" Foreground="{DynamicResource ErrorForegroundBrush}" 
                                   FontSize="11" Margin="0,4,0,0"/>
                        
                        <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                            <Button Content="Reset to Defaults" Margin="0,0,8,0" Click="ResetShortcuts_Click"
                                    Background="#FFF44336" Foreground="White" Padding="12,6"/>
                            <Button Content="Import..." Margin="0,0,8,0" Click="ImportShortcuts_Click" Padding="12,6"/>
                            <Button Content="Export..." Click="ExportShortcuts_Click" Padding="12,6"/>
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- AI Settings -->
                    <StackPanel x:Name="AIPanel" Visibility="Collapsed">
                        <TextBlock Text="AI Features" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        
                        <GroupBox Header="API Configuration" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Provider:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="AIProviderCombo" Grid.Column="1" Width="200" HorizontalAlignment="Left"
                                              AutomationProperties.Name="AI Provider">
                                        <ComboBoxItem Content="OpenAI" IsSelected="True"/>
                                        <ComboBoxItem Content="Azure OpenAI"/>
                                        <ComboBoxItem Content="Anthropic"/>
                                    </ComboBox>
                                </Grid>
                                
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="API Key:" VerticalAlignment="Center"/>
                                    <PasswordBox x:Name="AIApiKeyBox" Grid.Column="1" MaxWidth="400" HorizontalAlignment="Left"
                                                 AutomationProperties.Name="AI API Key"/>
                                </Grid>
                                
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Model:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="AIModelCombo" Grid.Column="1" Width="200" HorizontalAlignment="Left"
                                              AutomationProperties.Name="AI Model">
                                        <ComboBoxItem Content="gpt-4" IsSelected="True"/>
                                        <ComboBoxItem Content="gpt-4-turbo"/>
                                        <ComboBoxItem Content="gpt-3.5-turbo"/>
                                    </ComboBox>
                                </Grid>
                                
                                <Button Content="Test Connection" MinWidth="180" HorizontalAlignment="Left" Margin="0,12,0,0" Click="TestAI_Click"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Features">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="AISmartRenameCheck" Content="Enable AI-powered smart rename suggestions" IsChecked="True" Margin="0,4"/>
                                <CheckBox x:Name="AITaggingCheck" Content="Enable AI-powered auto-tagging" IsChecked="True" Margin="0,4"/>
                                <CheckBox x:Name="AIOrganizeCheck" Content="Enable AI-powered file organization" IsChecked="True" Margin="0,4"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                    
                    <!-- Updates Settings -->
                    <StackPanel x:Name="UpdatesPanel" Visibility="Collapsed">
                        <TextBlock Text="Updates" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        
                        <GroupBox Header="Auto Updates" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="AutoCheckUpdatesCheck" Content="Check for updates automatically" IsChecked="True" Margin="0,4"/>
                                <CheckBox x:Name="AutoDownloadUpdatesCheck" Content="Download updates automatically" Margin="0,4"/>
                                <CheckBox x:Name="NotifyUpdatesCheck" Content="Show notification when update is available" IsChecked="True" Margin="0,4"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Current Version">
                            <StackPanel Margin="8">
                                <TextBlock x:Name="CurrentVersionText" Text="Version: 4.0.0.7"/>
                                <TextBlock x:Name="LastCheckText" Text="Last checked: Never" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,4,0,0"/>
                                <Button Content="Check for Updates Now" MinWidth="180" HorizontalAlignment="Left" Margin="0,12,0,0" Click="CheckUpdates_Click"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                    
                    <!-- Backup Settings -->
                    <StackPanel x:Name="BackupPanel" Visibility="Collapsed">
                        <TextBlock Text="Backup &amp; Restore" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        
                        <GroupBox Header="Backup Settings" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <Button Content="Create Backup..." MinWidth="190" HorizontalAlignment="Left" Margin="0,4" Click="CreateBackup_Click"/>
                                <Button Content="Restore from Backup..." MinWidth="190" HorizontalAlignment="Left" Margin="0,4" Click="RestoreBackup_Click"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Auto Backup">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="AutoBackupCheck" Content="Create automatic backups" Margin="0,4"/>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Backup interval (days):" VerticalAlignment="Center"/>
                                    <TextBox x:Name="BackupIntervalText" Grid.Column="1" Text="7" Margin="8,0,0,0"
                                             AutomationProperties.Name="Backup Interval in Days"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>
                    <!-- Backup Settings Panel continued -->
                    </StackPanel>
                    
                    <!-- Tab Visibility Settings -->
                    <StackPanel x:Name="TabVisibilityPanel" Visibility="Collapsed">
                        <TextBlock Text="Tab Visibility" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        <TextBlock Text="Choose which tabs appear in the main window. Changes take effect immediately." 
                                   TextWrapping="Wrap" Margin="0,0,0,16" Foreground="{DynamicResource SecondaryTextBrush}"/>
                        
                        <!-- File Management -->
                        <GroupBox Header="ðŸ“ File Management" Margin="0,0,0,12">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="TabFileManagement" Content="ðŸ“ File Management (entire section)" IsChecked="True" FontWeight="SemiBold" Margin="0,4"/>
                                <CheckBox x:Name="TabFileCleaner" Content="    File Cleaner" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabDuplicates" Content="    Duplicates" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabEmptyFolderScanner" Content="    Empty Folder Scanner" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabRobocopy" Content="    Robocopy" IsChecked="True" Margin="16,4,0,4"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- Multimedia -->
                        <GroupBox Header="ðŸŽ¬ Multimedia" Margin="0,0,0,12">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="TabMultimedia" Content="ðŸŽ¬ Multimedia (entire section)" IsChecked="True" FontWeight="SemiBold" Margin="0,4"/>
                                
                                <TextBlock Text="Audio" FontWeight="SemiBold" Margin="16,8,0,4"/>
                                <CheckBox x:Name="TabEnhancedAudioPlayer" Content="    Enhanced Audio Player" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAudioPlayer" Content="    Audio Player" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAudioTrim" Content="    Audio Trim" IsChecked="True" Margin="32,4,0,4"/>
                                
                                <TextBlock Text="Image" FontWeight="SemiBold" Margin="16,8,0,4"/>
                                <CheckBox x:Name="TabImageEdit" Content="    Image Edit" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabImageConverter" Content="    Image Converter" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabImageResizer" Content="    Image Resizer" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabIconConverter" Content="    ICO Converter" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabBatchWatermark" Content="    Batch Watermark" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabImageScaler" Content="    Image Scaler" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabModel3DEditor" Content="    3D Model Editor" IsChecked="True" Margin="32,4,0,4"/>
                                
                                <TextBlock Text="Video" FontWeight="SemiBold" Margin="16,8,0,4"/>
                                <CheckBox x:Name="TabVideoPlayer" Content="    Video Player" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabVideoEditor" Content="    Video Editor" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabUpscaler" Content="    Upscaler" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabVideoCombiner" Content="    Video Combiner" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabVideoConverter" Content="    Video Converter" IsChecked="True" Margin="32,4,0,4"/>
                                
                                <CheckBox x:Name="TabMediaLibrary" Content="    ðŸ“š Media Library" IsChecked="True" Margin="16,8,0,4"/>
                                <CheckBox x:Name="TabExternalTools" Content="    ðŸ”§ External Tools" IsChecked="True" Margin="16,4,0,4"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- System -->
                        <GroupBox Header="ðŸ–¥ï¸ System" Margin="0,0,0,12">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="TabSystem" Content="ðŸ–¥ï¸ System (entire section)" IsChecked="True" FontWeight="SemiBold" Margin="0,4"/>
                                <CheckBox x:Name="TabDiskCleanup" Content="    Disk Cleanup" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabPrivacyCleaner" Content="    Privacy Cleaner" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabRecentCleaner" Content="    Recent Cleaner" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabStartupManager" Content="    Startup Manager" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabProcessManager" Content="    Process Manager" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabRegistryCleaner" Content="    Registry Cleaner" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabScheduledTasks" Content="    Scheduled Tasks" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabSystemRestore" Content="    System Restore" IsChecked="True" Margin="16,4,0,4"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- Security -->
                        <GroupBox Header="ðŸ”’ Security" Margin="0,0,0,12">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="TabSecurity" Content="ðŸ”’ Security (entire section)" IsChecked="True" FontWeight="SemiBold" Margin="0,4"/>
                                <CheckBox x:Name="TabFolderHider" Content="    Folder Hider" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabSystemAudit" Content="    System Audit" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabForensicsAnalyzer" Content="    Forensics Analyzer" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabSecureWipe" Content="    Secure Wipe" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabHashScanner" Content="    Hash Scanner" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabRebootAnalyzer" Content="    Reboot Analyzer" IsChecked="True" Margin="16,4,0,4"/>
                                <!-- AD Security Analyzer - shown only when licensed -->
                                <CheckBox x:Name="TabAdSecurityAnalyzer" Content="    ðŸ” AD Security Analyzer (Licensed)" IsChecked="True" Margin="16,4,0,4" Visibility="Collapsed"/>
                                <CheckBox x:Name="TabAdvancedForensics" Content="    ðŸ”¬ Advanced Forensics" IsChecked="True" Margin="16,4,0,4"/>
                                <!-- Advanced Forensics Sub-tabs -->
                                <CheckBox x:Name="TabAdvForensicsMemory" Content="        Memory Analysis" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsArtifacts" Content="        Artifacts" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsTimeline" Content="        Timeline" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsKusto" Content="        Kusto" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsLocalKQL" Content="        Local KQL" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsMalware" Content="        Malware Analysis" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsExtract" Content="        Extract" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsOpenSearch" Content="        OpenSearch" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsOSINT" Content="        OSINT" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsSchedule" Content="        Task Scheduler" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsBrowser" Content="        Browser Forensics" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsIOC" Content="        IOC Scanner" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsRegistry" Content="        Registry Diff" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsPCAP" Content="        PCAP Parser" IsChecked="True" Margin="32,4,0,4"/>
                                <CheckBox x:Name="TabAdvForensicsResults" Content="        Results" IsChecked="True" Margin="32,4,0,4"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- Metadata -->
                        <GroupBox Header="ðŸ“‹ Metadata" Margin="0,0,0,12">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="TabMetadata" Content="ðŸ“‹ Metadata" IsChecked="True" FontWeight="SemiBold" Margin="0,4"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <!-- Tools -->
                        <GroupBox Header="ðŸ”§ Tools" Margin="0,0,0,12">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="TabTools" Content="ðŸ”§ Tools (entire section)" IsChecked="True" FontWeight="SemiBold" Margin="0,4"/>
                                <CheckBox x:Name="TabWebsiteDownloader" Content="    Website Downloader" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabFileAnalyzer" Content="    File Analyzer" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabDiskSpaceAnalyzer" Content="    Disk Space Analyzer" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabNetworkTools" Content="    Network Tools" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabArchiveManager" Content="    Archive Manager" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabPdfTools" Content="    PDF Tools" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabScreenshot" Content="    Screenshot" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabBootableUSB" Content="    Bootable USB Creator" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabPluginManager" Content="    Plugin Manager" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabFtpClient" Content="    FTP Client" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabTerminalClient" Content="    Terminal Client" IsChecked="True" Margin="16,4,0,4"/>
                                <CheckBox x:Name="TabSimpleBrowser" Content="    Simple Browser" IsChecked="True" Margin="16,4,0,4"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <WrapPanel Margin="0,8,0,0">
                            <Button Content="Show All Tabs" MinWidth="100" Margin="0,0,8,4" Click="ShowAllTabs_Click"/>
                            <Button Content="Hide All Tabs" MinWidth="100" Margin="0,0,0,4" Click="HideAllTabs_Click"/>
                        </WrapPanel>
                    </StackPanel>
                    
                    <!-- Audio Visualizer Settings -->
                    <StackPanel x:Name="VisualizerPanel" Visibility="Collapsed">
                        <TextBlock Text="Audio Visualizer" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        
                        <GroupBox Header="Visualizer Enable" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="EnableVisualizerCheck" Content="Enable audio visualizer" IsChecked="True" Margin="0,4"/>
                                <CheckBox x:Name="ShowVisualizerDuringPlaybackCheck" Content="Show visualizer during playback" IsChecked="True" Margin="0,4"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Visualizer Appearance" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Preset:" VerticalAlignment="Center"/>
                                    <ComboBox x:Name="VisualizerPresetCombo" Grid.Column="1" Margin="8,0,0,0">
                                        <ComboBoxItem Content="Default" IsSelected="True"/>
                                        <ComboBoxItem Content="Spectrum Analyzer"/>
                                        <ComboBoxItem Content="Waveform"/>
                                        <ComboBoxItem Content="Bars"/>
                                        <ComboBoxItem Content="Circular"/>
                                        <ComboBoxItem Content="Oscilloscope"/>
                                    </ComboBox>
                                </Grid>
                                
                                <Grid Margin="0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Opacity:" VerticalAlignment="Center"/>
                                    <Slider x:Name="VisualizerOpacitySlider" Grid.Column="1" Minimum="0.1" Maximum="1.0" Value="0.9" Margin="8,0"/>
                                    <TextBlock x:Name="OpacityValueText" Grid.Column="2" Text="90%" VerticalAlignment="Center" TextAlignment="Right"/>
                                </Grid>
                                
                                <Grid Margin="0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Bar Count:" VerticalAlignment="Center"/>
                                    <Slider x:Name="VisualizerBarCountSlider" Grid.Column="1" Minimum="8" Maximum="128" Value="32" 
                                            IsSnapToTickEnabled="True" TickFrequency="8" Margin="8,0"/>
                                    <TextBlock x:Name="BarCountValueText" Grid.Column="2" Text="32" VerticalAlignment="Center" TextAlignment="Right"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Visualizer Colors" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Primary Color:" VerticalAlignment="Center"/>
                                    <Button x:Name="PrimaryColorButton" Grid.Column="1" Height="30" Background="#1E90FF" ToolTip="Visualizer primary color" IsHitTestVisible="False"/>
                                </Grid>
                                
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Background Color:" VerticalAlignment="Center"/>
                                    <Button x:Name="BackgroundColorButton" Grid.Column="1" Height="30" Background="#0A0E27" ToolTip="Visualizer background color" IsHitTestVisible="False"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Advanced" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="EnableGPUAccelerationCheck" Content="Enable GPU acceleration" IsChecked="True" Margin="0,4"/>
                                <CheckBox x:Name="EnableAudioNormalizationCheck" Content="Normalize audio input" IsChecked="True" Margin="0,4"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                    
                    <!-- Last.fm Scrobbling Settings -->
                    <StackPanel x:Name="LastFmPanel" Visibility="Collapsed">
                        <TextBlock Text="Last.fm Scrobbling" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        <TextBlock Text="Connect your Last.fm account to scrobble tracks as you listen. You need a Last.fm API key and secret." 
                                   TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,16"/>

                        <GroupBox Header="API Credentials" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <TextBlock Text="Get your API key at https://www.last.fm/api/account/create" 
                                           Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,8"/>
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="API Key:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="LastFmApiKeyBox" Grid.Column="1" MaxWidth="400" HorizontalAlignment="Left" Width="400"/>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="API Secret:" VerticalAlignment="Center"/>
                                    <PasswordBox x:Name="LastFmApiSecretBox" Grid.Column="1" MaxWidth="400" HorizontalAlignment="Left" Width="400"/>
                                </Grid>
                                <Button Content="Save Credentials" MinWidth="180" HorizontalAlignment="Left" Margin="0,12,0,0" Click="SaveLastFmCredentials_Click"
                                        Background="#FF4CAF50" Foreground="White"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Connection Status" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <TextBlock x:Name="LastFmStatusText" Text="Not Connected" FontWeight="SemiBold"/>
                                <TextBlock Text="After saving your credentials, click 'Connect Last.fm' in the Audio Player to authenticate." 
                                           TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,8,0,0"/>
                                <Button Content="Clear Session (Re-authenticate)" MinWidth="220" HorizontalAlignment="Left" Margin="0,12,0,0" Click="ClearLastFmSession_Click"
                                        Background="#FFFF9800" Foreground="White"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>

                    <!-- Metadata / TMDb Settings -->
                    <StackPanel x:Name="MetadataPanel" Visibility="Collapsed">
                        <TextBlock Text="Metadata / TMDb" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        <TextBlock Text="Connect to The Movie Database (TMDb) to look up movie and TV show metadata including descriptions, ratings, genres, and cast information." 
                                   TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,16"/>

                        <GroupBox Header="TMDb API Key" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <TextBlock Text="Get your free API key at https://www.themoviedb.org/settings/api" 
                                           Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,8"/>
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="API Key:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="TmdbApiKeyBox" Grid.Column="1" MaxWidth="400" HorizontalAlignment="Left" Width="400"/>
                                </Grid>
                                <Button Content="Save TMDb Key" MinWidth="180" HorizontalAlignment="Left" Margin="0,12,0,0" Click="SaveTmdbApiKey_Click"
                                        Background="#FF4CAF50" Foreground="White"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="How It Works" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}">
                                    <Run FontWeight="SemiBold" Text="Once configured:"/>
                                </TextBlock>
                                <TextBlock Text="â€¢ In Media Hub, click the ðŸ” TMDb button next to any movie or TV series"
                                           Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,4,0,0"/>
                                <TextBlock Text="â€¢ TMDb will return title, description, genre, rating, director/cast info"
                                           Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,2,0,0"/>
                                <TextBlock Text="â€¢ Results are matched by filename, so clean filenames work best"
                                           Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,2,0,0"/>
                                <TextBlock x:Name="TmdbStatusText" Text="" FontWeight="SemiBold" Margin="0,12,0,0"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>

                    <!-- Remote Control Settings -->
                    <StackPanel x:Name="RemoteControlPanel" Visibility="Collapsed">
                        <TextBlock Text="Platypus Remote Control" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        <TextBlock Text="Control audio playback from your phone or tablet using a web browser. Enable the built-in server to access the remote control interface." 
                                   TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,16"/>

                        <GroupBox Header="Server Configuration" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="RemoteServerEnabledCheck" Content="Enable Remote Control Server" Margin="0,4"
                                          ToolTip="Allows remote devices to control audio playback"/>
                                <CheckBox x:Name="RemoteServerAutoStartCheck" Content="Start server automatically with app" Margin="0,4"
                                          IsEnabled="{Binding IsChecked, ElementName=RemoteServerEnabledCheck}"/>
                                
                                <Grid Margin="0,12,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Server Port:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="RemoteServerPortBox" Grid.Column="1" Text="47392"
                                             IsEnabled="{Binding IsChecked, ElementName=RemoteServerEnabledCheck}"/>
                                    <TextBlock Grid.Column="2" Text="(default: 47392)" Foreground="{DynamicResource SecondaryTextBrush}" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <!-- Entra ID / App Registration -->
                        <GroupBox Header="ðŸ” Entra ID App Registration" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <TextBlock Text="Authenticate Platypus Remote users via Microsoft Entra ID (Azure AD). When enabled, users must sign in with their Microsoft account before accessing the remote webapp. All values are stored locally and never committed to source control." 
                                           TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,12"/>
                                
                                <CheckBox x:Name="EntraIdAuthEnabledCheck" Content="Enable Entra ID authentication for webapp" 
                                          Margin="0,0,0,12" FontWeight="SemiBold"
                                          ToolTip="When enabled, the webapp will prompt users to sign in with Microsoft (MSAL.js). API requests require a valid Bearer token. Disabled by default."/>
                                
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Row 0: Client ID -->
                                    <StackPanel VerticalAlignment="Center" Margin="0,4">
                                        <TextBlock Text="Client ID:" FontWeight="SemiBold"/>
                                        <TextBlock Text="(Required)" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Margin="0,4">
                                        <TextBox x:Name="EntraClientIdBox" FontFamily="Consolas" MaxWidth="400" HorizontalAlignment="Left" MinWidth="340"
                                                 ToolTip="e.g. 12345678-abcd-1234-abcd-123456789abc"/>
                                        <TextBlock Text="Azure Portal â†’ App registrations â†’ Your app â†’ Overview â†’ 'Application (client) ID'" 
                                                   FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                    </StackPanel>

                                    <!-- Row 1: Tenant ID -->
                                    <StackPanel Grid.Row="1" VerticalAlignment="Center" Margin="0,4">
                                        <TextBlock Text="Tenant ID:" FontWeight="SemiBold"/>
                                        <TextBlock Text="(Required)" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,4">
                                        <TextBox x:Name="EntraTenantIdBox" FontFamily="Consolas" MaxWidth="400" HorizontalAlignment="Left" MinWidth="340"
                                                 Text="common"
                                                 ToolTip="Use 'common' for multi-tenant or enter your specific tenant ID"/>
                                        <TextBlock Text="Azure Portal â†’ App registrations â†’ Your app â†’ Overview â†’ 'Directory (tenant) ID'. Use 'common' to allow any Microsoft account." 
                                                   FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                    </StackPanel>

                                    <!-- Row 2: API Scope ID -->
                                    <StackPanel Grid.Row="2" VerticalAlignment="Center" Margin="0,4">
                                        <TextBlock Text="API Scope ID:" FontWeight="SemiBold"/>
                                        <TextBlock Text="(Usually = Client ID)" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="2" Grid.Column="1" Margin="0,4">
                                        <TextBox x:Name="EntraApiScopeIdBox" FontFamily="Consolas" MaxWidth="400" HorizontalAlignment="Left" MinWidth="340"
                                                 ToolTip="Leave empty to use Client ID. Format: api://{this-value}/access_as_user"/>
                                        <TextBlock Text="Azure Portal â†’ App registrations â†’ Your app â†’ Expose an API â†’ 'Application ID URI'. Usually api://{ClientId}. Leave blank to auto-use Client ID." 
                                                   FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                    </StackPanel>

                                    <!-- Row 3: Graph Client ID -->
                                    <StackPanel Grid.Row="3" VerticalAlignment="Center" Margin="0,4">
                                        <TextBlock Text="Graph Client ID:" FontWeight="SemiBold"/>
                                        <TextBlock Text="(Optional â€” advanced)" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="3" Grid.Column="1" Margin="0,4">
                                        <TextBox x:Name="EntraGraphClientIdBox" FontFamily="Consolas" MaxWidth="400" HorizontalAlignment="Left" MinWidth="340"
                                                 ToolTip="Leave empty to use the well-known MS Graph PowerShell client ID (14d82eec-...)"/>
                                        <TextBlock Text="Only needed if you have a separate app registration for Microsoft Graph API calls. Leave blank to use the default MS Graph PowerShell client ID." 
                                                   FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                    </StackPanel>

                                    <!-- Row 4: Allowed Emails -->
                                    <StackPanel Grid.Row="4" VerticalAlignment="Center" Margin="0,4">
                                        <TextBlock Text="Allowed Emails:" FontWeight="SemiBold"/>
                                        <TextBlock Text="(Optional)" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="4" Grid.Column="1" Margin="0,4">
                                        <TextBox x:Name="EntraIdAllowedEmailsBox" FontFamily="Consolas" MaxWidth="400" HorizontalAlignment="Left" MinWidth="340"
                                                 ToolTip="e.g. user@company.com,@company.com â€” leave empty to allow all"/>
                                        <TextBlock Text="Comma-separated list of email addresses or @domains that are allowed to sign in. Leave empty to allow anyone with a valid Microsoft account." 
                                                   FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Grid>

                                <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                    <Button x:Name="SaveEntraConfigBtn" Content="ðŸ’¾ Save Entra Config" MinWidth="140" 
                                            Click="SaveEntraConfig_Click" Background="#FF4CAF50" Foreground="White" Margin="0,0,8,0"/>
                                    <TextBlock x:Name="EntraConfigStatus" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" FontStyle="Italic"/>
                                </StackPanel>

                                <!-- Quick Setup Guide -->
                                <GroupBox Header="ðŸ“‹ Quick Setup Guide" Margin="0,12,0,0">
                                    <StackPanel Margin="6">
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11">
                                            <Run FontWeight="SemiBold">Step 1:</Run><Run> Go to </Run><Run FontWeight="SemiBold" Foreground="#2196F3">portal.azure.com</Run><Run> â†’ search "App registrations" â†’ click "+ New registration"</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,3,0,0">
                                            <Run FontWeight="SemiBold">Step 2:</Run><Run> Name it "Platypus Remote", select account type â†’ click Register</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,3,0,0">
                                            <Run FontWeight="SemiBold">Step 3:</Run><Run> Copy the "Application (client) ID" â†’ paste above as </Run><Run FontWeight="SemiBold">Client ID</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,3,0,0">
                                            <Run FontWeight="SemiBold">Step 4:</Run><Run> Copy the "Directory (tenant) ID" â†’ paste above as </Run><Run FontWeight="SemiBold">Tenant ID</Run><Run> (or keep "common")</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,3,0,0">
                                            <Run FontWeight="SemiBold">Step 5:</Run><Run> In your app, go to "Expose an API" â†’ Set Application ID URI â†’ Add scope "access_as_user"</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,3,0,0">
                                            <Run FontWeight="SemiBold">Step 6:</Run><Run> Go to "Authentication" â†’ Add platform â†’ Single-page application â†’ Add redirect URI: </Run><Run FontFamily="Consolas">https://localhost:47392/authentication/login-callback</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,6,0,0">
                                            <Run>ðŸ“– For the full walkthrough with screenshots, open Help â†’ Authentication section, or see DOCS/ENTRA_ID_SETUP.md</Run>
                                        </TextBlock>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </GroupBox>

                        <!-- Cloudflare Zero Trust -->
                        <GroupBox Header="ðŸ›¡ï¸ Cloudflare Zero Trust" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <TextBlock Text="Protect the remote control webapp with Cloudflare Access. Users must authenticate through Cloudflare's login page before reaching PlatypusTools. Requires a Cloudflare Tunnel and a Cloudflare account (free tier works)." 
                                           TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,12"/>
                                
                                <CheckBox x:Name="CfZeroTrustEnabledCheck" Content="Enable Cloudflare Zero Trust authentication" 
                                          Margin="0,0,0,12" FontWeight="SemiBold"
                                          ToolTip="When enabled, the remote server requires a valid Cloudflare Access JWT on all API requests. Disabled by default."/>
                                
                                <Grid Margin="0,4" IsEnabled="{Binding IsChecked, ElementName=CfZeroTrustEnabledCheck}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Row 0: Team Domain -->
                                    <StackPanel VerticalAlignment="Center" Margin="0,4">
                                        <TextBlock Text="Team Domain:" FontWeight="SemiBold"/>
                                        <TextBlock Text="(Required)" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Margin="0,4">
                                        <TextBox x:Name="CfTeamDomainBox" FontFamily="Consolas" MaxWidth="400" HorizontalAlignment="Left" MinWidth="340"
                                                 ToolTip="e.g. mycompany (not the full URL, just the team name)"/>
                                        <TextBlock Text="Your team name from the Zero Trust dashboard. If your login URL is mycompany.cloudflareaccess.com, enter just 'mycompany'. Found at: one.dash.cloudflare.com â†’ Settings â†’ Custom Pages â†’ Team domain." 
                                                   FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                    </StackPanel>

                                    <!-- Row 1: Application AUD -->
                                    <StackPanel Grid.Row="1" VerticalAlignment="Center" Margin="0,4">
                                        <TextBlock Text="Application AUD:" FontWeight="SemiBold"/>
                                        <TextBlock Text="(Required)" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="1" Grid.Column="1" Margin="0,4">
                                        <TextBox x:Name="CfAudienceBox" FontFamily="Consolas" MaxWidth="400" HorizontalAlignment="Left" MinWidth="340"
                                                 ToolTip="64-character hex string from your Cloudflare Access application"/>
                                        <TextBlock Text="one.dash.cloudflare.com â†’ Access â†’ Applications â†’ click your app â†’ Overview tab â†’ 'Application Audience (AUD) Tag'. It's a long hex string like 32a4f8c..." 
                                                   FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                    </StackPanel>

                                    <!-- Row 2: Allowed Emails -->
                                    <StackPanel Grid.Row="2" VerticalAlignment="Center" Margin="0,4">
                                        <TextBlock Text="Allowed Emails:" FontWeight="SemiBold"/>
                                        <TextBlock Text="(Optional)" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    </StackPanel>
                                    <StackPanel Grid.Row="2" Grid.Column="1" Margin="0,4">
                                        <TextBox x:Name="CfAllowedEmailsBox" FontFamily="Consolas" MaxWidth="400" HorizontalAlignment="Left" MinWidth="340"
                                                 ToolTip="e.g. user@company.com,@company.com â€” leave empty to allow all"/>
                                        <TextBlock Text="Comma-separated list of emails or @domain patterns. This is an extra layer ON TOP of Cloudflare's own access policies. Leave empty to allow all users who pass Cloudflare login." 
                                                   FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}" TextWrapping="Wrap" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Grid>

                                <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                    <Button x:Name="SaveCfZeroTrustBtn" Content="ðŸ’¾ Save Zero Trust Config" MinWidth="160" 
                                            Click="SaveCfZeroTrustConfig_Click" Background="#FF4CAF50" Foreground="White" Margin="0,0,8,0"/>
                                    <TextBlock x:Name="CfZeroTrustStatus" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" FontStyle="Italic"/>
                                </StackPanel>

                                <!-- Quick Setup Guide -->
                                <GroupBox Header="ðŸ“‹ Quick Setup Guide" Margin="0,12,0,0">
                                    <StackPanel Margin="6">
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11">
                                            <Run FontWeight="SemiBold">Step 1:</Run><Run> Go to </Run><Run FontWeight="SemiBold" Foreground="#2196F3">one.dash.cloudflare.com</Run><Run> (create a free account if needed)</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,3,0,0">
                                            <Run FontWeight="SemiBold">Step 2:</Run><Run> If prompted, create a team name (e.g. "platypus") â€” this becomes your Team Domain</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,3,0,0">
                                            <Run FontWeight="SemiBold">Step 3:</Run><Run> Go to Access â†’ Applications â†’ Add application â†’ Self-hosted</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,3,0,0">
                                            <Run FontWeight="SemiBold">Step 4:</Run><Run> Set Application domain to your tunnel URL (e.g. platypus.yourdomain.com)</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,3,0,0">
                                            <Run FontWeight="SemiBold">Step 5:</Run><Run> Create an Access Policy â†’ Allow â†’ Include â†’ Login Methods â†’ select an identity provider</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,3,0,0">
                                            <Run FontWeight="SemiBold">Step 6:</Run><Run> After creating the app, copy the </Run><Run FontWeight="SemiBold">Application Audience (AUD) Tag</Run><Run> from the app overview page â†’ paste above</Run>
                                        </TextBlock>
                                        <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,6,0,0">
                                            <Run>ðŸ“– For the full walkthrough, open Help â†’ Authentication section, or see DOCS/CLOUDFLARE_TUNNEL_SETUP.md</Run>
                                        </TextBlock>
                                    </StackPanel>
                                </GroupBox>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Server Status" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <StackPanel Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="Status: " FontWeight="SemiBold"/>
                                    <TextBlock x:Name="RemoteServerStatusText" Text="Stopped" Foreground="#FFF44336"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,8">
                                    <Button x:Name="StartRemoteServerBtn" Content="â–¶ Start Server" MinWidth="120" Margin="0,0,8,0" Click="StartRemoteServer_Click"
                                            Background="#FF4CAF50" Foreground="White"/>
                                    <Button x:Name="StopRemoteServerBtn" Content="â¬› Stop Server" MinWidth="120" Click="StopRemoteServer_Click"
                                            Background="#FFF44336" Foreground="White" IsEnabled="False"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="Connection Info" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <TextBlock Text="To control audio from another device:" Margin="0,0,0,8"/>
                                <TextBlock Text="1. Make sure both devices are on the same network" Margin="12,2"/>
                                <TextBlock Text="2. Scan the QR code or enter the URL below" Margin="12,2"/>
                                
                                <Grid Margin="0,16,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- QR Code -->
                                    <Border Background="White" CornerRadius="8" Padding="8" Margin="0,0,16,0">
                                        <Image x:Name="RemoteQRCodeImage" Width="150" Height="150" 
                                               RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                                    </Border>
                                    
                                    <!-- URL and buttons -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock Text="Connection URL:" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="12">
                                            <TextBlock x:Name="RemoteServerUrlText" Text="https://[your-ip]:47392" FontFamily="Consolas" FontSize="14" TextWrapping="Wrap"/>
                                        </Border>
                                        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                            <Button Content="ðŸ“‹ Copy URL" Margin="0,0,8,0" Click="CopyRemoteUrl_Click"/>
                                            <Button Content="ðŸ”„ Refresh QR" Click="RefreshQRCode_Click"/>
                                        </StackPanel>
                                        <TextBlock Text="ðŸ’¡ Tip: You can install this as an app on your phone!" 
                                                   Foreground="{DynamicResource AccentBrush}" Margin="0,12,0,0"/>
                                    </StackPanel>
                                </Grid>
                                
                                <TextBlock Text="Note: Accept the security certificate warning in your browser on first connection." 
                                           TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontStyle="Italic" Margin="0,12,0,0"/>
                            </StackPanel>
                        </GroupBox>

                        <!-- Cloudflare Tunnel Settings -->
                        <GroupBox Header="ðŸŒ External Access (Cloudflare Tunnel)" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <TextBlock Text="Access Platypus Remote from anywhere without port forwarding. Cloudflare Tunnel creates a secure connection to your server." 
                                           TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,12"/>
                                
                                <CheckBox x:Name="CloudflareTunnelEnabledCheck" Content="Enable Cloudflare Tunnel" Margin="0,4"
                                          ToolTip="Enables external access via Cloudflare's secure tunnel"/>
                                <CheckBox x:Name="CloudflareTunnelAutoStartCheck" Content="Start tunnel automatically with Remote Server" Margin="0,4"
                                          IsEnabled="{Binding IsChecked, ElementName=CloudflareTunnelEnabledCheck}"/>
                                
                                <Separator Margin="0,12"/>
                                
                                <!-- Tunnel Type Selection -->
                                <TextBlock Text="Tunnel Type:" FontWeight="SemiBold" Margin="0,8,0,4"/>
                                <RadioButton x:Name="QuickTunnelRadio" Content="Quick Tunnel (No account required)" GroupName="TunnelType" IsChecked="True" Margin="0,4"
                                             IsEnabled="{Binding IsChecked, ElementName=CloudflareTunnelEnabledCheck}"/>
                                <TextBlock Text="Generates a random *.trycloudflare.com URL. URL changes each time tunnel starts." 
                                           Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="20,0,0,8"/>
                                
                                <RadioButton x:Name="NamedTunnelRadio" Content="Named Tunnel (Custom hostname)" GroupName="TunnelType" Margin="0,4"
                                             IsEnabled="{Binding IsChecked, ElementName=CloudflareTunnelEnabledCheck}"/>
                                <StackPanel Margin="20,4,0,0" IsEnabled="{Binding IsChecked, ElementName=NamedTunnelRadio}">
                                    <Grid Margin="0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Tunnel Name:" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                        <TextBox x:Name="CloudflareTunnelNameBox" Grid.Column="1" 
                                                 Text="" MaxWidth="300" HorizontalAlignment="Left"
                                                 ToolTip="The tunnel name or UUID from 'cloudflared tunnel create'. Example: platypus-remote"/>
                                    </Grid>
                                    <TextBlock Text="Run 'cloudflared tunnel create &lt;name&gt;' first, then paste the name here." 
                                               Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="120,2,0,4"/>
                                    <Grid Margin="0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="120"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Text="Hostname:" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                        <TextBox x:Name="CloudflareTunnelHostnameBox" Grid.Column="1" 
                                                 Text="" MaxWidth="300" HorizontalAlignment="Left"
                                                 ToolTip="The public hostname for your tunnel. Example: platypus.yourdomain.com"/>
                                    </Grid>
                                    <TextBlock Text="Must match a DNS CNAME pointing to your tunnel (Cloudflare Dashboard â†’ DNS)." 
                                               Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="120,2,0,8"/>
                                    <TextBlock Text="Setup Steps: 1) cloudflared tunnel login  2) cloudflared tunnel create &lt;name&gt;  3) Add DNS CNAME in Cloudflare dashboard  4) Enter tunnel name and hostname above  5) Click Start Tunnel" 
                                               TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,4,0,4" FontStyle="Italic"/>
                                    <Button x:Name="CloudflareLoginBtn" Content="ðŸ” Cloudflare Login (opens browser)" MinWidth="200" HorizontalAlignment="Left" 
                                            Margin="0,8,0,0" Click="CloudflareLogin_Click"/>
                                </StackPanel>
                                
                                <!-- Tunnel Management -->
                                <Expander Header="ðŸ”§ Tunnel Management" Margin="0,12,0,0" IsExpanded="False">
                                    <StackPanel Margin="8">
                                        <TextBlock Text="Create, list, and manage your Cloudflare Tunnels and credentials â€” no CLI needed." 
                                                   TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,0,0,12"/>

                                        <!-- Current Credentials Info -->
                                        <TextBlock Text="Local Credentials:" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="8" Margin="0,0,0,8">
                                            <StackPanel>
                                                <TextBlock x:Name="TunnelCredentialsSummaryText" Text="Click 'Refresh' to scan credentials..." 
                                                           TextWrapping="Wrap" FontFamily="Consolas" FontSize="11"/>
                                            </StackPanel>
                                        </Border>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                                            <Button Content="ðŸ”„ Refresh Credentials" MinWidth="140" Margin="0,0,8,0" Click="RefreshCredentials_Click"
                                                    Background="#FF2196F3" Foreground="White"/>
                                            <Button x:Name="CleanupCredentialsBtn" Content="ðŸ—‘ Delete Old Credentials" MinWidth="160" Margin="0,0,8,0" Click="CleanupCredentials_Click"
                                                    Background="#FFF44336" Foreground="White" IsEnabled="False"
                                                    ToolTip="Removes credential files that don't match any existing tunnel"/>
                                            <Button Content="ðŸ“‚ Open .cloudflared Folder" MinWidth="160" Click="OpenCloudflaredFolder_Click"/>
                                        </StackPanel>
                                        
                                        <Separator Margin="0,4,0,12"/>
                                        
                                        <!-- List Tunnels -->
                                        <TextBlock Text="Remote Tunnels (Cloudflare Account):" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="8" Margin="0,0,0,8" MaxHeight="200">
                                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                                <ItemsControl x:Name="TunnelListItemsControl">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border BorderBrush="{DynamicResource BorderBrush}" BorderThickness="0,0,0,1" Padding="4" Margin="0,2">
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <StackPanel VerticalAlignment="Center">
                                                                        <TextBlock FontWeight="SemiBold" FontSize="13">
                                                                            <Run Text="{Binding Name, Mode=OneWay}"/>
                                                                        </TextBlock>
                                                                        <TextBlock FontFamily="Consolas" FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}">
                                                                            <Run Text="ID: "/><Run Text="{Binding Id, Mode=OneWay}"/>
                                                                        </TextBlock>
                                                                        <TextBlock FontSize="10" Foreground="{DynamicResource SecondaryTextBrush}">
                                                                            <Run Text="{Binding Connections, Mode=OneWay}"/>
                                                                        </TextBlock>
                                                                    </StackPanel>
                                                                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                                                        <Button Content="Use" MinWidth="50" Margin="4,0" Click="UseTunnel_Click" Tag="{Binding}"
                                                                                Background="#FF4CAF50" Foreground="White" ToolTip="Set this as the active tunnel name"/>
                                                                        <Button Content="Delete" MinWidth="55" Click="DeleteTunnel_Click" Tag="{Binding}"
                                                                                Background="#FFF44336" Foreground="White" ToolTip="Delete this tunnel from Cloudflare"/>
                                                                    </StackPanel>
                                                                </Grid>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </ScrollViewer>
                                        </Border>
                                        <TextBlock x:Name="TunnelListStatusText" Text="Click 'List Tunnels' to fetch from Cloudflare." 
                                                   Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,0,0,4"/>
                                        <Button Content="ðŸ” List Tunnels" MinWidth="120" HorizontalAlignment="Left" Margin="0,0,0,12" Click="ListTunnels_Click"
                                                Background="#FF2196F3" Foreground="White"/>
                                        
                                        <Separator Margin="0,4,0,12"/>
                                        
                                        <!-- Create Tunnel -->
                                        <TextBlock Text="Create New Tunnel:" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                        <TextBlock Text="Creates a new tunnel and generates credentials. You must be logged in first." 
                                                   TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,0,0,8"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                                            <TextBlock Text="New Tunnel Name:" VerticalAlignment="Center" Margin="0,0,8,0" FontWeight="SemiBold"/>
                                            <TextBox x:Name="NewTunnelNameBox" Width="200" Margin="0,0,8,0" 
                                                     ToolTip="Enter a name for the new tunnel"/>
                                            <Button x:Name="CreateTunnelBtn" Content="âž• Create Tunnel" MinWidth="120" Click="CreateTunnel_Click"
                                                    Background="#FF4CAF50" Foreground="White"/>
                                        </StackPanel>
                                        
                                        <Separator Margin="0,12,0,12"/>
                                        
                                        <!-- Route DNS -->
                                        <TextBlock Text="Route DNS:" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                        <TextBlock Text="Creates or updates a DNS CNAME record pointing your hostname to the tunnel. Uses the Tunnel Name and Hostname configured above." 
                                                   TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,0,0,8"/>
                                        <Button x:Name="RouteDnsBtn" Content="ðŸŒ Route DNS (Tunnel â†’ Hostname)" MinWidth="240" HorizontalAlignment="Left" Click="RouteDns_Click"
                                                Background="#FF9C27B0" Foreground="White"
                                                ToolTip="Runs 'cloudflared tunnel route dns' using the tunnel name and hostname above"/>
                                        
                                        <!-- Command Output -->
                                        <Expander Header="ðŸ“‹ Command Output" Margin="0,12,0,0" IsExpanded="False" x:Name="TunnelMgmtOutputExpander">
                                            <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="8" MaxHeight="200">
                                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                                    <TextBlock x:Name="TunnelMgmtOutputText" Text="" TextWrapping="Wrap" FontFamily="Consolas" FontSize="11"/>
                                                </ScrollViewer>
                                            </Border>
                                        </Expander>
                                    </StackPanel>
                                </Expander>
                                
                                <Separator Margin="0,12"/>
                                
                                <!-- Persistent Tunnel Control -->
                                <TextBlock Text="Persistent Tunnel:" FontWeight="SemiBold" Margin="0,8,0,4"/>
                                <TextBlock Text="The tunnel runs as a background process. Enable auto-start to launch it on login (no admin needed)." 
                                           TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,0,0,8"/>
                                
                                <StackPanel Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="Service Status: " FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    <TextBlock x:Name="WindowsServiceStatusText" Text="Checking..." Foreground="#FFFFC107" VerticalAlignment="Center"/>
                                </StackPanel>
                                
                                <StackPanel Orientation="Horizontal" Margin="0,8">
                                    <Button x:Name="StartServiceBtn" Content="â–¶ Start Tunnel" MinWidth="120" Margin="0,0,8,0" Click="StartWindowsService_Click"
                                            Background="#FF4CAF50" Foreground="White"/>
                                    <Button x:Name="StopServiceBtn" Content="â¬› Stop Tunnel" MinWidth="120" Margin="0,0,8,0" Click="StopWindowsService_Click"
                                            Background="#FFF44336" Foreground="White"/>
                                    <Button x:Name="InstallServiceBtn" Content="ðŸ“¥ Enable Auto-Start" MinWidth="140" Margin="0,0,8,0" Click="InstallWindowsService_Click"
                                            Background="#FF2196F3" Foreground="White"/>
                                    <Button x:Name="UninstallServiceBtn" Content="ðŸ—‘ Remove Auto-Start" MinWidth="140" Click="UninstallWindowsService_Click"
                                            Background="#FF9E9E9E" Foreground="White"/>
                                </StackPanel>
                                
                                <Separator Margin="0,12"/>
                                
                                <!-- Tunnel Status (process-based - for quick tunnels) -->
                                <TextBlock Text="Quick Tunnel (Temporary):" FontWeight="SemiBold" Margin="0,8,0,4"/>
                                <TextBlock Text="For quick/temporary tunnels only. Use the Persistent Tunnel section above for your named tunnel." 
                                           TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="0,0,0,8"/>
                                
                                <StackPanel Orientation="Horizontal" Margin="0,8">
                                    <TextBlock Text="Tunnel Status: " FontWeight="SemiBold"/>
                                    <TextBlock x:Name="CloudflareTunnelStatusText" Text="Not Running" Foreground="#FFF44336"/>
                                </StackPanel>
                                
                                <StackPanel Orientation="Horizontal" Margin="0,8">
                                    <Button x:Name="StartTunnelBtn" Content="â–¶ Start Tunnel" MinWidth="120" Margin="0,0,8,0" Click="StartTunnel_Click"
                                            Background="#FF4CAF50" Foreground="White" IsEnabled="{Binding IsChecked, ElementName=CloudflareTunnelEnabledCheck}"/>
                                    <Button x:Name="StopTunnelBtn" Content="â¬› Stop Tunnel" MinWidth="120" Margin="0,0,8,0" Click="StopTunnel_Click"
                                            Background="#FFF44336" Foreground="White" IsEnabled="False"/>
                                    <Button x:Name="InstallCloudflaredBtn" Content="ðŸ“¥ Install cloudflared" MinWidth="150" Click="InstallCloudflared_Click"
                                            Background="#FF2196F3" Foreground="White"/>
                                </StackPanel>
                                
                                <!-- Tunnel URL -->
                                <StackPanel x:Name="TunnelUrlPanel" Visibility="Collapsed" Margin="0,12,0,0">
                                    <TextBlock Text="External Access URL:" FontWeight="SemiBold" Margin="0,0,0,4"/>
                                    <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="4" Padding="12">
                                        <TextBlock x:Name="CloudflareTunnelUrlText" Text="" FontFamily="Consolas" FontSize="14" TextWrapping="Wrap"/>
                                    </Border>
                                    <Button Content="ðŸ“‹ Copy Tunnel URL" Margin="0,8,0,0" HorizontalAlignment="Left" Click="CopyTunnelUrl_Click"/>
                                </StackPanel>
                                
                                <!-- Tunnel Diagnostics -->
                                <Expander Header="âš™ Tunnel Diagnostics" Margin="0,16,0,0" IsExpanded="False">
                                    <StackPanel Margin="8">
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="140"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Process Running:" FontWeight="SemiBold"/>
                                            <TextBlock x:Name="TunnelDiagProcessText" Grid.Column="1" Text="No"/>
                                        </Grid>
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="140"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Active Connections:" FontWeight="SemiBold"/>
                                            <TextBlock x:Name="TunnelDiagConnectionsText" Grid.Column="1" Text="0"/>
                                        </Grid>
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="140"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Edge Location:" FontWeight="SemiBold"/>
                                            <TextBlock x:Name="TunnelDiagEdgeText" Grid.Column="1" Text="-"/>
                                        </Grid>
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="140"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Last Health Check:" FontWeight="SemiBold"/>
                                            <TextBlock x:Name="TunnelDiagHealthCheckText" Grid.Column="1" Text="-"/>
                                        </Grid>
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="140"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Last Log:" FontWeight="SemiBold"/>
                                            <TextBlock x:Name="TunnelDiagLastLogText" Grid.Column="1" Text="-" TextWrapping="Wrap" MaxWidth="400"/>
                                        </Grid>
                                        <Grid Margin="0,4">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="140"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="Running Processes:" FontWeight="SemiBold"/>
                                            <TextBlock x:Name="TunnelDiagProcessCountText" Grid.Column="1" Text="0"/>
                                        </Grid>
                                        <StackPanel Orientation="Horizontal" Margin="0,12,0,0">
                                            <Button Content="ðŸ”„ Refresh" MinWidth="100" Margin="0,0,8,0" Click="RefreshTunnelDiagnostics_Click"/>
                                            <Button Content="â˜  Kill All Processes" MinWidth="140" Margin="0,0,8,0" Click="KillAllTunnelProcesses_Click"
                                                    Background="#FFF44336" Foreground="White"/>
                                            <Button Content="ðŸ” Restart Tunnel" MinWidth="120" Click="RestartTunnel_Click"
                                                    Background="#FFFF9800" Foreground="White"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Expander>
                            </StackPanel>
                        </GroupBox>


                    </StackPanel>

                    <!-- Dependencies Settings -->
                    <StackPanel x:Name="DependenciesPanel" Visibility="Collapsed">
                        <TextBlock Text="Dependencies" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        <TextBlock Text="Some features require external tools. Use this section to check and install them." 
                                   TextWrapping="Wrap" Foreground="{DynamicResource SecondaryTextBrush}" Margin="0,0,0,16"/>
                        
                        <GroupBox Header="Dependency Status" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="30"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock x:Name="DepFFmpegStatus" Text="â³" FontSize="14"/>
                                    <TextBlock Grid.Column="1" Text="FFmpeg" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="DepFFmpegInfo" Grid.Column="2" Text="Checking..." Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    <Button x:Name="DepFFmpegBtn" Grid.Column="3" Content="Install" MinWidth="180" Click="DepInstallFFmpeg_Click"/>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="30"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock x:Name="DepExifToolStatus" Text="â³" FontSize="14"/>
                                    <TextBlock Grid.Column="1" Text="ExifTool" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="DepExifToolInfo" Grid.Column="2" Text="Checking..." Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    <Button x:Name="DepExifToolBtn" Grid.Column="3" Content="Install" MinWidth="180" Click="DepInstallExifTool_Click"/>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="30"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock x:Name="DepYtDlpStatus" Text="â³" FontSize="14"/>
                                    <TextBlock Grid.Column="1" Text="yt-dlp" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="DepYtDlpInfo" Grid.Column="2" Text="Checking..." Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    <Button x:Name="DepYtDlpBtn" Grid.Column="3" Content="Install" MinWidth="180" Click="DepInstallYtDlp_Click"/>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="30"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock x:Name="DepWebView2Status" Text="â³" FontSize="14"/>
                                    <TextBlock Grid.Column="1" Text="WebView2" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="DepWebView2Info" Grid.Column="2" Text="Checking..." Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    <Button x:Name="DepWebView2Btn" Grid.Column="3" Content="Install" MinWidth="180" Click="DepInstallWebView2_Click"/>
                                </Grid>
                                
                                <!-- Remote Access Tools Header -->
                                <TextBlock Text="Remote Access Tools (Optional)" FontWeight="SemiBold" Foreground="#FF9C27B0" Margin="0,16,0,4"/>
                                
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="30"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock x:Name="DepTailscaleStatus" Text="â³" FontSize="14"/>
                                    <TextBlock Grid.Column="1" Text="Tailscale" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="DepTailscaleInfo" Grid.Column="2" Text="Checking..." Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    <Button x:Name="DepTailscaleBtn" Grid.Column="3" Content="Download â†—" MinWidth="180" Click="DepOpenTailscaleSite_Click"/>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="30"/>
                                        <ColumnDefinition Width="120"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock x:Name="DepCloudflaredStatus" Text="â³" FontSize="14"/>
                                    <TextBlock Grid.Column="1" Text="cloudflared" FontWeight="SemiBold"/>
                                    <TextBlock x:Name="DepCloudflaredInfo" Grid.Column="2" Text="Checking..." Foreground="{DynamicResource SecondaryTextBrush}"/>
                                    <Button x:Name="DepCloudflaredBtn" Grid.Column="3" Content="Install" MinWidth="180" Click="DepInstallCloudflared_Click"/>
                                </Grid>
                                
                                <Button Content="ðŸ”„ Refresh Status" MinWidth="180" HorizontalAlignment="Left" Margin="0,12,0,0" Click="DepRefresh_Click"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Installation Options" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <CheckBox x:Name="ShowDependencyPromptCheck" Content="Show dependency setup on startup if tools are missing" IsChecked="True" Margin="0,4"/>
                                <TextBlock Text="When enabled, a setup window will appear on startup if any dependencies are missing." 
                                           Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" Margin="20,2,0,8"/>
                                <Button Content="Open Dependency Setup Window..." MinWidth="220" HorizontalAlignment="Left" Margin="0,8,0,0" Click="OpenDependencySetup_Click"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Manual Installation">
                            <StackPanel Margin="8">
                                <TextBlock TextWrapping="Wrap" Margin="0,0,0,8">
                                    If automatic installation fails, you can download and install the tools manually:
                                </TextBlock>
                                <StackPanel Orientation="Horizontal" Margin="0,4">
                                    <Button Content="FFmpeg Website â†—" MinWidth="180" Click="DepOpenFFmpegSite_Click"/>
                                    <TextBlock Text="Video editing, screen recording" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" Margin="12,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,8">
                                    <Button Content="ExifTool Website â†—" MinWidth="180" Click="DepOpenExifToolSite_Click"/>
                                    <TextBlock Text="Metadata editing" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" Margin="12,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,8">
                                    <Button Content="WebView2 Runtime â†—" MinWidth="180" Click="DepOpenWebView2Site_Click"/>
                                    <TextBlock Text="Help system, browser features" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" Margin="12,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,8">
                                    <Button Content="Tailscale Website â†—" MinWidth="180" Click="DepOpenTailscaleSite_Click"/>
                                    <TextBlock Text="Secure remote access (optional)" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" Margin="12,0,0,0"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Margin="0,8">
                                    <Button Content="cloudflared Releases â†—" MinWidth="180" Click="DepOpenCloudflaredSite_Click"/>
                                    <TextBlock Text="Cloudflare tunnel remote access (optional)" VerticalAlignment="Center" Foreground="{DynamicResource SecondaryTextBrush}" Margin="12,0,0,0"/>
                                </StackPanel>
                                <Button Content="ðŸ“ Open Tools Folder" MinWidth="180" HorizontalAlignment="Left" Margin="0,12,0,0" Click="DepOpenToolsFolder_Click"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                    
                    <!-- Advanced Settings -->
                    <StackPanel x:Name="AdvancedPanel" Visibility="Collapsed">
                        <TextBlock Text="Advanced" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,16"/>
                        
                        <GroupBox Header="Performance" Margin="0,0,0,16">
                            <StackPanel Margin="8">
                                <Grid Margin="0,4">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="Max concurrent operations:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="MaxConcurrentText" Grid.Column="1" Text="4"/>
                                </Grid>
                                <Grid Margin="0,8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="File scan batch size:" VerticalAlignment="Center"/>
                                    <TextBox x:Name="ScanBatchText" Grid.Column="1" Text="1000"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Data">
                            <StackPanel Margin="8">
                                <Button Content="Clear Recent Files" MinWidth="190" HorizontalAlignment="Left" Margin="0,4" Click="ClearRecent_Click"/>
                                <Button Content="Clear Cache" MinWidth="190" HorizontalAlignment="Left" Margin="0,4" Click="ClearCache_Click"/>
                                <Button Content="Reset All Settings" MinWidth="190" HorizontalAlignment="Left" Margin="0,8" Click="ResetAll_Click"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox Header="ðŸ”’ Security Vault" Margin="0,12,0,0">
                            <StackPanel Margin="8">
                                <TextBlock Text="If you forgot your master password, you can delete and recreate the vault database. This permanently destroys all saved passwords, TOTP entries, and authenticator keys." 
                                           TextWrapping="Wrap" Margin="0,0,0,8" Foreground="#FFE57373"/>
                                <Button Content="ðŸ—‘ï¸ Reset Vault Database" MinWidth="190" HorizontalAlignment="Left" 
                                        Background="#FFF44336" Foreground="White" FontWeight="Bold"
                                        Click="ResetVaultDatabase_Click"
                                        ToolTip="Delete the encrypted vault file and start fresh with a new master password"/>
                            </StackPanel>
                        </GroupBox>
                        
                        <GroupBox Header="Custom Fonts" Margin="0,16,0,0">
                            <StackPanel Margin="8">
                                <TextBlock Text="Install custom fonts for themes and visualizers. Fonts are installed system-wide and require admin rights." 
                                           TextWrapping="Wrap" Margin="0,0,0,12"/>
                                
                                <!-- Okuda Font (LCARS) -->
                                <StackPanel Orientation="Horizontal" Margin="0,4">
                                    <Button x:Name="InstallOkudaFontBtn" Content="ðŸ“ Install Okuda Font" 
                                            MinWidth="200" HorizontalAlignment="Left"
                                            Click="InstallOkudaFont_Click"
                                            ToolTip="LCARS theme font - Star Trek computer interface style"/>
                                    <TextBlock x:Name="OkudaFontStatus" Text="" FontSize="11" 
                                               Foreground="{DynamicResource ForegroundDimBrush}" 
                                               VerticalAlignment="Center" Margin="8,0,0,0"/>
                                </StackPanel>
                                
                                <!-- Monofonto Font (PipBoy) -->
                                <StackPanel Orientation="Horizontal" Margin="0,4">
                                    <Button x:Name="InstallMonofontoFontBtn" Content="ðŸ“ Install Monofonto Font" 
                                            MinWidth="200" HorizontalAlignment="Left"
                                            Click="InstallMonofontoFont_Click"
                                            ToolTip="PipBoy theme font - Fallout terminal style"/>
                                    <TextBlock x:Name="MonofontoFontStatus" Text="" FontSize="11" 
                                               Foreground="{DynamicResource ForegroundDimBrush}" 
                                               VerticalAlignment="Center" Margin="8,0,0,0"/>
                                </StackPanel>
                                
                                <!-- Overseer Font -->
                                <StackPanel Orientation="Horizontal" Margin="0,4">
                                    <Button x:Name="InstallOverseerFontBtn" Content="ðŸ“ Install Overseer Font" 
                                            MinWidth="200" HorizontalAlignment="Left"
                                            Click="InstallOverseerFont_Click"
                                            ToolTip="Vault-Tec Overseer style font"/>
                                    <TextBlock x:Name="OverseerFontStatus" Text="" FontSize="11" 
                                               Foreground="{DynamicResource ForegroundDimBrush}" 
                                               VerticalAlignment="Center" Margin="8,0,0,0"/>
                                </StackPanel>
                                
                                <!-- Klingon Font -->
                                <StackPanel Orientation="Horizontal" Margin="0,4">
                                    <Button x:Name="InstallKlingonFontBtn" Content="ðŸ“ Install Klingon Font" 
                                            MinWidth="200" HorizontalAlignment="Left"
                                            Click="InstallKlingonFont_Click"
                                            ToolTip="Klingon theme font for the tlhIngan wo' theme"/>
                                    <TextBlock x:Name="KlingonFontStatus" Text="" FontSize="11" 
                                               Foreground="{DynamicResource ForegroundDimBrush}" 
                                               VerticalAlignment="Center" Margin="8,0,0,0"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </Grid>
        
        <!-- Footer -->
        <Border Grid.Row="2" Background="{DynamicResource SurfaceBrush}" Padding="20,12">
            <WrapPanel HorizontalAlignment="Right">
                <Button Content="Apply" MinWidth="90" Margin="0,2,8,2" Click="Apply_Click"/>
                <Button Content="OK" MinWidth="80" Margin="0,2,8,2" Click="OK_Click"/>
                <Button Content="Cancel" MinWidth="80" Margin="0,2,0,2" Click="Cancel_Click"/>
            </WrapPanel>
        </Border>
    </Grid>
</Window>