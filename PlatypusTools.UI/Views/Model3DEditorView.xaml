<UserControl x:Class="PlatypusTools.UI.Views.Model3DEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:PlatypusTools.UI.ViewModels"
             mc:Ignorable="d" d:DesignHeight="600" d:DesignWidth="900">
    <UserControl.DataContext>
        <vm:Model3DEditorViewModel />
    </UserControl.DataContext>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        
        <!-- Left Panel - Controls -->
        <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
            <StackPanel Margin="10">
                <!-- File Operations -->
                <GroupBox Header="ðŸ“ SVG Import" Margin="0,0,0,10">
                    <StackPanel Margin="5">
                        <Button Content="Load SVG File" Command="{Binding LoadSvgCommand}" 
                                Padding="10,5" Margin="0,0,0,5"/>
                        <TextBlock Text="{Binding FileName}" TextTrimming="CharacterEllipsis" 
                                   ToolTip="{Binding CurrentFilePath}" Foreground="Gray"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- Extrusion Settings -->
                <GroupBox Header="ðŸ“ Extrusion Settings" Margin="0,0,0,10">
                    <StackPanel Margin="5">
                        <TextBlock Text="Depth (mm):" Margin="0,0,0,3"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <Slider Value="{Binding ExtrusionDepth}" Minimum="0.5" Maximum="50" 
                                    TickFrequency="1" IsSnapToTickEnabled="True"/>
                            <TextBox Grid.Column="1" Text="{Binding ExtrusionDepth, StringFormat=F1}" 
                                     Margin="5,0,0,0" TextAlignment="Center"/>
                        </Grid>
                        
                        <TextBlock Text="Scale:" Margin="0,10,0,3"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <Slider Value="{Binding Scale}" Minimum="0.1" Maximum="10" 
                                    TickFrequency="0.1"/>
                            <TextBox Grid.Column="1" Text="{Binding Scale, StringFormat=F2}" 
                                     Margin="5,0,0,0" TextAlignment="Center"/>
                        </Grid>
                    </StackPanel>
                </GroupBox>
                
                <!-- Create Basic Shapes -->
                <GroupBox Header="ðŸ”· Create Shape" Margin="0,0,0,10">
                    <StackPanel Margin="5">
                        <ComboBox ItemsSource="{Binding AvailableShapes}" 
                                  SelectedItem="{Binding SelectedShape}" Margin="0,0,0,5"/>
                        <TextBlock Text="Size (mm):" Margin="0,5,0,3"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <Slider Value="{Binding ShapeSize}" Minimum="5" Maximum="100" 
                                    TickFrequency="5" IsSnapToTickEnabled="True"/>
                            <TextBox Grid.Column="1" Text="{Binding ShapeSize, StringFormat=F0}" 
                                     Margin="5,0,0,0" TextAlignment="Center"/>
                        </Grid>
                        <Button Content="Create Shape" Command="{Binding CreateShapeCommand}" 
                                Padding="10,5" Margin="0,10,0,0"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- Create 3D Text -->
                <GroupBox Header="ðŸ”¤ Create 3D Text" Margin="0,0,0,10">
                    <StackPanel Margin="5">
                        <TextBlock Text="Text:" Margin="0,0,0,3"/>
                        <TextBox Text="{Binding TextToExtrude, UpdateSourceTrigger=PropertyChanged}" 
                                 MaxLength="20" Margin="0,0,0,5"/>
                        <TextBlock Text="Height (mm):" Margin="0,5,0,3"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <Slider Value="{Binding TextHeight}" Minimum="5" Maximum="50" 
                                    TickFrequency="5" IsSnapToTickEnabled="True"/>
                            <TextBox Grid.Column="1" Text="{Binding TextHeight, StringFormat=F0}" 
                                     Margin="5,0,0,0" TextAlignment="Center"/>
                        </Grid>
                        <Button Content="Create Text" Command="{Binding CreateTextCommand}" 
                                Padding="10,5" Margin="0,10,0,0"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- Position Controls -->
                <GroupBox Header="ðŸ“ Position" Margin="0,0,0,10">
                    <StackPanel Margin="5">
                        <TextBlock Text="Move X:" Margin="0,0,0,3"/>
                        <Slider Value="{Binding PositionX}" Minimum="-100" Maximum="100"/>
                        
                        <TextBlock Text="Move Y:" Margin="0,5,0,3"/>
                        <Slider Value="{Binding PositionY}" Minimum="-100" Maximum="100"/>
                        
                        <TextBlock Text="Move Z:" Margin="0,5,0,3"/>
                        <Slider Value="{Binding PositionZ}" Minimum="-100" Maximum="100"/>
                        
                        <Button Content="Center Model" Command="{Binding CenterModelCommand}" 
                                Padding="10,5" Margin="0,10,0,0"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- View Controls -->
                <GroupBox Header="ðŸŽ¥ View" Margin="0,0,0,10">
                    <StackPanel Margin="5">
                        <TextBlock Text="Model Scale:" Margin="0,0,0,3"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="50"/>
                            </Grid.ColumnDefinitions>
                            <Slider Value="{Binding ModelScale}" Minimum="0.1" Maximum="5" 
                                    TickFrequency="0.1"/>
                            <TextBox Grid.Column="1" Text="{Binding ModelScale, StringFormat=F2}" 
                                     Margin="5,0,0,0" TextAlignment="Center"/>
                        </Grid>
                        
                        <TextBlock Text="Rotation X:" Margin="0,10,0,3"/>
                        <Slider Value="{Binding RotationX}" Minimum="-180" Maximum="180"/>
                        
                        <TextBlock Text="Rotation Y:" Margin="0,5,0,3"/>
                        <Slider Value="{Binding RotationY}" Minimum="-180" Maximum="180"/>
                        
                        <TextBlock Text="Rotation Z:" Margin="0,5,0,3"/>
                        <Slider Value="{Binding RotationZ}" Minimum="-180" Maximum="180"/>
                        
                        <TextBlock Text="Zoom:" Margin="0,5,0,3"/>
                        <Slider Value="{Binding Zoom}" Minimum="20" Maximum="500"/>
                        
                        <TextBlock Text="Pan X:" Margin="0,5,0,3"/>
                        <Slider Value="{Binding PanX}" Minimum="-200" Maximum="200"/>
                        
                        <TextBlock Text="Pan Y:" Margin="0,5,0,3"/>
                        <Slider Value="{Binding PanY}" Minimum="-200" Maximum="200"/>
                        
                        <Button Content="Reset View" Command="{Binding ResetViewCommand}" 
                                Padding="10,5" Margin="0,10,0,0"/>
                    </StackPanel>
                </GroupBox>
                
                <!-- Export -->
                <GroupBox Header="ðŸ’¾ Export" Margin="0,0,0,10">
                    <StackPanel Margin="5">
                        <Button Content="Export as STL (3D Print)" Command="{Binding ExportStlCommand}" 
                                Padding="10,5" Margin="0,0,0,5"/>
                        <Button Content="Export as OBJ" Command="{Binding ExportObjCommand}" 
                                Padding="10,5" Margin="0,0,0,5"/>
                        <Button Content="Clear" Command="{Binding ClearCommand}" 
                                Padding="10,5"/>
                    </StackPanel>
                </GroupBox>
            </StackPanel>
        </ScrollViewer>
        
        <!-- Right Panel - 3D Viewport and Log -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="120"/>
            </Grid.RowDefinitions>
            
            <!-- 3D Viewport -->
            <Border Grid.Row="0" BorderBrush="{DynamicResource BorderBrush}" BorderThickness="1" 
                    Background="#1E1E1E" Margin="5"
                    x:Name="viewportBorder"
                    MouseLeftButtonDown="Viewport_MouseLeftButtonDown"
                    MouseLeftButtonUp="Viewport_MouseLeftButtonUp"
                    MouseRightButtonDown="Viewport_MouseRightButtonDown"
                    MouseRightButtonUp="Viewport_MouseRightButtonUp"
                    MouseMove="Viewport_MouseMove"
                    MouseWheel="Viewport_MouseWheel">
                <Grid>
                    <!-- 3D View -->
                    <Viewport3D x:Name="viewport3D">
                        <!-- Camera -->
                        <Viewport3D.Camera>
                            <PerspectiveCamera Position="{Binding CameraPosition}" 
                                               LookDirection="0,0,-1" 
                                               UpDirection="0,1,0" 
                                               FieldOfView="45"/>
                        </Viewport3D.Camera>
                        
                        <!-- Model -->
                        <ModelVisual3D Content="{Binding Model3D}" 
                                       Transform="{Binding ModelTransform}"/>
                        
                        <!-- Default lighting if no model -->
                        <ModelVisual3D>
                            <ModelVisual3D.Content>
                                <AmbientLight Color="#404040"/>
                            </ModelVisual3D.Content>
                        </ModelVisual3D>
                    </Viewport3D>
                    
                    <!-- No model placeholder -->
                    <TextBlock Text="Load an SVG file or create a shape to begin" 
                               HorizontalAlignment="Center" VerticalAlignment="Center"
                               Foreground="Gray" FontSize="16"
                               Visibility="{Binding Model3D, Converter={StaticResource NullToVisibilityConverter}}"/>
                    
                    <!-- Processing indicator -->
                    <Border Background="#80000000" 
                            Visibility="{Binding IsProcessing, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                            <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
                            <TextBlock Text="Processing..." Foreground="White" 
                                       HorizontalAlignment="Center" Margin="0,10,0,0"/>
                        </StackPanel>
                    </Border>
                </Grid>
            </Border>
            
            <!-- Status Bar -->
            <Border Grid.Row="1" Background="{DynamicResource SecondaryBackgroundBrush}" Padding="10,5">
                <TextBlock Text="{Binding StatusMessage}" Foreground="{DynamicResource ForegroundBrush}"/>
            </Border>
            
            <!-- Log -->
            <TextBox Grid.Row="2" Text="{Binding Log}" IsReadOnly="True" 
                     VerticalScrollBarVisibility="Auto" TextWrapping="Wrap"
                     Background="{DynamicResource BackgroundBrush}" 
                     Foreground="{DynamicResource ForegroundBrush}"
                     FontFamily="Consolas" FontSize="11" Margin="5,0,5,5"/>
        </Grid>
    </Grid>
</UserControl>
