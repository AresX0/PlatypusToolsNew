<UserControl x:Class="PlatypusTools.UI.Views.FileAnalyzerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900">
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="5"/>
            <RowDefinition Height="*" MinHeight="100"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Directory Input -->
        <GroupBox Header="Directory to Analyze" Grid.Row="0" Margin="0,0,0,10">
            <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
            <Grid Margin="5">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox x:Name="DirectoryPathTextBox" Grid.Row="0" Grid.Column="0" Text="{Binding DirectoryPath, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                         Height="25" VerticalContentAlignment="Center" Margin="0,0,5,0"/>
                <Button Grid.Row="0" Grid.Column="1" Content="Browse..." MinWidth="180" Height="25"
                        Click="OnBrowseClick"
                        Command="{Binding BrowseDirectoryCommand}"/>

                <CheckBox Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,5,0,0"
                          Content="Include subdirectories" IsChecked="{Binding IncludeSubdirectories}"/>
            </Grid>
            </ScrollViewer>
        </GroupBox>

        <!-- Action Buttons -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
            <Button Content="Analyze" MinWidth="180" Height="30" Margin="0,0,5,0"
                    Click="OnAnalyzeClick" Background="#FF4CAF50" Foreground="White" FontWeight="Bold"/>
            <Button Content="Find Duplicates" MinWidth="180" Height="30" Margin="0,0,5,0"
                    Click="OnFindDuplicatesClick" Background="#FF2196F3" Foreground="White"/>
            <Button Content="Build Tree" MinWidth="180" Height="30" Margin="0,0,5,0"
                    Click="OnBuildTreeClick" Background="#FF2196F3" Foreground="White"/>
            <Button Content="Export" MinWidth="180" Height="30" Margin="0,0,5,0"
                    Click="OnExportClick" Background="#FF2196F3" Foreground="White"/>
            <Button Content="Clear" MinWidth="180" Height="30" Margin="0,0,5,0"
                    Click="OnClearClick" Background="#FFF44336" Foreground="White"/>
        </StackPanel>

        <!-- Summary Stats -->
        <GroupBox Header="Summary" Grid.Row="2" Margin="0,0,0,10">
            <Grid Margin="5">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="Total Files:" FontWeight="Bold" Margin="0,0,10,0"/>
                <TextBlock x:Name="TotalFilesText" Grid.Column="1" Text="{Binding TotalFiles}"/>
                
                <TextBlock Grid.Column="2" Text="Total Size:" FontWeight="Bold" Margin="10,0,10,0"/>
                <TextBlock x:Name="TotalSizeText" Grid.Column="3" Text="{Binding TotalSizeFormatted}"/>
                
                <TextBlock Grid.Column="4" Text="Directories:" FontWeight="Bold" Margin="10,0,10,0"/>
                <TextBlock x:Name="TotalDirsText" Grid.Column="5" Text="{Binding TotalDirectories}"/>
            </Grid>
        </GroupBox>

        <!-- GridSplitter -->
        <GridSplitter Grid.Row="3" Height="5" HorizontalAlignment="Stretch" 
                      Background="#CCCCCC" Cursor="SizeNS" ResizeDirection="Rows"/>

        <!-- Tab Control for Different Views -->
        <TabControl Grid.Row="4" SelectedValuePath="Header" SelectedValue="{Binding SelectedView}">
            <!-- File Types Tab -->
            <TabItem Header="File Types">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <DataGrid x:Name="FileTypesDataGrid" ItemsSource="{Binding FileTypeStats}" 
                              AutoGenerateColumns="False" CanUserAddRows="False" 
                              CanUserResizeColumns="True" CanUserSortColumns="True"
                              SelectionMode="Single"
                              ColumnHeaderHeight="32"
                              HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Disabled">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Extension" Binding="{Binding Extension}" Width="150" MinWidth="100" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Count" Binding="{Binding Count}" Width="100" MinWidth="80" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Total Size" Binding="{Binding TotalSizeFormatted}" Width="*" MinWidth="120" CanUserResize="True" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </ScrollViewer>
            </TabItem>

            <!-- Largest Files Tab -->
            <TabItem Header="Largest Files">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <DataGrid x:Name="LargestFilesDataGrid" ItemsSource="{Binding LargestFiles}" 
                              AutoGenerateColumns="False" CanUserAddRows="False" 
                              CanUserResizeColumns="True" CanUserSortColumns="True"
                              SelectionMode="Single"
                              ColumnHeaderHeight="32"
                              HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Disabled">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" MinWidth="150" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Size" Binding="{Binding SizeFormatted}" Width="120" MinWidth="100" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Path" Binding="{Binding FullPath}" Width="2*" MinWidth="200" CanUserResize="True" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </ScrollViewer>
            </TabItem>

            <!-- Oldest Files Tab -->
            <TabItem Header="Oldest Files">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <DataGrid x:Name="OldestFilesDataGrid" ItemsSource="{Binding OldestFiles}" 
                              AutoGenerateColumns="False" CanUserAddRows="False" 
                              CanUserResizeColumns="True" CanUserSortColumns="True"
                              SelectionMode="Single"
                              ColumnHeaderHeight="32"
                              HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Disabled">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" MinWidth="150" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Created" Binding="{Binding Created, StringFormat={}{0:yyyy-MM-dd HH:mm}}" Width="150" MinWidth="120" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Size" Binding="{Binding SizeFormatted}" Width="120" MinWidth="100" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Path" Binding="{Binding FullPath}" Width="2*" MinWidth="200" CanUserResize="True" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </ScrollViewer>
            </TabItem>

            <!-- Newest Files Tab -->
            <TabItem Header="Newest Files">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <DataGrid x:Name="NewestFilesDataGrid" ItemsSource="{Binding NewestFiles}" 
                              AutoGenerateColumns="False" CanUserAddRows="False" 
                              CanUserResizeColumns="True" CanUserSortColumns="True"
                              SelectionMode="Single"
                              ColumnHeaderHeight="32"
                              HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Disabled">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" MinWidth="150" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Created" Binding="{Binding Created, StringFormat={}{0:yyyy-MM-dd HH:mm}}" Width="150" MinWidth="120" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Size" Binding="{Binding SizeFormatted}" Width="120" MinWidth="100" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Path" Binding="{Binding FullPath}" Width="2*" MinWidth="200" CanUserResize="True" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </ScrollViewer>
            </TabItem>

            <!-- File Age Distribution Tab -->
            <TabItem Header="Age Distribution">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <DataGrid x:Name="AgeDistributionDataGrid" ItemsSource="{Binding FilesByAge}" 
                              AutoGenerateColumns="False" CanUserAddRows="False" 
                              CanUserResizeColumns="True" CanUserSortColumns="True"
                              SelectionMode="Single"
                              ColumnHeaderHeight="32"
                              HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Disabled">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Age Range" Binding="{Binding AgeRange}" Width="*" MinWidth="150" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="File Count" Binding="{Binding Count}" Width="150" MinWidth="100" CanUserResize="True" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </ScrollViewer>
            </TabItem>

            <!-- Duplicates Tab -->
            <TabItem Header="Duplicates">
                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <DataGrid x:Name="DuplicatesDataGrid" ItemsSource="{Binding DuplicateGroups}" 
                              AutoGenerateColumns="False" CanUserAddRows="False" 
                              CanUserResizeColumns="True" CanUserSortColumns="True"
                              SelectionMode="Single"
                              ColumnHeaderHeight="32"
                              HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Disabled">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Hash" Binding="{Binding Hash}" Width="250" MinWidth="150" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Size" Binding="{Binding SizeFormatted}" Width="120" MinWidth="100" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Copies" Binding="{Binding FileCount}" Width="80" MinWidth="60" CanUserResize="True" IsReadOnly="True"/>
                            <DataGridTextColumn Header="Wasted Space" Binding="{Binding WastedSpace}" Width="*" MinWidth="120" CanUserResize="True" IsReadOnly="True"/>
                        </DataGrid.Columns>
                        <DataGrid.RowDetailsTemplate>
                            <DataTemplate>
                                <ItemsControl ItemsSource="{Binding Files}" Margin="20,5,5,5">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding}" Margin="0,2"/>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </DataTemplate>
                        </DataGrid.RowDetailsTemplate>
                    </DataGrid>
                </ScrollViewer>
            </TabItem>

            <!-- Directory Tree Tab -->
            <TabItem Header="Tree">
                <TreeView x:Name="DirectoryTreeView" ItemsSource="{Binding TreeNodes}">
                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Name}" FontWeight="Bold" Margin="0,0,10,0"/>
                                <TextBlock Text="{Binding SizeFormatted, StringFormat={}({0})}" Foreground="Gray"/>
                            </StackPanel>
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <StatusBar Grid.Row="5" Height="30" Margin="0,10,0,0">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>
