<UserControl x:Class="PlatypusTools.UI.Views.AdSecurityAnalyzerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:PlatypusTools.UI.ViewModels"
             Background="{DynamicResource WindowBackgroundBrush}">
    
    <UserControl.DataContext>
        <vm:AdSecurityAnalyzerViewModel />
    </UserControl.DataContext>

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Header and Connection -->
        <GroupBox Grid.Row="0" Header="ðŸ”’ Active Directory Security Analyzer" Margin="0,0,0,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBlock Grid.Column="0" Text="Target Domain:" VerticalAlignment="Center" Margin="5" />
                <TextBox Grid.Column="1" Text="{Binding TargetDomain, UpdateSourceTrigger=PropertyChanged}" 
                         Margin="5" ToolTip="Leave blank to use current domain" />

                <TextBlock Grid.Column="2" Text="Target DC:" VerticalAlignment="Center" Margin="5" />
                <TextBox Grid.Column="3" Text="{Binding TargetDc, UpdateSourceTrigger=PropertyChanged}" 
                         Margin="5" ToolTip="Leave blank for auto-detection" />

                <Button Grid.Column="4" Content="ðŸ” Discover Domain" Command="{Binding DiscoverDomainCommand}" 
                        MinWidth="180" Margin="5" Background="#FF2196F3" Foreground="White" />

                <!-- Domain Info Display -->
                <StackPanel Grid.Row="1" Grid.ColumnSpan="5" Orientation="Horizontal" Margin="5">
                    <TextBlock Text="Status: " FontWeight="SemiBold" />
                    <TextBlock Text="{Binding DomainInfo.DomainFqdn, FallbackValue='Not connected'}" Margin="0,0,20,0" />
                    <TextBlock Text="DC: " FontWeight="SemiBold" />
                    <TextBlock Text="{Binding DomainInfo.ChosenDc, FallbackValue='-'}" Margin="0,0,20,0" />
                    <TextBlock Text="PDC: " FontWeight="SemiBold" />
                    <TextBlock Text="{Binding DomainInfo.PdcEmulator, FallbackValue='-'}" />
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- Analysis Options and Controls -->
        <GroupBox Grid.Row="1" Header="âš™ï¸ Analysis Options" Margin="0,0,0,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Checkboxes -->
                <WrapPanel Grid.Column="0" Orientation="Horizontal" Margin="5">
                    <CheckBox Content="Privileged Groups" IsChecked="{Binding AnalyzePrivilegedGroups}" Margin="5" />
                    <CheckBox Content="Risky ACLs" IsChecked="{Binding AnalyzeRiskyAcls}" Margin="5" />
                    <CheckBox Content="GPO Analysis" IsChecked="{Binding AnalyzeGpos}" Margin="5" />
                    <CheckBox Content="SYSVOL Scan" IsChecked="{Binding AnalyzeSysvol}" Margin="5" />
                    <CheckBox Content="Kerberos Delegation" IsChecked="{Binding AnalyzeKerberosDelegation}" Margin="5" />
                    <CheckBox Content="AdminCount" IsChecked="{Binding AnalyzeAdminCount}" Margin="5" />
                    <Border Width="1" Background="Gray" Margin="10,2" />
                    <CheckBox Content="Filter Safe Identities" IsChecked="{Binding FilterSafeIdentities}" Margin="5" 
                              ToolTip="Exclude known-safe identities like SYSTEM, Domain Admins from ACL results" />
                    <CheckBox Content="Forest Mode" IsChecked="{Binding IncludeForestMode}" Margin="5" 
                              ToolTip="Include all domains in forest" />
                </WrapPanel>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="5">
                    <Button Content="â–¶ï¸ Run Full Analysis" Command="{Binding RunFullAnalysisCommand}" 
                            MinWidth="190" Margin="5" Background="#FF4CAF50" Foreground="White" FontWeight="SemiBold" />
                    <Button Content="âŒ Cancel" Command="{Binding CancelAnalysisCommand}" 
                            MinWidth="180" Margin="5" Background="#FFF44336" Foreground="White" />
                </StackPanel>
            </Grid>
        </GroupBox>

        <!-- Main Content - Tabbed Results -->
        <TabControl Grid.Row="2" Margin="0,0,0,8">
            <!-- Summary Tab -->
            <TabItem Header="ðŸ“Š Summary">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="300" />
                    </Grid.ColumnDefinitions>

                    <!-- Finding Counts -->
                    <GroupBox Header="Analysis Results" Margin="5">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <!-- Statistics Cards -->
                            <UniformGrid Rows="1" Columns="5" Margin="5">
                                <Border Background="#FFF44336" CornerRadius="5" Margin="5" Padding="10">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding CriticalFindings}" FontSize="24" FontWeight="Bold" 
                                                   Foreground="White" HorizontalAlignment="Center" />
                                        <TextBlock Text="Critical" Foreground="White" HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Border>
                                <Border Background="#FFFF9800" CornerRadius="5" Margin="5" Padding="10">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding HighFindings}" FontSize="24" FontWeight="Bold" 
                                                   Foreground="White" HorizontalAlignment="Center" />
                                        <TextBlock Text="High" Foreground="White" HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Border>
                                <Border Background="#FFFFC107" CornerRadius="5" Margin="5" Padding="10">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding MediumFindings}" FontSize="24" FontWeight="Bold" 
                                                   Foreground="Black" HorizontalAlignment="Center" />
                                        <TextBlock Text="Medium" Foreground="Black" HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Border>
                                <Border Background="#FF8BC34A" CornerRadius="5" Margin="5" Padding="10">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding LowFindings}" FontSize="24" FontWeight="Bold" 
                                                   Foreground="White" HorizontalAlignment="Center" />
                                        <TextBlock Text="Low" Foreground="White" HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Border>
                                <Border Background="#FF2196F3" CornerRadius="5" Margin="5" Padding="10">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding TotalFindings}" FontSize="24" FontWeight="Bold" 
                                                   Foreground="White" HorizontalAlignment="Center" />
                                        <TextBlock Text="Total" Foreground="White" HorizontalAlignment="Center" />
                                    </StackPanel>
                                </Border>
                            </UniformGrid>

                            <!-- Category Breakdown -->
                            <StackPanel Grid.Row="1" Margin="10">
                                <TextBlock Text="Findings by Category:" FontWeight="SemiBold" Margin="0,10,0,5" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <TextBlock Grid.Row="0" Text="Privileged Members" />
                                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding PrivilegedMembers.Count}" FontWeight="SemiBold" />

                                    <TextBlock Grid.Row="1" Text="Risky ACLs" />
                                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding RiskyAcls.Count}" FontWeight="SemiBold" />

                                    <TextBlock Grid.Row="2" Text="Risky GPOs" />
                                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding RiskyGpos.Count}" FontWeight="SemiBold" />

                                    <TextBlock Grid.Row="3" Text="SYSVOL Files" />
                                    <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SysvolFiles.Count}" FontWeight="SemiBold" />

                                    <TextBlock Grid.Row="4" Text="Kerberos Delegations" />
                                    <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding KerberosDelegations.Count}" FontWeight="SemiBold" />

                                    <TextBlock Grid.Row="5" Text="AdminCount Anomalies" />
                                    <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding AdminCountAnomalies.Count}" FontWeight="SemiBold" />
                                </Grid>

                                <TextBlock Text="{Binding AnalysisDuration, StringFormat='Duration: {0:mm\\:ss}'}" 
                                           Margin="0,15,0,0" FontStyle="Italic" />
                            </StackPanel>
                        </Grid>
                    </GroupBox>

                    <!-- Quick Actions -->
                    <GroupBox Grid.Column="1" Header="Quick Actions" Margin="5">
                        <StackPanel Margin="5">
                            <Button Content="ðŸ” Privileged Groups Only" Command="{Binding RunPrivilegedAnalysisCommand}" 
                                    Margin="5" Height="30" />
                            <Button Content="ðŸ” ACL Analysis Only" Command="{Binding RunAclAnalysisCommand}" 
                                    Margin="5" Height="30" />
                            <Button Content="ðŸŽ« Delegation Analysis Only" Command="{Binding RunDelegationAnalysisCommand}" 
                                    Margin="5" Height="30" />
                            <Button Content="ðŸ“ SYSVOL Scan Only" Command="{Binding RunSysvolAnalysisCommand}" 
                                    Margin="5" Height="30" />
                            <Separator Margin="5,15" />
                            <Button Content="ðŸ“¤ Export to CSV" Command="{Binding ExportToCsvCommand}" 
                                    Margin="5" Height="30" Background="#FF9C27B0" Foreground="White" />
                            <Button Content="ðŸ“‚ Open Database Folder" Command="{Binding OpenDatabaseFolderCommand}" 
                                    Margin="5" Height="30" />
                        </StackPanel>
                    </GroupBox>
                </Grid>
            </TabItem>

            <!-- Privileged Members Tab -->
            <TabItem Header="ðŸ‘¥ Privileged Members">
                <DataGrid ItemsSource="{Binding PrivilegedMembers}" 
                          SelectedItem="{Binding SelectedPrivilegedMember}"
                          AutoGenerateColumns="False" IsReadOnly="True"
                          CanUserSortColumns="True" CanUserResizeColumns="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Account" Binding="{Binding SamAccountName}" Width="150" />
                        <DataGridTextColumn Header="Group" Binding="{Binding GroupName}" Width="150" />
                        <DataGridTextColumn Header="Type" Binding="{Binding ObjectClass}" Width="80" />
                        <DataGridCheckBoxColumn Header="Enabled" Binding="{Binding IsEnabled}" Width="60" />
                        <DataGridCheckBoxColumn Header="Pwd Never Expires" Binding="{Binding PasswordNeverExpires}" Width="100" />
                        <DataGridCheckBoxColumn Header="Delegation" Binding="{Binding TrustedForDelegation}" Width="80" />
                        <DataGridCheckBoxColumn Header="SPN" Binding="{Binding HasSpn}" Width="50" />
                        <DataGridCheckBoxColumn Header="Nested" Binding="{Binding IsNested}" Width="60" />
                        <DataGridTextColumn Header="Nested Path" Binding="{Binding NestedPath}" Width="200" />
                        <DataGridTextColumn Header="Risky UAC Flags" Binding="{Binding RiskyUacFlags, Converter={StaticResource ListToStringConverter}}" Width="150" />
                        <DataGridTextColumn Header="Password Last Set" Binding="{Binding PasswordLastSet, StringFormat='{}{0:yyyy-MM-dd}'}" Width="110" />
                        <DataGridTextColumn Header="Last Logon" Binding="{Binding LastLogon, StringFormat='{}{0:yyyy-MM-dd}'}" Width="100" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- Risky ACLs Tab -->
            <TabItem Header="ðŸ” Risky ACLs">
                <DataGrid ItemsSource="{Binding RiskyAcls}" 
                          SelectedItem="{Binding SelectedRiskyAcl}"
                          AutoGenerateColumns="False" IsReadOnly="True"
                          CanUserSortColumns="True" CanUserResizeColumns="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="70">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <Trigger Property="Text" Value="Critical">
                                            <Setter Property="Background" Value="#FFF44336" />
                                            <Setter Property="Foreground" Value="White" />
                                        </Trigger>
                                        <Trigger Property="Text" Value="High">
                                            <Setter Property="Background" Value="#FFFF9800" />
                                            <Setter Property="Foreground" Value="White" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Identity" Binding="{Binding IdentityReference}" Width="180" />
                        <DataGridTextColumn Header="Rights" Binding="{Binding ActiveDirectoryRights}" Width="150" />
                        <DataGridTextColumn Header="Object Type" Binding="{Binding ObjectTypeName}" Width="150" />
                        <DataGridTextColumn Header="Target Object" Binding="{Binding ObjectDn}" Width="*" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- Kerberos Delegation Tab -->
            <TabItem Header="ðŸŽ« Kerberos Delegation">
                <DataGrid ItemsSource="{Binding KerberosDelegations}" 
                          SelectedItem="{Binding SelectedDelegation}"
                          AutoGenerateColumns="False" IsReadOnly="True"
                          CanUserSortColumns="True" CanUserResizeColumns="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="70">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <Trigger Property="Text" Value="Critical">
                                            <Setter Property="Background" Value="#FFF44336" />
                                            <Setter Property="Foreground" Value="White" />
                                        </Trigger>
                                        <Trigger Property="Text" Value="High">
                                            <Setter Property="Background" Value="#FFFF9800" />
                                            <Setter Property="Foreground" Value="White" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Account" Binding="{Binding SamAccountName}" Width="180" />
                        <DataGridTextColumn Header="Type" Binding="{Binding ObjectClass}" Width="80" />
                        <DataGridTextColumn Header="Delegation Type" Binding="{Binding DelegationType}" Width="180" />
                        <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- SYSVOL Files Tab -->
            <TabItem Header="ðŸ“ SYSVOL Files">
                <DataGrid ItemsSource="{Binding SysvolFiles}" 
                          AutoGenerateColumns="False" IsReadOnly="True"
                          CanUserSortColumns="True" CanUserResizeColumns="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Severity" Binding="{Binding Severity}" Width="70" />
                        <DataGridTextColumn Header="File Name" Binding="{Binding FileName}" Width="200" />
                        <DataGridTextColumn Header="Extension" Binding="{Binding Extension}" Width="70" />
                        <DataGridTextColumn Header="Size" Binding="{Binding FileSize, StringFormat='{}{0:N0} bytes'}" Width="100" />
                        <DataGridTextColumn Header="Created" Binding="{Binding CreationTime, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="130" />
                        <DataGridTextColumn Header="Modified" Binding="{Binding LastWriteTime, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="130" />
                        <DataGridTextColumn Header="SHA256" Binding="{Binding Sha256Hash}" Width="200" />
                        <DataGridTextColumn Header="Path" Binding="{Binding FilePath}" Width="*" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- AdminCount Tab -->
            <TabItem Header="âš ï¸ AdminCount Anomalies">
                <DataGrid ItemsSource="{Binding AdminCountAnomalies}" 
                          AutoGenerateColumns="False" IsReadOnly="True"
                          CanUserSortColumns="True" CanUserResizeColumns="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Account" Binding="{Binding SamAccountName}" Width="180" />
                        <DataGridTextColumn Header="Type" Binding="{Binding ObjectClass}" Width="80" />
                        <DataGridTextColumn Header="AdminCount" Binding="{Binding AdminCount}" Width="80" />
                        <DataGridCheckBoxColumn Header="Currently Privileged" Binding="{Binding IsCurrentlyPrivileged}" Width="120" />
                        <DataGridTextColumn Header="Issue" Binding="{Binding Issue}" Width="*" />
                    </DataGrid.Columns>
                </DataGrid>
            </TabItem>

            <!-- History Tab -->
            <TabItem Header="ðŸ“œ History">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <DataGrid ItemsSource="{Binding AnalysisHistory}" 
                              SelectedItem="{Binding SelectedHistoryRun}"
                              AutoGenerateColumns="False" IsReadOnly="True"
                              CanUserSortColumns="True" Margin="0,0,5,0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50" />
                            <DataGridTextColumn Header="Time" Binding="{Binding RunTime, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Width="130" />
                            <DataGridTextColumn Header="Domain" Binding="{Binding TargetDomain}" Width="150" />
                            <DataGridTextColumn Header="Total" Binding="{Binding TotalFindings}" Width="60" />
                            <DataGridTextColumn Header="Critical" Binding="{Binding CriticalCount}" Width="60" />
                            <DataGridTextColumn Header="High" Binding="{Binding HighCount}" Width="60" />
                            <DataGridTextColumn Header="Medium" Binding="{Binding MediumCount}" Width="60" />
                            <DataGridTextColumn Header="Duration" Binding="{Binding DurationSeconds, StringFormat='{}{0:F1}s'}" Width="70" />
                            <DataGridCheckBoxColumn Header="Complete" Binding="{Binding IsComplete}" Width="70" />
                        </DataGrid.Columns>
                    </DataGrid>

                    <StackPanel Grid.Column="1" Width="150">
                        <Button Content="ðŸ“¥ Load Selected" Command="{Binding LoadSelectedRunCommand}" Margin="5" Height="30" />
                        <Button Content="ðŸ“¤ Export Selected" Command="{Binding ExportSelectedRunCommand}" Margin="5" Height="30" />
                        <Button Content="ðŸ—‘ï¸ Delete Selected" Command="{Binding DeleteSelectedRunCommand}" Margin="5" Height="30" 
                                Background="#FFF44336" Foreground="White" />
                        <Separator Margin="5,15" />
                        <Button Content="ðŸ”„ Refresh" Command="{Binding LoadHistoryCommand}" Margin="5" Height="30" />
                        <Button Content="ðŸ—‘ï¸ Clear All" Command="{Binding ClearHistoryCommand}" Margin="5" Height="30" 
                                Background="#FFFF9800" Foreground="White" />
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Deployment Tab -->
            <TabItem Header="ðŸš€ Deployment">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="400" />
                    </Grid.ColumnDefinitions>

                    <!-- Deployment Options -->
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="10">
                            <!-- OU Structure Options -->
                            <GroupBox Header="ðŸ“ Tiered Admin OU Structure (BILL Model)" Margin="0,0,0,10">
                                <StackPanel Margin="10">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                        </Grid.RowDefinitions>

                                        <TextBlock Grid.Column="0" Text="Base OU Name:" VerticalAlignment="Center" Margin="0,0,10,5" />
                                        <TextBox Grid.Column="1" Text="{Binding DeploymentBaseName, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,20,5" />

                                        <TextBlock Grid.Column="2" Text="Tier 0 Name:" VerticalAlignment="Center" Margin="0,0,10,5" />
                                        <TextBox Grid.Column="3" Text="{Binding Tier0Name, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,5" />

                                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Tier 1 Name:" VerticalAlignment="Center" Margin="0,0,10,5" />
                                        <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding Tier1Name, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,20,5" />

                                        <TextBlock Grid.Row="1" Grid.Column="2" Text="Tier 2 Name:" VerticalAlignment="Center" Margin="0,0,10,5" />
                                        <TextBox Grid.Row="1" Grid.Column="3" Text="{Binding Tier2Name, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,5" />
                                    </Grid>

                                    <Separator Margin="0,10" />

                                    <TextBlock Text="Sub-OUs to Create:" FontWeight="SemiBold" Margin="0,0,0,5" />
                                    <WrapPanel Orientation="Horizontal">
                                        <CheckBox Content="PAW (Privileged Access Workstations)" IsChecked="{Binding CreatePawOus}" Margin="0,0,20,5" />
                                        <CheckBox Content="Service Accounts" IsChecked="{Binding CreateServiceAccountOus}" Margin="0,0,20,5" />
                                        <CheckBox Content="Groups" IsChecked="{Binding CreateGroupsOus}" Margin="0,0,20,5" />
                                        <CheckBox Content="Users" IsChecked="{Binding CreateUsersOus}" Margin="0,0,20,5" />
                                        <CheckBox Content="Devices (Servers/Workstations)" IsChecked="{Binding CreateDevicesOus}" Margin="0,0,20,5" />
                                    </WrapPanel>

                                    <CheckBox Content="Protect OUs from accidental deletion" IsChecked="{Binding ProtectOusFromDeletion}" 
                                              Margin="0,10,0,5" FontWeight="SemiBold" />

                                    <Button Content="ðŸ—ï¸ Deploy Tiered OU Structure" Command="{Binding DeployTieredOusCommand}" 
                                            MinWidth="220" Height="35" Margin="0,10,0,0" HorizontalAlignment="Left"
                                            Background="#FF4CAF50" Foreground="White" FontWeight="SemiBold" />
                                </StackPanel>
                            </GroupBox>

                            <!-- GPO Options -->
                            <GroupBox Header="ðŸ“œ Baseline GPO Deployment" Margin="0,0,0,10">
                                <StackPanel Margin="10">
                                    <TextBlock Text="GPOs to Deploy:" FontWeight="SemiBold" Margin="0,0,0,5" />
                                    <CheckBox Content="Password Policy (14+ chars, complexity, 90-day expiry)" IsChecked="{Binding DeployPasswordPolicyGpo}" Margin="0,0,0,5" />
                                    <CheckBox Content="Advanced Audit Policy (Logon, Object Access, etc.)" IsChecked="{Binding DeployAuditPolicyGpo}" Margin="0,0,0,5" />
                                    <CheckBox Content="Security Baseline (Disable LM, SMB signing, LDAP signing)" IsChecked="{Binding DeploySecurityBaselineGpo}" Margin="0,0,0,5" />
                                    <CheckBox Content="PAW Security Policy (Credential Guard, AppLocker)" IsChecked="{Binding DeployPawGpo}" Margin="0,0,0,5" />

                                    <TextBlock Text="âš ï¸ GPOs are created as shells. Configure settings in Group Policy Management Console." 
                                               Foreground="Orange" Margin="0,10,0,5" TextWrapping="Wrap" />

                                    <Button Content="ðŸ“œ Deploy Baseline GPOs" Command="{Binding DeployBaselineGposCommand}" 
                                            MinWidth="200" Height="35" Margin="0,10,0,0" HorizontalAlignment="Left"
                                            Background="#FF2196F3" Foreground="White" FontWeight="SemiBold" />
                                </StackPanel>
                            </GroupBox>

                            <!-- Deployment Results -->
                            <GroupBox Header="ðŸ“‹ Deployment Results">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*" MinHeight="150" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <DataGrid ItemsSource="{Binding DeploymentResults}" 
                                              AutoGenerateColumns="False" IsReadOnly="True"
                                              MaxHeight="300">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Result" Binding="{Binding Success}" Width="60">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <Trigger Property="Text" Value="True">
                                                                <Setter Property="Text" Value="âœ“" />
                                                                <Setter Property="Foreground" Value="Green" />
                                                                <Setter Property="FontWeight" Value="Bold" />
                                                                <Setter Property="HorizontalAlignment" Value="Center" />
                                                            </Trigger>
                                                            <Trigger Property="Text" Value="False">
                                                                <Setter Property="Text" Value="âœ—" />
                                                                <Setter Property="Foreground" Value="Red" />
                                                                <Setter Property="FontWeight" Value="Bold" />
                                                                <Setter Property="HorizontalAlignment" Value="Center" />
                                                            </Trigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>
                                            <DataGridTextColumn Header="Type" Binding="{Binding ObjectType}" Width="60" />
                                            <DataGridTextColumn Header="Name" Binding="{Binding ObjectName}" Width="180" />
                                            <DataGridTextColumn Header="Message" Binding="{Binding Message}" Width="*" />
                                        </DataGrid.Columns>
                                    </DataGrid>

                                    <Button Grid.Row="1" Content="Clear Results" Command="{Binding ClearDeploymentResultsCommand}" 
                                            MinWidth="180" Height="25" Margin="5" HorizontalAlignment="Right" />
                                </Grid>
                            </GroupBox>
                        </StackPanel>
                    </ScrollViewer>

                    <!-- Preview Panel -->
                    <GroupBox Grid.Column="1" Header="ðŸ‘ï¸ Deployment Preview" Margin="10,0,0,0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <Button Content="ðŸ”„ Generate Preview" Command="{Binding PreviewDeploymentCommand}" 
                                    MinWidth="190" Height="30" Margin="5" HorizontalAlignment="Left" />

                            <TextBox Grid.Row="1" Text="{Binding DeploymentPreview, Mode=OneWay}" 
                                     IsReadOnly="True" TextWrapping="Wrap" 
                                     VerticalScrollBarVisibility="Auto"
                                     FontFamily="Consolas" FontSize="11"
                                     Background="#FF1E1E1E" Foreground="#FFDCDCDC"
                                     Margin="5" />
                        </Grid>
                    </GroupBox>
                </Grid>
            </TabItem>

            <!-- Log Tab -->
            <TabItem Header="ðŸ“ Log">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <ListBox ItemsSource="{Binding LogMessages}" 
                             FontFamily="Consolas" FontSize="11"
                             Background="#FF1E1E1E" Foreground="#FFDCDCDC" />

                    <Button Grid.Row="1" Content="Clear Log" Command="{Binding ClearLogCommand}" 
                            HorizontalAlignment="Right" Margin="5" MinWidth="180" />
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{DynamicResource ControlBackgroundBrush}" Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock Text="{Binding Status}" VerticalAlignment="Center" />

                <ProgressBar Grid.Column="1" Width="200" Height="16" 
                             Value="{Binding Progress}" 
                             IsIndeterminate="{Binding IsIndeterminate}"
                             Visibility="{Binding IsAnalyzing, Converter={StaticResource BoolToVisibilityConverter}}" />
            </Grid>
        </Border>
    </Grid>
</UserControl>
