<UserControl x:Class="PlatypusTools.UI.Views.FileRenamerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:PlatypusTools.UI.ViewModels"
             xmlns:models="clr-namespace:PlatypusTools.Core.Models;assembly=PlatypusTools.Core"
             mc:Ignorable="d" d:DesignHeight="700" d:DesignWidth="1000">
    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Folder Selection -->
        <GroupBox Header="Folder Selection" Grid.Row="0" Margin="0,0,0,8">
            <StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                    <TextBlock VerticalAlignment="Center" Width="100">Folder Path:</TextBlock>
                    <TextBox Width="500" Text="{Binding FolderPath, UpdateSourceTrigger=PropertyChanged}" />
                    <Button Content="Browse..." Command="{Binding BrowseFolderCommand}" Width="90" Margin="8,0,0,0" />
                    <Button Content="Scan" Command="{Binding ScanCommand}" Width="90" Margin="8,0,0,0" />
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                    <CheckBox IsChecked="{Binding IncludeSubfolders}" Margin="100,0,16,0">Include Subfolders</CheckBox>
                    <TextBlock VerticalAlignment="Center" Margin="0,0,8,0">File Type:</TextBlock>
                    <ComboBox Width="120" SelectedItem="{Binding FileTypeFilter}">
                        <ComboBox.ItemsSource>
                            <x:Array Type="models:FileTypeFilter">
                                <models:FileTypeFilter>All</models:FileTypeFilter>
                                <models:FileTypeFilter>Video</models:FileTypeFilter>
                                <models:FileTypeFilter>Picture</models:FileTypeFilter>
                                <models:FileTypeFilter>Document</models:FileTypeFilter>
                                <models:FileTypeFilter>Audio</models:FileTypeFilter>
                                <models:FileTypeFilter>Archive</models:FileTypeFilter>
                            </x:Array>
                        </ComboBox.ItemsSource>
                    </ComboBox>
                </StackPanel>
            </StackPanel>
        </GroupBox>

        <!-- Options Tabs -->
        <TabControl Grid.Row="1" Height="220" Margin="0,0,0,8">
            <!-- Prefix Management Tab -->
            <TabItem Header="Prefix Management">
                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center">New Prefix:</TextBlock>
                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding NewPrefix, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,4" />

                    <TextBlock Grid.Row="1" Grid.Column="0" VerticalAlignment="Center">Old Prefix:</TextBlock>
                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding OldPrefix, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,4" />

                    <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center">Ignore Prefix:</TextBlock>
                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding IgnorePrefix, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,4" />

                    <CheckBox Grid.Row="3" Grid.Column="1" IsChecked="{Binding NormalizeCasing}" Margin="0,4,0,4">Normalize Prefix Casing</CheckBox>
                    <CheckBox Grid.Row="4" Grid.Column="1" IsChecked="{Binding OnlyFilesWithOldPrefix}" Margin="0,0,0,4">Process Only Files With Old Prefix</CheckBox>
                </Grid>
            </TabItem>

            <!-- Season/Episode Tab -->
            <TabItem Header="Season/Episode Numbering">
                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="180" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center">Season Number:</TextBlock>
                    <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SeasonNumber, UpdateSourceTrigger=PropertyChanged}" Width="80" HorizontalAlignment="Left" Margin="0,0,0,4" />

                    <TextBlock Grid.Row="1" Grid.Column="0" VerticalAlignment="Center">Season Leading Zeros (1-4):</TextBlock>
                    <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding SeasonLeadingZeros, UpdateSourceTrigger=PropertyChanged}" Width="80" HorizontalAlignment="Left" Margin="0,0,0,4" />

                    <TextBlock Grid.Row="2" Grid.Column="0" VerticalAlignment="Center">Start Episode Number:</TextBlock>
                    <TextBox Grid.Row="2" Grid.Column="1" Text="{Binding StartEpisodeNumber, UpdateSourceTrigger=PropertyChanged}" Width="80" HorizontalAlignment="Left" Margin="0,0,0,4" />

                    <TextBlock Grid.Row="3" Grid.Column="0" VerticalAlignment="Center">Episode Leading Zeros (1-4):</TextBlock>
                    <TextBox Grid.Row="3" Grid.Column="1" Text="{Binding EpisodeLeadingZeros, UpdateSourceTrigger=PropertyChanged}" Width="80" HorizontalAlignment="Left" Margin="0,0,0,4" />

                    <CheckBox Grid.Row="4" Grid.Column="1" IsChecked="{Binding RenumberAlphabetically}" Margin="0,4,0,4">Renumber Files Alphabetically</CheckBox>
                    <CheckBox Grid.Row="5" Grid.Column="1" IsChecked="{Binding IncludeSeasonInFormat}" Margin="0,0,0,4">Format as S01E001 (Include Season)</CheckBox>
                </Grid>
            </TabItem>

            <!-- Cleaning Tab -->
            <TabItem Header="Filename Cleaning">
                <Grid Margin="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <CheckBox Grid.Row="0" IsChecked="{Binding RemoveCommonTokens}" Margin="0,0,0,8">Remove Common Tokens (720, 720p, 1080, 1080p, 4k, 8K, HD)</CheckBox>
                    
                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock VerticalAlignment="Center" Margin="0,0,8,0">Custom Tokens (comma-separated):</TextBlock>
                    </StackPanel>
                    <TextBox Grid.Row="2" Text="{Binding CustomTokens, UpdateSourceTrigger=PropertyChanged}" 
                             TextWrapping="Wrap" AcceptsReturn="True" VerticalScrollBarVisibility="Auto" />
                </Grid>
            </TabItem>

            <!-- Normalization Tab -->
            <TabItem Header="Name Normalization">
                <Grid Margin="8">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="150" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,0,8">Space Handling:</TextBlock>
                    <ComboBox Grid.Row="0" Grid.Column="1" Width="200" HorizontalAlignment="Left" 
                              SelectedItem="{Binding SpaceHandling}" Margin="0,0,0,8">
                        <ComboBox.ItemsSource>
                            <x:Array Type="models:SpaceHandling">
                                <models:SpaceHandling>KeepSpaces</models:SpaceHandling>
                                <models:SpaceHandling>SpacesToDashes</models:SpaceHandling>
                                <models:SpaceHandling>SpacesToUnderscores</models:SpaceHandling>
                                <models:SpaceHandling>RemoveSpaces</models:SpaceHandling>
                            </x:Array>
                        </ComboBox.ItemsSource>
                    </ComboBox>

                    <TextBlock Grid.Row="1" Grid.Column="0" VerticalAlignment="Center">Symbol Conversion:</TextBlock>
                    <ComboBox Grid.Row="1" Grid.Column="1" Width="200" HorizontalAlignment="Left" 
                              SelectedItem="{Binding SymbolConversion}">
                        <ComboBox.ItemsSource>
                            <x:Array Type="models:SymbolConversion">
                                <models:SymbolConversion>None</models:SymbolConversion>
                                <models:SymbolConversion>DashesToSpaces</models:SymbolConversion>
                                <models:SymbolConversion>UnderscoresToSpaces</models:SymbolConversion>
                                <models:SymbolConversion>DashesToUnderscores</models:SymbolConversion>
                                <models:SymbolConversion>UnderscoresToDashes</models:SymbolConversion>
                            </x:Array>
                        </ComboBox.ItemsSource>
                    </ComboBox>
                </Grid>
            </TabItem>
        </TabControl>

        <!-- Preview Grid -->
        <GroupBox Header="Preview" Grid.Row="2" Margin="0,0,0,8">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,4">
                    <Button Content="Select All" Command="{Binding SelectAllCommand}" Width="90" Margin="0,0,4,0" />
                    <Button Content="Select None" Command="{Binding SelectNoneCommand}" Width="90" Margin="0,0,8,0" />
                    <Button Content="Preview Changes" Command="{Binding PreviewChangesCommand}" Width="120" Margin="0,0,8,0" />
                    <Button Content="Apply Changes" Command="{Binding ApplyChangesCommand}" Width="120" Margin="0,0,8,0" />
                    <Button Content="Undo Last" Command="{Binding UndoLastChangesCommand}" Width="90" Margin="0,0,8,0" />
                    <Button Content="Reset Options" Command="{Binding ResetOptionsCommand}" Width="100" />
                </StackPanel>

                <ScrollViewer Grid.Row="1" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto">
                    <DataGrid ItemsSource="{Binding Operations}" AutoGenerateColumns="False" 
                              CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="False"
                              CanUserResizeColumns="True" CanUserSortColumns="True"
                              HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Disabled"
                              ColumnWidth="*">
                        <DataGrid.Columns>
                            <DataGridCheckBoxColumn Header="Select" Binding="{Binding IsSelected}" Width="60" CanUserResize="True" MinWidth="50" />
                            <DataGridTextColumn Header="Original Name" Binding="{Binding OriginalFileName}" Width="250" IsReadOnly="True" CanUserResize="True" MinWidth="120" />
                            <DataGridTextColumn Header="Proposed Name" Binding="{Binding ProposedFileName}" Width="250" IsReadOnly="True" CanUserResize="True" MinWidth="120" />
                            <DataGridTextColumn Header="Directory" Binding="{Binding Directory}" Width="300" IsReadOnly="True" CanUserResize="True" MinWidth="100" />
                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80" IsReadOnly="True" CanUserResize="True" MinWidth="60" />
                            <DataGridTextColumn Header="Error" Binding="{Binding ErrorMessage}" Width="150" IsReadOnly="True" CanUserResize="True" MinWidth="80" />
                        </DataGrid.Columns>
                    </DataGrid>
                </ScrollViewer>
            </Grid>
        </GroupBox>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusMessage}" />
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <ProgressBar Width="150" Height="16" IsIndeterminate="{Binding IsProcessing}" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>
