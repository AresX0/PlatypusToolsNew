<UserControl x:Class="PlatypusTools.UI.Views.BatchJobQueueView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:PlatypusTools.UI.ViewModels"
             Background="{DynamicResource WindowBackgroundBrush}"
             Foreground="{DynamicResource WindowForegroundBrush}">
    
    <UserControl.DataContext>
        <vm:BatchJobQueueViewModel/>
    </UserControl.DataContext>

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
            <TextBlock Text="ðŸ“‹ Batch Job Queue" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding SummaryText}" Margin="16,0,0,0" VerticalAlignment="Center"
                       Foreground="{DynamicResource SecondaryTextBrush}" FontSize="12"/>
        </StackPanel>

        <!-- Controls -->
        <WrapPanel Grid.Row="1" Margin="0,0,0,8">
            <Button Content="{Binding PauseResumeLabel}" Command="{Binding PauseResumeCommand}" 
                    Padding="12,6" Margin="0,0,8,4" MinWidth="100"
                    Background="#FF2196F3" Foreground="White" FontWeight="SemiBold"/>
            <Button Content="ðŸš« Cancel All" Command="{Binding CancelAllCommand}" 
                    Padding="12,6" Margin="0,0,8,4" MinWidth="100"
                    Background="#FFF44336" Foreground="White" FontWeight="SemiBold"/>
            <Button Content="ðŸ§¹ Clear Finished" Command="{Binding ClearFinishedCommand}" 
                    Padding="12,6" Margin="0,0,8,4" MinWidth="110"
                    Background="#FF9C27B0" Foreground="White" FontWeight="SemiBold"/>
            <StackPanel Orientation="Horizontal" Margin="16,0,0,0" VerticalAlignment="Center">
                <TextBlock Text="Max Concurrent:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <ComboBox SelectedItem="{Binding MaxConcurrent}" Width="50">
                    <ComboBox.Items>
                        <sys:Int32 xmlns:sys="clr-namespace:System;assembly=mscorlib">1</sys:Int32>
                        <sys:Int32 xmlns:sys="clr-namespace:System;assembly=mscorlib">2</sys:Int32>
                        <sys:Int32 xmlns:sys="clr-namespace:System;assembly=mscorlib">3</sys:Int32>
                        <sys:Int32 xmlns:sys="clr-namespace:System;assembly=mscorlib">4</sys:Int32>
                        <sys:Int32 xmlns:sys="clr-namespace:System;assembly=mscorlib">6</sys:Int32>
                        <sys:Int32 xmlns:sys="clr-namespace:System;assembly=mscorlib">8</sys:Int32>
                    </ComboBox.Items>
                </ComboBox>
            </StackPanel>
        </WrapPanel>

        <!-- Job List -->
        <DataGrid Grid.Row="2" ItemsSource="{Binding Jobs}" AutoGenerateColumns="False" 
                  IsReadOnly="True" CanUserAddRows="False" CanUserDeleteRows="False"
                  SelectionMode="Single" HeadersVisibility="Column"
                  Background="{DynamicResource ControlBackgroundBrush}"
                  RowBackground="{DynamicResource ControlBackgroundBrush}"
                  AlternatingRowBackground="{DynamicResource WindowBackgroundBrush}"
                  BorderBrush="{DynamicResource ControlBorderBrush}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="" Binding="{Binding StatusIcon}" Width="30"/>
                <DataGridTextColumn Header="" Binding="{Binding TypeIcon}" Width="30"/>
                <DataGridTextColumn Header="Job Name" Binding="{Binding Name}" Width="*" MinWidth="200">
                    <DataGridTextColumn.ElementStyle>
                        <Style TargetType="TextBlock">
                            <Setter Property="TextTrimming" Value="CharacterEllipsis"/>
                            <Setter Property="ToolTip" Value="{Binding Name}"/>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn Header="Status" Binding="{Binding StatusMessage}" Width="100"/>
                <DataGridTemplateColumn Header="Progress" Width="150" MinWidth="120">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid Margin="4,2">
                                <ProgressBar Value="{Binding Progress, Mode=OneWay}" Minimum="0" Maximum="100" Height="16"
                                             Background="#33808080" Foreground="{DynamicResource AccentBrush}"/>
                                <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="10">
                                    <Run Text="{Binding Progress, StringFormat={}{0:F0}, Mode=OneWay}"/><Run Text="%"/>
                                </TextBlock>
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn Header="Priority" Binding="{Binding Priority}" Width="60"/>
                <DataGridTextColumn Header="Duration" Binding="{Binding Duration}" Width="70"/>
                <DataGridTemplateColumn Header="Actions" Width="140" MinWidth="140">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="Cancel" Width="60" Margin="2,0"
                                        Command="{Binding DataContext.CancelJobCommand, 
                                                  RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        Background="#FFF44336" Foreground="White" FontSize="11" Padding="4,2"/>
                                <Button Content="Retry" Width="55" Margin="2,0"
                                        Command="{Binding DataContext.RetryJobCommand, 
                                                  RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}"
                                        Background="#FFFF9800" Foreground="White" FontSize="11" Padding="4,2"/>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Footer with empty-state -->
        <Border Grid.Row="3" Margin="0,4,0,0">
            <TextBlock Text="Tip: Long-running operations (video conversion, image upscaling, file copies) are automatically added to this queue."
                       Foreground="{DynamicResource SecondaryTextBrush}" FontSize="11" FontStyle="Italic"/>
        </Border>
    </Grid>
</UserControl>
