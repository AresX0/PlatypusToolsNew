<UserControl x:Class="PlatypusTools.UI.Views.EnhancedAudioPlayerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:PlatypusTools.UI.ViewModels"
             xmlns:controls="clr-namespace:PlatypusTools.UI.Controls"
             xmlns:converters="clr-namespace:PlatypusTools.UI.Converters"
             xmlns:local="clr-namespace:PlatypusTools.UI.Views"
             Background="{DynamicResource BackgroundBrush}">
    
    <!-- Keyboard Shortcuts -->
    <UserControl.InputBindings>
        <KeyBinding Key="Space" Command="{Binding PlayPauseCommand}"/>
        <KeyBinding Key="Right" Modifiers="Ctrl" Command="{Binding NextCommand}"/>
        <KeyBinding Key="Left" Modifiers="Ctrl" Command="{Binding PreviousCommand}"/>
        <KeyBinding Key="Up" Command="{Binding VolumeUpCommand}"/>
        <KeyBinding Key="Down" Command="{Binding VolumeDownCommand}"/>
        <KeyBinding Key="M" Command="{Binding ToggleMuteCommand}"/>
        <KeyBinding Key="S" Command="{Binding ToggleShuffleCommand}"/>
        <KeyBinding Key="R" Command="{Binding CycleRepeatCommand}"/>
        <KeyBinding Key="O" Modifiers="Ctrl" Command="{Binding OpenFileCommand}"/>
    </UserControl.InputBindings>
    
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <converters:BoolToOpacityConverter x:Key="BoolToOpacityConverter"/>
        <converters:IntToBoolConverter x:Key="IntToBoolConverter"/>
        <converters:BoolToColorConverter x:Key="BoolToColorConverter"/>
        <converters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVis"/>
        <converters:RatingToStarColorConverter x:Key="RatingToStarColorConverter"/>
        
        <!-- Star Rating Template -->
        <ControlTemplate x:Key="StarRatingTemplate" TargetType="ItemsControl">
            <StackPanel Orientation="Horizontal" IsItemsHost="True"/>
        </ControlTemplate>
        
        <!-- EQ Slider Style -->
        <Style x:Key="EqSliderStyle" TargetType="Slider">
            <Setter Property="Orientation" Value="Vertical"/>
            <Setter Property="Height" Value="120"/>
            <Setter Property="Minimum" Value="-12"/>
            <Setter Property="Maximum" Value="12"/>
            <Setter Property="TickFrequency" Value="3"/>
            <Setter Property="TickPlacement" Value="Both"/>
            <Setter Property="IsSnapToTickEnabled" Value="False"/>
            <Setter Property="Margin" Value="4,0"/>
        </Style>
        
        <!-- Speed Button Style -->
        <Style x:Key="SpeedButtonStyle" TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
            <Setter Property="MinWidth" Value="45"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Padding" Value="6,4"/>
        </Style>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header (Slim) -->
        <Border Grid.Row="0" Background="{DynamicResource HeaderBrush}" Padding="10,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Text="ðŸŽµ Enhanced Audio Player" FontSize="14" FontWeight="SemiBold" 
                           Foreground="{DynamicResource TextPrimaryBrush}" VerticalAlignment="Center"/>
                
                <!-- Menu Bar -->
                <Menu Grid.Column="1" Background="Transparent" VerticalAlignment="Center" Margin="15,0,0,0">
                    <MenuItem Header="_File">
                        <MenuItem Header="ðŸ“‚ Open Files..." Command="{Binding OpenFileCommand}" InputGestureText="Ctrl+O"/>
                        <MenuItem Header="ðŸ“ Open Folder..." Command="{Binding OpenFolderCommand}"/>
                        <Separator/>
                        <MenuItem Header="ðŸ’¾ Save Playlist..." Command="{Binding CreatePlaylistCommand}"/>
                        <Separator/>
                        <MenuItem Header="ðŸ”„ Scan Library" Command="{Binding ScanAllLibraryFoldersCommand}"/>
                    </MenuItem>
                    <MenuItem Header="_Playback">
                        <MenuItem Header="â–¶ Play/Pause" Command="{Binding PlayPauseCommand}" InputGestureText="Space"/>
                        <MenuItem Header="â¹ Stop" Command="{Binding StopCommand}"/>
                        <MenuItem Header="â­ Next" Command="{Binding NextCommand}" InputGestureText="Ctrl+Right"/>
                        <MenuItem Header="â® Previous" Command="{Binding PreviousCommand}" InputGestureText="Ctrl+Left"/>
                        <Separator/>
                        <MenuItem Header="ðŸ”€ Toggle Shuffle" Command="{Binding ToggleShuffleCommand}" InputGestureText="S"/>
                        <MenuItem Header="ðŸ” Cycle Repeat" Command="{Binding CycleRepeatCommand}" InputGestureText="R"/>
                        <Separator/>
                        <MenuItem Header="ðŸ”Š Volume Up" Command="{Binding VolumeUpCommand}" InputGestureText="Up"/>
                        <MenuItem Header="ðŸ”‰ Volume Down" Command="{Binding VolumeDownCommand}" InputGestureText="Down"/>
                        <MenuItem Header="ðŸ”‡ Toggle Mute" Command="{Binding ToggleMuteCommand}" InputGestureText="M"/>
                    </MenuItem>
                    <MenuItem Header="_Queue">
                        <MenuItem Header="âž• Add to Queue" Command="{Binding OpenFileCommand}"/>
                        <MenuItem Header="âž• Add All to Queue" Command="{Binding AddAllToQueueCommand}"/>
                        <Separator/>
                        <MenuItem Header="ðŸ—‘ï¸ Clear Queue" Command="{Binding ClearQueueCommand}"/>
                    </MenuItem>
                    <MenuItem Header="_Tools">
                        <MenuItem Header="ðŸŽšï¸ Equalizer" IsCheckable="True" IsChecked="{Binding ShowEqualizer, Mode=TwoWay, FallbackValue=False}"/>
                        <MenuItem Header="ðŸŽ§ Auto DJ" IsCheckable="True" IsChecked="{Binding AutoDjEnabled}"/>
                        <Separator/>
                        <MenuItem Header="ðŸ”„ Audio Converter" Command="{Binding ConvertTrackCommand}"/>
                        <Separator/>
                        <MenuItem Header="ðŸ’¤ Sleep Timer">
                            <MenuItem Header="Off" Command="{Binding CancelSleepTimerCommand}"/>
                            <MenuItem Header="15 minutes" Command="{Binding SetSleepTimerCommand}" CommandParameter="15"/>
                            <MenuItem Header="30 minutes" Command="{Binding SetSleepTimerCommand}" CommandParameter="30"/>
                            <MenuItem Header="45 minutes" Command="{Binding SetSleepTimerCommand}" CommandParameter="45"/>
                            <MenuItem Header="60 minutes" Command="{Binding SetSleepTimerCommand}" CommandParameter="60"/>
                            <MenuItem Header="End of track" Command="{Binding SetSleepTimerCommand}" CommandParameter="0"/>
                        </MenuItem>
                    </MenuItem>
                </Menu>
                
                <!-- Quick Toggle Buttons (Right side of header) -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <ToggleButton IsChecked="{Binding ShowEqualizer}" 
                                  ToolTip="Toggle Equalizer (E)" MinWidth="32" Height="26" Padding="4,2"
                                  Background="Transparent" BorderThickness="1" BorderBrush="#666">
                        <TextBlock Text="ðŸŽšï¸" FontSize="12"/>
                    </ToggleButton>
                    <ToggleButton IsChecked="{Binding ShowFileInfo}" 
                                  Command="{Binding ToggleFileInfoCommand}"
                                  ToolTip="Toggle File Info" MinWidth="32" Height="26" Margin="4,0,0,0" Padding="4,2"
                                  Background="Transparent" BorderThickness="1" BorderBrush="#666">
                        <TextBlock Text="â„¹ï¸" FontSize="12"/>
                    </ToggleButton>
                    <ToggleButton IsChecked="{Binding AutoDjEnabled}" 
                                  Command="{Binding ToggleAutoDjCommand}"
                                  ToolTip="Toggle Auto DJ" MinWidth="32" Height="26" Margin="4,0,0,0" Padding="4,2"
                                  Background="Transparent" BorderThickness="1" BorderBrush="#666">
                        <TextBlock Text="ðŸŽ§" FontSize="12"/>
                    </ToggleButton>
                    <Button Content="ðŸ”²" Command="{Binding ToggleMiniPlayerCommand}"
                            ToolTip="Toggle Mini Player" MinWidth="32" Height="26" Margin="8,0,0,0" Padding="4,2"
                            Background="Transparent" BorderThickness="1" BorderBrush="#666"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content - New Layout -->
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="2*" MinHeight="150"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="3*" MinHeight="250"/>
            </Grid.RowDefinitions>
            
            <!-- TOP: Full-width Visualizer -->
            <Grid Grid.Row="0" Visibility="{Binding IsMiniPlayerMode, Converter={StaticResource InverseBoolToVis}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Visualizer Display -->
                <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" Margin="10,5,10,0" CornerRadius="8,8,0,0">
                    <Grid>
                        <local:AudioVisualizerView x:Name="VisualizerControl"/>
                        
                        <!-- Lyrics Overlay on Visualizer -->
                        <Border Background="#80000000" CornerRadius="8" Margin="20,0,20,30"
                                VerticalAlignment="Bottom" HorizontalAlignment="Center" Padding="20,10"
                                Visibility="{Binding ShowLyricsOverlay, Converter={StaticResource BoolToVis}}">
                            <TextBlock Text="{Binding CurrentLyricLineText}" FontSize="20" FontWeight="SemiBold"
                                       Foreground="White" TextAlignment="Center" TextWrapping="Wrap" MaxWidth="600"/>
                        </Border>
                    </Grid>
                </Border>
                
                <!-- Visualizer Controls Bar (Below Visualizer) -->
                <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" Margin="10,0,10,0" 
                        CornerRadius="0,0,8,8" Padding="10,6">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                        <!-- Visualizer Mode -->
                        <TextBlock Text="Mode:" FontSize="11" VerticalAlignment="Center" Margin="0,0,5,0"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                        <ComboBox ItemsSource="{Binding VisualizerModes}" SelectedIndex="{Binding VisualizerModeIndex}"
                                  Width="90" FontSize="11" Margin="0,0,15,0" ToolTip="Visualizer Mode"/>
                        
                        <!-- Color Scheme -->
                        <TextBlock Text="Color:" FontSize="11" VerticalAlignment="Center" Margin="0,0,5,0"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                        <ComboBox ItemsSource="{Binding ColorSchemes}" SelectedIndex="{Binding ColorSchemeIndex}"
                                  Width="90" FontSize="11" Margin="0,0,15,0" ToolTip="Color Scheme"/>
                        
                        <!-- Density (bars for bar modes, stars for starfield, etc) -->
                        <TextBlock Text="Density:" FontSize="11" VerticalAlignment="Center" Margin="0,0,5,0"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                        <ComboBox ItemsSource="{Binding DensityOptions}" SelectedItem="{Binding Density}"
                                  Width="55" FontSize="11" Margin="0,0,10,0" ToolTip="Density (bars, stars, or particles depending on mode)"/>
                        
                        <!-- FPS -->
                        <TextBlock Text="FPS:" FontSize="11" VerticalAlignment="Center" Margin="0,0,5,0"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                        <ComboBox ItemsSource="{Binding FpsOptions}" SelectedItem="{Binding VisualizerFps}"
                                  Width="50" FontSize="11" Margin="0,0,10,0" ToolTip="Target Frame Rate (higher = smoother but uses more CPU)"/>
                        
                        <!-- Sensitivity Slider -->
                        <TextBlock Text="Sens:" FontSize="11" VerticalAlignment="Center" Margin="0,0,3,0"
                                   Foreground="{DynamicResource TextSecondaryBrush}" ToolTip="Visualizer Sensitivity"/>
                        <Slider Value="{Binding VisualizerSensitivity}" Minimum="0.1" Maximum="2.0" 
                                Width="60" VerticalAlignment="Center" Margin="0,0,10,0"
                                ToolTip="Sensitivity: Low = Smooth, High = Responsive"/>
                        
                        <!-- Crawl Speed Slider (for Star Wars mode) -->
                        <TextBlock Text="Crawl:" FontSize="11" VerticalAlignment="Center" Margin="0,0,3,0"
                                   Foreground="{DynamicResource TextSecondaryBrush}" ToolTip="Star Wars Crawl Speed"/>
                        <Slider Value="{Binding CrawlScrollSpeed}" Minimum="0.25" Maximum="3.0" 
                                Width="50" VerticalAlignment="Center" Margin="0,0,10,0"
                                ToolTip="Star Wars Crawl Speed: 0.25x - 3.0x"/>
                        
                        <!-- Lyrics Overlay Toggle -->
                        <ToggleButton Content="ðŸ“ Lyrics" IsChecked="{Binding ShowLyricsOverlay}" 
                                      Padding="6,4" FontSize="11" MinWidth="75" Margin="0,0,10,0"
                                      ToolTip="Show Lyrics on Visualizer"/>
                        
                        <!-- Fullscreen Button -->
                        <Button FontSize="11" Padding="6,4"
                                ToolTip="Toggle Fullscreen Visualizer (Esc to exit)"
                                Click="OnToggleFullscreenVisualizerClick">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="â›¶" FontSize="12" FontWeight="Bold" Margin="0,0,4,0"/>
                                <TextBlock Text="Fullscreen" FontSize="11"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- Screensaver Button -->
                        <Button FontSize="11" Margin="5,0,0,0" Padding="6,4"
                                Command="{Binding LaunchScreensaverCommand}"
                                ToolTip="Launch as Screensaver (fullscreen, exits on mouse/key)">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="ðŸŒ™" FontSize="12" Margin="0,0,4,0"/>
                                <TextBlock Text="Screensaver" FontSize="11"/>
                            </StackPanel>
                        </Button>
                        
                        <!-- Install as Windows Screensaver -->
                        <Button FontSize="11" Margin="5,0,0,0" Padding="6,4"
                                Command="{Binding InstallScreensaverCommand}"
                                Background="#9C27B0" Foreground="White" BorderThickness="0"
                                ToolTip="Install as Windows Screensaver (requires admin)">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="âš™" FontSize="12" Margin="0,0,4,0"/>
                                <TextBlock Text="Install" FontSize="11"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>
            
            <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Center"
                          Background="#444444" Cursor="SizeNS" ResizeBehavior="PreviousAndNext"
                          Visibility="{Binding IsMiniPlayerMode, Converter={StaticResource InverseBoolToVis}}"/>
            
            <!-- BOTTOM: 2-Column Layout -->
            <Grid Grid.Row="2" Visibility="{Binding IsMiniPlayerMode, Converter={StaticResource InverseBoolToVis}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="280" MinWidth="220"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*" MinWidth="400"/>
                </Grid.ColumnDefinitions>
                
                <!-- LEFT COLUMN: Album Art + Play Controls -->
                <Border Grid.Column="0" Background="{DynamicResource SurfaceBrush}" Margin="10,5,0,10" CornerRadius="8" Padding="10">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <!-- Album Art -->
                            <Border Width="180" Height="180" CornerRadius="8" 
                                    Background="{DynamicResource BackgroundBrush}" Margin="0,0,0,10" HorizontalAlignment="Center">
                                <Grid>
                                    <TextBlock Text="ðŸŽµ" FontSize="60" HorizontalAlignment="Center" VerticalAlignment="Center"
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               Visibility="{Binding AlbumArtImage, Converter={StaticResource InverseBoolToVis}, ConverterParameter=null}"/>
                                    <Image Source="{Binding AlbumArtImage}" Stretch="UniformToFill"/>
                                </Grid>
                            </Border>
                            
                            <!-- Track Info (Clickable to scroll to queue) -->
                            <StackPanel Margin="0,0,0,8" ToolTip="Click to scroll to track in queue" HorizontalAlignment="Center">
                                <Button Command="{Binding ScrollToCurrentTrackCommand}" Cursor="Hand"
                                        Background="Transparent" BorderThickness="0" HorizontalAlignment="Center">
                                    <StackPanel>
                                        <TextBlock Text="{Binding CurrentTrackTitle}" FontSize="14" FontWeight="SemiBold"
                                                   TextTrimming="CharacterEllipsis" TextAlignment="Center" MaxWidth="250"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                                   TextDecorations="Underline"/>
                                        <TextBlock Text="{Binding CurrentTrackArtist}" FontSize="12"
                                                   TextTrimming="CharacterEllipsis" TextAlignment="Center"
                                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                            
                            <!-- Star Rating (Click to set) -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,8">
                                <Button Content="â˜…" Command="{Binding SetRatingCommand}" CommandParameter="1"
                                        FontSize="18" Background="Transparent" BorderThickness="0" Padding="2" Cursor="Hand"
                                        Foreground="{Binding CurrentTrackRating, Converter={StaticResource RatingToStarColorConverter}, ConverterParameter=1}"
                                        ToolTip="Rate 1 star"/>
                                <Button Content="â˜…" Command="{Binding SetRatingCommand}" CommandParameter="2"
                                        FontSize="18" Background="Transparent" BorderThickness="0" Padding="2" Cursor="Hand"
                                        Foreground="{Binding CurrentTrackRating, Converter={StaticResource RatingToStarColorConverter}, ConverterParameter=2}"
                                        ToolTip="Rate 2 stars"/>
                                <Button Content="â˜…" Command="{Binding SetRatingCommand}" CommandParameter="3"
                                        FontSize="18" Background="Transparent" BorderThickness="0" Padding="2" Cursor="Hand"
                                        Foreground="{Binding CurrentTrackRating, Converter={StaticResource RatingToStarColorConverter}, ConverterParameter=3}"
                                        ToolTip="Rate 3 stars"/>
                                <Button Content="â˜…" Command="{Binding SetRatingCommand}" CommandParameter="4"
                                        FontSize="18" Background="Transparent" BorderThickness="0" Padding="2" Cursor="Hand"
                                        Foreground="{Binding CurrentTrackRating, Converter={StaticResource RatingToStarColorConverter}, ConverterParameter=4}"
                                        ToolTip="Rate 4 stars"/>
                                <Button Content="â˜…" Command="{Binding SetRatingCommand}" CommandParameter="5"
                                        FontSize="18" Background="Transparent" BorderThickness="0" Padding="2" Cursor="Hand"
                                        Foreground="{Binding CurrentTrackRating, Converter={StaticResource RatingToStarColorConverter}, ConverterParameter=5}"
                                        ToolTip="Rate 5 stars"/>
                                <TextBlock Text="{Binding CurrentTrackRating, StringFormat=({0}/5)}" 
                                           VerticalAlignment="Center" Margin="5,0,0,0" FontSize="11"
                                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                            </StackPanel>
                            
                            <!-- Progress Bar -->
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="35"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="35"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="{Binding PositionDisplay}" FontSize="10"
                                           Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                                <Slider Grid.Column="1" Value="{Binding PositionSeconds}" Maximum="{Binding DurationSeconds}"
                                        VerticalAlignment="Center" Margin="3,0"/>
                                <TextBlock Grid.Column="2" Text="{Binding DurationDisplay}" FontSize="10"
                                           Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center" HorizontalAlignment="Right"/>
                            </Grid>
                            
                            <!-- Playback Controls -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,8">
                                <Button Content="ðŸ”€" Command="{Binding ToggleShuffleCommand}" ToolTip="Shuffle"
                                        MinWidth="36" Height="36" Margin="2" Padding="6,4"
                                        Opacity="{Binding IsShuffle, Converter={StaticResource BoolToOpacityConverter}, FallbackValue=0.5}"/>
                                <Button Content="â®" Command="{Binding PreviousCommand}" ToolTip="Previous"
                                        MinWidth="40" Height="40" Margin="2" Padding="6,4"/>
                                <Button Content="{Binding PlayPauseIcon}" Command="{Binding PlayPauseCommand}" 
                                        ToolTip="Play/Pause" FontSize="18"
                                        MinWidth="48" Height="48" Margin="2" Padding="8,6"/>
                                <Button Content="â¹" Command="{Binding StopCommand}" ToolTip="Stop"
                                        MinWidth="40" Height="40" Margin="2" Padding="6,4"/>
                                <Button Content="â­" Command="{Binding NextCommand}" ToolTip="Next"
                                        MinWidth="40" Height="40" Margin="2" Padding="6,4"/>
                                <Button Content="{Binding RepeatIcon}" Command="{Binding CycleRepeatCommand}" ToolTip="Repeat Mode"
                                        MinWidth="36" Height="36" Margin="2" Padding="6,4"/>
                            </StackPanel>
                            
                            <!-- Volume -->
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="35"/>
                                </Grid.ColumnDefinitions>
                                <Button Command="{Binding ToggleMuteCommand}" Width="26" Height="26" Background="Transparent" BorderThickness="0">
                                    <TextBlock FontSize="12">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Text" Value="ðŸ”Š"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsMuted}" Value="True">
                                                        <Setter Property="Text" Value="ðŸ”‡"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Button>
                                <Slider Grid.Column="1" Value="{Binding Volume}" Maximum="1" VerticalAlignment="Center" Margin="3,0"/>
                                <TextBlock Grid.Column="2" Text="{Binding VolumePercent, StringFormat={}{0}%}" 
                                           VerticalAlignment="Center" HorizontalAlignment="Right" FontSize="10"
                                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                            </Grid>
                            
                            <!-- Speed Control (compact) -->
                            <Expander Header="â±ï¸ Speed" IsExpanded="False" Padding="3">
                                <WrapPanel HorizontalAlignment="Center">
                                    <Button Content="0.5x" Click="SpeedButton_Click" Tag="0.5" MinWidth="44" Margin="1" Padding="4,2"/>
                                    <Button Content="0.75x" Click="SpeedButton_Click" Tag="0.75" MinWidth="44" Margin="1" Padding="4,2"/>
                                    <Button Content="1x" Click="SpeedButton_Click" Tag="1.0" MinWidth="44" Margin="1" Padding="4,2"/>
                                    <Button Content="1.25x" Click="SpeedButton_Click" Tag="1.25" MinWidth="44" Margin="1" Padding="4,2"/>
                                    <Button Content="1.5x" Click="SpeedButton_Click" Tag="1.5" MinWidth="44" Margin="1" Padding="4,2"/>
                                    <Button Content="2x" Click="SpeedButton_Click" Tag="2.0" MinWidth="44" Margin="1" Padding="4,2"/>
                                </WrapPanel>
                            </Expander>
                            
                            <!-- Sleep Timer (compact) -->
                            <Border Background="{DynamicResource BackgroundBrush}" CornerRadius="3" Padding="5" Margin="0,5,0,0"
                                    Visibility="{Binding SleepTimerEnabled, Converter={StaticResource BoolToVis}}">
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                    <TextBlock Text="ðŸ’¤" FontSize="11" VerticalAlignment="Center" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding SleepTimerStatusText}" FontSize="10" VerticalAlignment="Center"/>
                                    <Button Content="âœ•" Width="22" Height="22" FontSize="11"
                                            Command="{Binding CancelSleepTimerCommand}"
                                            Background="Transparent" BorderThickness="0" Margin="5,0,0,0"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Border>
                
                <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch"
                              Background="#444444" Cursor="SizeWE" ResizeBehavior="PreviousAndNext"/>
                
                <!-- MIDDLE COLUMN: All Tabs -->
                <TabControl Grid.Column="2" Margin="0,5,10,10">
                    
                    <!-- Queue Tab -->
                    <TabItem Header="ðŸ“‹ Queue">
                        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="0,0,8,8" Padding="10">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,8">
                                    <Button Content="âž• Files" Command="{Binding OpenFileCommand}" Margin="0,0,4,0"/>
                                    <Button Content="ðŸ“‚ Folder" Command="{Binding OpenFolderCommand}" Margin="0,0,4,0"/>
                                    <Button Content="ðŸ—‘ï¸ Clear" Command="{Binding ClearQueueCommand}"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8">
                                    <TextBlock Text="Sort: " VerticalAlignment="Center" FontSize="11" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                    <ComboBox ItemsSource="{Binding QueueSortOptions}" SelectedItem="{Binding QueueSortBy}" Width="90"/>
                                </StackPanel>
                                
                                <!-- Scroll Up Button -->
                                <Button Grid.Row="2" Content="â–²" Height="24" VerticalAlignment="Top" Margin="0,0,0,0"
                                        Click="QueueScrollUp_Click" ToolTip="Scroll Up" Panel.ZIndex="1" Opacity="0.8"/>
                                
                                <ListBox x:Name="QueueListBox" Grid.Row="2" ItemsSource="{Binding Queue}" SelectedItem="{Binding SelectedQueueTrack}"
                                         AllowDrop="True" Margin="0,26,0,26"
                                         PreviewMouseLeftButtonDown="Queue_PreviewMouseLeftButtonDown"
                                         Drop="Queue_Drop"
                                         VirtualizingStackPanel.IsVirtualizing="True"
                                         VirtualizingStackPanel.VirtualizationMode="Recycling"
                                         Background="Transparent" BorderThickness="0">
                                    <ListBox.ItemContainerStyle>
                                        <Style TargetType="ListBoxItem">
                                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                        </Style>
                                    </ListBox.ItemContainerStyle>
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="2">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding DisplayTitle}" FontWeight="SemiBold" TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Text="{Binding DisplayArtist}" FontSize="11" Foreground="Gray" TextTrimming="CharacterEllipsis"/>
                                                </StackPanel>
                                                <TextBlock Grid.Column="1" Text="{Binding DurationFormatted}" VerticalAlignment="Center"
                                                           HorizontalAlignment="Right" Margin="10,0" Foreground="Gray" FontSize="11"/>
                                                <Button Grid.Column="2" Width="32" Height="24" Margin="4,0"
                                                        Background="#2196F3" Foreground="White" BorderThickness="0"
                                                        ToolTip="Play this track"
                                                        Command="{Binding DataContext.PlayTrackCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                        CommandParameter="{Binding}">
                                                    <TextBlock Text="â–¶" FontSize="11"/>
                                                </Button>
                                                <Button Grid.Column="3" Width="32" Height="24" Margin="0"
                                                        Background="#f44336" Foreground="White" BorderThickness="0"
                                                        ToolTip="Remove from queue"
                                                        Command="{Binding DataContext.RemoveFromQueueCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                                        CommandParameter="{Binding}">
                                                    <TextBlock Text="âœ•" FontSize="11" FontWeight="Bold"/>
                                                </Button>
                                            </Grid>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                    <ListBox.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="â–¶ Play" Command="{Binding PlayTrackCommand}" CommandParameter="{Binding SelectedQueueTrack}"/>
                                            <MenuItem Header="âŒ Remove" Command="{Binding RemoveFromQueueCommand}" CommandParameter="{Binding SelectedQueueTrack}"/>
                                        </ContextMenu>
                                    </ListBox.ContextMenu>
                                    <ListBox.InputBindings>
                                        <MouseBinding Gesture="LeftDoubleClick" Command="{Binding PlayTrackCommand}" CommandParameter="{Binding SelectedQueueTrack}"/>
                                    </ListBox.InputBindings>
                                </ListBox>
                                
                                <!-- Scroll Down Button -->
                                <Button Grid.Row="2" Content="â–¼" Height="24" VerticalAlignment="Bottom"
                                        Click="QueueScrollDown_Click" ToolTip="Scroll Down" Panel.ZIndex="1" Opacity="0.8"/>
                                
                                <TextBlock Grid.Row="3" Text="{Binding Queue.Count, StringFormat={}{0} tracks}" 
                                           FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,5,0,0"/>
                            </Grid>
                        </Border>
                    </TabItem>
                    
                    <!-- Library Tab -->
                    <TabItem Header="ðŸ“š Library">
                        <Border Background="{DynamicResource SurfaceBrush}" CornerRadius="0,0,8,8" Padding="10">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" MaxHeight="250"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Scrollable area for folder management and playlists -->
                                <ScrollViewer Grid.Row="0" VerticalScrollBarVisibility="Auto" MaxHeight="250">
                                    <StackPanel>
                                        <!-- Library Folder Management -->
                                        <Expander Header="ðŸ“‚ Library Folders" IsExpanded="True" Margin="0,0,0,8">
                                            <StackPanel Margin="5">
                                                <ListBox ItemsSource="{Binding LibraryFolders}" 
                                                         SelectedItem="{Binding SelectedLibraryFolder}"
                                                         MaxHeight="80" Margin="0,0,0,5"
                                                         HorizontalContentAlignment="Stretch">
                                                    <ListBox.ItemTemplate>
                                                        <DataTemplate>
                                                            <TextBlock Text="{Binding}" TextTrimming="CharacterEllipsis" FontSize="11" ToolTip="{Binding}"/>
                                                        </DataTemplate>
                                                    </ListBox.ItemTemplate>
                                                </ListBox>
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                                    <Button Content="ðŸ“ Add Folder" Command="{Binding AddLibraryFolderCommand}" 
                                                            Margin="0,0,5,0" FontSize="11"/>
                                                    <Button Content="âœ• Remove" Command="{Binding RemoveLibraryFolderCommand}" 
                                                            FontSize="11"/>
                                                </StackPanel>
                                                <StackPanel Orientation="Horizontal">
                                                    <Button Content="ðŸ”„ Scan All Folders" Command="{Binding ScanAllLibraryFoldersCommand}" 
                                                            Margin="0,0,5,0" FontWeight="Bold" FontSize="11"/>
                                                    <CheckBox Content="Include Subfolders" IsChecked="{Binding IncludeSubfolders}" 
                                                              VerticalAlignment="Center" FontSize="11"/>
                                                </StackPanel>
                                                <ProgressBar Value="{Binding ScanProgress}" IsIndeterminate="{Binding IsScanning}" 
                                                             Height="12" Margin="0,5,0,0"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                    <TextBlock Text="Tracks: " FontSize="10" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding LibraryTrackCount, FallbackValue=0}" FontSize="10" Margin="0,0,10,0"/>
                                                    <TextBlock Text="Artists: " FontSize="10" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding LibraryArtistCount, FallbackValue=0}" FontSize="10" Margin="0,0,10,0"/>
                                                    <TextBlock Text="Albums: " FontSize="10" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding LibraryAlbumCount, FallbackValue=0}" FontSize="10"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Expander>
                                        
                                        <!-- Playlists Section -->
                                        <Expander Header="ðŸŽµ Playlists" IsExpanded="True" Margin="0,0,0,8">
                                            <StackPanel Margin="5">
                                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                                    <Button Content="ðŸ“š Show All" Command="{Binding ShowLibraryFromPlaylistCommand}" 
                                                            Margin="0,0,5,0" FontSize="11" ToolTip="Return to full library view"/>
                                                    <Button Content="âž• New Playlist" Command="{Binding CreatePlaylistCommand}" 
                                                            Margin="0,0,5,0" FontSize="11"/>
                                                    <Button Content="âœï¸ Rename" Command="{Binding RenamePlaylistCommand}" 
                                                            Margin="0,0,5,0" FontSize="11"/>
                                                    <Button Content="ðŸ—‘ï¸ Delete" Command="{Binding DeletePlaylistCommand}" 
                                                            FontSize="11"/>
                                                </StackPanel>
                                                <ItemsControl ItemsSource="{Binding SmartPlaylists}">
                                                    <ItemsControl.ItemsPanel>
                                                        <ItemsPanelTemplate>
                                                            <WrapPanel/>
                                                        </ItemsPanelTemplate>
                                                    </ItemsControl.ItemsPanel>
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <StackPanel Orientation="Horizontal" Margin="0,0,5,3">
                                                                <Button Content="â–¶" Padding="4,3" Margin="0,0,2,0" FontSize="10"
                                                                        Command="{Binding DataContext.PlayPlaylistCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                        CommandParameter="{Binding}" ToolTip="Play this playlist"/>
                                                                <ToggleButton Content="{Binding Name}" Padding="8,3" FontSize="11"
                                                                              IsChecked="{Binding IsSelected, Mode=TwoWay}"
                                                                              Command="{Binding DataContext.LoadPlaylistCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                              CommandParameter="{Binding}"/>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </StackPanel>
                                        </Expander>
                                    </StackPanel>
                                </ScrollViewer>
                                
                                <!-- Search & Actions -->
                                <Grid Grid.Row="1" Margin="0,0,0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBox Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}" 
                                             Padding="6,4" FontSize="11" ToolTip="Search by title, artist, or album"/>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="5,0,0,0">
                                        <Button Content="â–¶ Play" Command="{Binding PlaySelectedCommand}" FontSize="11"/>
                                        <Button Content="âž• Add to Queue" Command="{Binding AddToQueueCommand}" 
                                                CommandParameter="{Binding SelectedLibraryTrack}" Margin="3,0,0,0" FontSize="11"/>
                                        <Button Content="âž• All" Command="{Binding AddAllToQueueCommand}" 
                                                Margin="3,0,0,0" FontSize="11" ToolTip="Add all displayed tracks to queue"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="10,0,0,0">
                                        <Button Content="ðŸ—‘ï¸" Command="{Binding RemoveSelectedTracksFromLibraryCommand}" 
                                                FontSize="11" ToolTip="Remove selected track from library" Foreground="#FF9800"/>
                                        <Button Content="ðŸ§¹" Command="{Binding RemoveMissingTracksCommand}" 
                                                Margin="3,0,0,0" FontSize="11" ToolTip="Remove tracks with missing files"/>
                                        <Button Content="ðŸ—‘ï¸ Clear" Command="{Binding ClearLibraryCommand}" 
                                                Margin="3,0,0,0" FontSize="11" ToolTip="Clear entire library" Foreground="#F44336"/>
                                    </StackPanel>
                                </Grid>
                                
                                <!-- Track List - DataGrid handles its own scrolling, virtualization works properly -->
                                <DataGrid Grid.Row="2" ItemsSource="{Binding LibraryTracks}" 
                                          SelectedItem="{Binding SelectedLibraryTrack}"
                                          AutoGenerateColumns="False" IsReadOnly="True"
                                          CanUserSortColumns="True" GridLinesVisibility="Horizontal"
                                          VirtualizingStackPanel.IsVirtualizing="True"
                                          VirtualizingStackPanel.VirtualizationMode="Recycling"
                                          EnableRowVirtualization="True" FontSize="11"
                                          ScrollViewer.CanContentScroll="True">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="Title" Binding="{Binding DisplayTitle}" Width="*"/>
                                        <DataGridTextColumn Header="Artist" Binding="{Binding DisplayArtist}" Width="80"/>
                                        <DataGridTextColumn Header="Duration" Binding="{Binding DurationFormatted}" Width="50"/>
                                    </DataGrid.Columns>
                                    <DataGrid.ContextMenu>
                                        <ContextMenu>
                                            <MenuItem Header="â–¶ Play" Command="{Binding PlaySelectedCommand}"/>
                                            <MenuItem Header="âž• Add to Queue" Command="{Binding AddToQueueCommand}" 
                                                      CommandParameter="{Binding SelectedLibraryTrack}"/>
                                            <Separator/>
                                            <MenuItem Header="ðŸ“‹ Add to Playlist" ItemsSource="{Binding UserPlaylists}">
                                                <MenuItem.ItemContainerStyle>
                                                    <Style TargetType="MenuItem">
                                                        <Setter Property="Header" Value="{Binding Name}"/>
                                                        <Setter Property="Command" Value="{Binding DataContext.AddSelectedToPlaylistCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"/>
                                                        <Setter Property="CommandParameter" Value="{Binding}"/>
                                                    </Style>
                                                </MenuItem.ItemContainerStyle>
                                            </MenuItem>
                                            <Separator/>
                                            <MenuItem Header="ðŸ—‘ï¸ Remove from Library" Command="{Binding RemoveSelectedTracksFromLibraryCommand}" Foreground="#F44336"/>
                                        </ContextMenu>
                                    </DataGrid.ContextMenu>
                                    <DataGrid.InputBindings>
                                        <MouseBinding Gesture="LeftDoubleClick" Command="{Binding PlaySelectedCommand}"/>
                                    </DataGrid.InputBindings>
                                </DataGrid>
                            </Grid>
                        </Border>
                    </TabItem>
                
                <!-- 10-Band Equalizer Tab (AP-006) -->
                <TabItem Header="ðŸŽšï¸ Equalizer">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <Grid Margin="15">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Preset Selector -->
                            <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                                <TextBlock Text="Preset: " VerticalAlignment="Center" Margin="0,0,10,0"/>
                                <ComboBox ItemsSource="{Binding EQPresets}" SelectedItem="{Binding SelectedEqPreset}"
                                          DisplayMemberPath="Name" Width="150"/>
                                <Button Content="Reset" Command="{Binding ResetEqCommand}" Margin="10,0,0,0" Padding="15,5"/>
                            </StackPanel>
                            
                            <!-- 10-Band EQ Sliders -->
                            <Grid Grid.Row="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                
                                <!-- Band 1: 32Hz -->
                                <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Eq32Hz, StringFormat={}{0:+0;-0;0}dB}" HorizontalAlignment="Center" FontSize="10"/>
                                    <Slider Value="{Binding Eq32Hz}" Style="{StaticResource EqSliderStyle}"/>
                                    <TextBlock Text="32Hz" HorizontalAlignment="Center" FontSize="10" FontWeight="Bold"/>
                                </StackPanel>
                                
                                <!-- Band 2: 64Hz -->
                                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Eq64Hz, StringFormat={}{0:+0;-0;0}dB}" HorizontalAlignment="Center" FontSize="10"/>
                                    <Slider Value="{Binding Eq64Hz}" Style="{StaticResource EqSliderStyle}"/>
                                    <TextBlock Text="64Hz" HorizontalAlignment="Center" FontSize="10" FontWeight="Bold"/>
                                </StackPanel>
                                
                                <!-- Band 3: 125Hz -->
                                <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Eq125Hz, StringFormat={}{0:+0;-0;0}dB}" HorizontalAlignment="Center" FontSize="10"/>
                                    <Slider Value="{Binding Eq125Hz}" Style="{StaticResource EqSliderStyle}"/>
                                    <TextBlock Text="125Hz" HorizontalAlignment="Center" FontSize="10" FontWeight="Bold"/>
                                </StackPanel>
                                
                                <!-- Band 4: 250Hz -->
                                <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Eq250Hz, StringFormat={}{0:+0;-0;0}dB}" HorizontalAlignment="Center" FontSize="10"/>
                                    <Slider Value="{Binding Eq250Hz}" Style="{StaticResource EqSliderStyle}"/>
                                    <TextBlock Text="250Hz" HorizontalAlignment="Center" FontSize="10" FontWeight="Bold"/>
                                </StackPanel>
                                
                                <!-- Band 5: 500Hz -->
                                <StackPanel Grid.Column="4" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Eq500Hz, StringFormat={}{0:+0;-0;0}dB}" HorizontalAlignment="Center" FontSize="10"/>
                                    <Slider Value="{Binding Eq500Hz}" Style="{StaticResource EqSliderStyle}"/>
                                    <TextBlock Text="500Hz" HorizontalAlignment="Center" FontSize="10" FontWeight="Bold"/>
                                </StackPanel>
                                
                                <!-- Band 6: 1kHz -->
                                <StackPanel Grid.Column="5" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Eq1kHz, StringFormat={}{0:+0;-0;0}dB}" HorizontalAlignment="Center" FontSize="10"/>
                                    <Slider Value="{Binding Eq1kHz}" Style="{StaticResource EqSliderStyle}"/>
                                    <TextBlock Text="1kHz" HorizontalAlignment="Center" FontSize="10" FontWeight="Bold"/>
                                </StackPanel>
                                
                                <!-- Band 7: 2kHz -->
                                <StackPanel Grid.Column="6" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Eq2kHz, StringFormat={}{0:+0;-0;0}dB}" HorizontalAlignment="Center" FontSize="10"/>
                                    <Slider Value="{Binding Eq2kHz}" Style="{StaticResource EqSliderStyle}"/>
                                    <TextBlock Text="2kHz" HorizontalAlignment="Center" FontSize="10" FontWeight="Bold"/>
                                </StackPanel>
                                
                                <!-- Band 8: 4kHz -->
                                <StackPanel Grid.Column="7" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Eq4kHz, StringFormat={}{0:+0;-0;0}dB}" HorizontalAlignment="Center" FontSize="10"/>
                                    <Slider Value="{Binding Eq4kHz}" Style="{StaticResource EqSliderStyle}"/>
                                    <TextBlock Text="4kHz" HorizontalAlignment="Center" FontSize="10" FontWeight="Bold"/>
                                </StackPanel>
                                
                                <!-- Band 9: 8kHz -->
                                <StackPanel Grid.Column="8" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Eq8kHz, StringFormat={}{0:+0;-0;0}dB}" HorizontalAlignment="Center" FontSize="10"/>
                                    <Slider Value="{Binding Eq8kHz}" Style="{StaticResource EqSliderStyle}"/>
                                    <TextBlock Text="8kHz" HorizontalAlignment="Center" FontSize="10" FontWeight="Bold"/>
                                </StackPanel>
                                
                                <!-- Band 10: 16kHz -->
                                <StackPanel Grid.Column="9" HorizontalAlignment="Center">
                                    <TextBlock Text="{Binding Eq16kHz, StringFormat={}{0:+0;-0;0}dB}" HorizontalAlignment="Center" FontSize="10"/>
                                    <Slider Value="{Binding Eq16kHz}" Style="{StaticResource EqSliderStyle}"/>
                                    <TextBlock Text="16kHz" HorizontalAlignment="Center" FontSize="10" FontWeight="Bold"/>
                                </StackPanel>
                            </Grid>
                            
                            <!-- ReplayGain Settings (AP-014) -->
                            <GroupBox Grid.Row="2" Header="ðŸ”Š ReplayGain" Margin="0,20,0,0" Padding="10">
                                <StackPanel>
                                    <CheckBox Content="Enable ReplayGain normalization" IsChecked="{Binding ReplayGainEnabled}" Margin="0,0,0,10"/>
                                    <StackPanel Orientation="Horizontal" IsEnabled="{Binding ReplayGainEnabled}">
                                        <TextBlock Text="Mode: " VerticalAlignment="Center"/>
                                        <RadioButton Content="Track" IsChecked="{Binding ReplayGainModeIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=0}" Margin="10,0"/>
                                        <RadioButton Content="Album" IsChecked="{Binding ReplayGainModeIndex, Converter={StaticResource IntToBoolConverter}, ConverterParameter=1}" Margin="10,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </GroupBox>
                        </Grid>
                    </ScrollViewer>
                </TabItem>
                
                <!-- Lyrics Tab (AP-007) -->
                <TabItem Header="ðŸ“ Lyrics">
                    <Grid Margin="15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Text="Synchronized Lyrics" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15"/>
                        
                        <Border Grid.Row="1" Background="{DynamicResource SurfaceBrush}" CornerRadius="8" Padding="15"
                                Visibility="{Binding HasLyrics, Converter={StaticResource BoolToVis}}">
                            <ListBox ItemsSource="{Binding CurrentLyrics.Lines}" 
                                     SelectedIndex="{Binding CurrentLyricIndex}"
                                     ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                     Background="Transparent" BorderThickness="0">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding Text}" TextWrapping="Wrap" Padding="5,8"
                                                   FontSize="14" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </Border>
                        
                        <TextBlock Grid.Row="1" Text="No lyrics found. Place a .lrc file next to the audio file."
                                   Visibility="{Binding HasLyrics, Converter={StaticResource InverseBoolToVis}}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </Grid>
                </TabItem>
                
                <!-- File Info Tab (AP-010) -->
                <TabItem Header="â„¹ï¸ File Info">
                    <ScrollViewer Margin="15" VerticalScrollBarVisibility="Auto">
                        <TextBlock Text="{Binding FileInfoText}" FontFamily="Consolas" FontSize="12"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   TextWrapping="Wrap"/>
                    </ScrollViewer>
                </TabItem>
                
                <!-- Converter Tab (AP-015) -->
                <TabItem Header="ðŸ”„ Convert">
                    <Grid Margin="15">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Text="Audio Converter" FontSize="18" FontWeight="SemiBold" Margin="0,0,0,20"/>
                        
                        <TextBlock Grid.Row="1" Text="{Binding CurrentTrackTitle, StringFormat=Source: {0}}" Margin="0,0,0,15"/>
                        
                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,20">
                            <TextBlock Text="Output Format: " VerticalAlignment="Center"/>
                            <ComboBox ItemsSource="{Binding ConversionFormats}" SelectedItem="{Binding SelectedConversionFormat}"
                                      Width="180" Margin="10,0"/>
                        </StackPanel>
                        
                        <Button Grid.Row="3" Content="ðŸ”„ Convert Track" Command="{Binding ConvertTrackCommand}"
                                IsEnabled="{Binding HasCurrentTrack}" Padding="20,10" HorizontalAlignment="Left"/>
                        
                        <StackPanel Grid.Row="4" Visibility="{Binding IsConverting, Converter={StaticResource BoolToVis}}" Margin="0,20,0,0">
                            <ProgressBar Value="{Binding ConversionProgress}" Maximum="100" Height="20"/>
                            <TextBlock Text="{Binding ConversionProgress, StringFormat=Progress: {0}%}" Margin="0,5,0,0"/>
                        </StackPanel>
                    </Grid>
                </TabItem>
                
                <!-- Settings Tab (Auto DJ, Last.fm, etc.) -->
                <TabItem Header="âš™ï¸ Settings">
                    <ScrollViewer Margin="15" VerticalScrollBarVisibility="Auto">
                        <StackPanel>
                            <!-- Auto DJ (AP-012) -->
                            <GroupBox Header="ðŸŽ§ Auto DJ Mode" Padding="10" Margin="0,0,0,15">
                                <StackPanel>
                                    <CheckBox Content="Enable Auto DJ (automatically queue similar tracks)" 
                                              IsChecked="{Binding AutoDjEnabled}" Margin="0,0,0,10"/>
                                    <TextBlock Text="{Binding AutoDjStatusText}" 
                                               Foreground="{Binding AutoDjEnabled, Converter={StaticResource BoolToColorConverter}}"
                                               FontWeight="SemiBold"/>
                                </StackPanel>
                            </GroupBox>
                            
                            <!-- Last.fm Scrobbling (AP-013) -->
                            <GroupBox Header="ðŸ“Š Last.fm Scrobbling" Padding="10" Margin="0,0,0,15">
                                <StackPanel>
                                    <CheckBox Content="Enable scrobbling" IsChecked="{Binding ScrobblingEnabled}" Margin="0,0,0,10"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                        <TextBlock Text="Status: " VerticalAlignment="Center"/>
                                        <TextBlock Text="{Binding LastFmStatus}" FontWeight="SemiBold"
                                                   Foreground="{DynamicResource AccentBrush}"/>
                                    </StackPanel>
                                    <Button Content="Connect to Last.fm" Command="{Binding ConnectLastFmCommand}"
                                            HorizontalAlignment="Left" Padding="15,8"/>
                                </StackPanel>
                            </GroupBox>
                            
                            <!-- Gapless Playback Info (AP-011) -->
                            <GroupBox Header="ðŸ”„ Gapless Playback" Padding="10" Margin="0,0,0,15">
                                <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextSecondaryBrush}">
                                    Gapless playback is automatically enabled. The next track is preloaded 
                                    during playback for seamless transitions between songs.
                                </TextBlock>
                            </GroupBox>
                            
                            <!-- Media Keys Info (AP-003) -->
                            <GroupBox Header="âŒ¨ï¸ Media Keys" Padding="10">
                                <StackPanel>
                                    <TextBlock TextWrapping="Wrap" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,0,10">
                                        Hardware media keys are automatically supported:
                                    </TextBlock>
                                    <TextBlock Text="â€¢ Play/Pause - Media Play/Pause key" Margin="10,2"/>
                                    <TextBlock Text="â€¢ Next Track - Media Next key" Margin="10,2"/>
                                    <TextBlock Text="â€¢ Previous Track - Media Previous key" Margin="10,2"/>
                                    <TextBlock Text="â€¢ Stop - Media Stop key" Margin="10,2"/>
                                </StackPanel>
                            </GroupBox>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>
            </TabControl>
            </Grid>
        </Grid>
        
        <!-- Status Bar -->
        <Border Grid.Row="2" Background="{DynamicResource HeaderBrush}" Padding="15,8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" 
                           Foreground="{DynamicResource HeaderForegroundBrush}" VerticalAlignment="Center"/>
                
                <TextBlock Grid.Column="1" Text="{Binding Queue.Count, StringFormat=Queue: {0} tracks}" 
                           Foreground="{DynamicResource HeaderForegroundBrush}" VerticalAlignment="Center" Margin="20,0"/>
                
                <TextBlock Grid.Column="2" Text="{Binding AutoDjStatusText}"
                           Foreground="{DynamicResource AccentBrush}" FontWeight="SemiBold" VerticalAlignment="Center"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
