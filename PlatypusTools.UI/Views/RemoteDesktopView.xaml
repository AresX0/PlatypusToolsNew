<UserControl x:Class="PlatypusTools.UI.Views.RemoteDesktopView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:PlatypusTools.UI.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="700" d:DesignWidth="1200"
             Focusable="True"
             KeyDown="OnKeyDown"
             KeyUp="OnKeyUp">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <Style x:Key="ToolbarButton" TargetType="Button">
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="MinWidth" Value="70"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="4">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>   <!-- Connection bar -->
            <RowDefinition Height="Auto"/>   <!-- Toolbar -->
            <RowDefinition Height="*"/>      <!-- Remote desktop viewport -->
            <RowDefinition Height="Auto"/>   <!-- Status bar -->
        </Grid.RowDefinitions>

        <!-- â•â•â•â•â•â•â• Connection Bar â•â•â•â•â•â•â• -->
        <Border Grid.Row="0" Background="#FF2D2D30" CornerRadius="4" Padding="8" Margin="0,0,0,4">
            <WrapPanel VerticalAlignment="Center">
                <TextBlock Text="ðŸ–¥ï¸ Remote Desktop" FontWeight="Bold" FontSize="14" Foreground="White"
                           VerticalAlignment="Center" Margin="0,0,16,0"/>

                <TextBlock Text="Host:" Foreground="#CCCCCC" VerticalAlignment="Center" Margin="0,0,4,0"/>
                <TextBox x:Name="HostAddressBox" Text="{Binding HostAddress, UpdateSourceTrigger=PropertyChanged}"
                         Width="200" VerticalAlignment="Center" Margin="0,0,8,0"
                         ToolTip="IP address, hostname, or Tailscale address of the remote machine"/>

                <TextBlock Text="Port:" Foreground="#CCCCCC" VerticalAlignment="Center" Margin="0,0,4,0"/>
                <TextBox Text="{Binding HostPort, UpdateSourceTrigger=PropertyChanged}"
                         Width="60" VerticalAlignment="Center" Margin="0,0,8,0"/>

                <CheckBox Content="HTTPS" IsChecked="{Binding UseHttps}" Foreground="#CCCCCC"
                          VerticalAlignment="Center" Margin="0,0,12,0"/>

                <Button Content="{Binding ConnectButtonText}" Command="{Binding ConnectCommand}"
                        IsEnabled="{Binding CanConnect}"
                        MinWidth="100" Padding="8,4" Margin="2,0" VerticalAlignment="Center">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Padding" Value="8,4"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsConnected}" Value="True">
                                    <Setter Property="Background" Value="#FFF44336"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsConnected}" Value="False">
                                    <Setter Property="Background" Value="#FF4CAF50"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </WrapPanel>
        </Border>

        <!-- â•â•â•â•â•â•â• Toolbar â•â•â•â•â•â•â• -->
        <Border Grid.Row="1" Background="#FF3E3E42" CornerRadius="4" Padding="6" Margin="0,0,0,4"
                Visibility="{Binding IsConnected, Converter={StaticResource BoolToVis}}">
            <WrapPanel VerticalAlignment="Center">
                <!-- View Only Toggle -->
                <CheckBox Content="View Only" IsChecked="{Binding IsViewOnly}" Foreground="#CCCCCC"
                          VerticalAlignment="Center" Margin="0,0,12,0"
                          ToolTip="Disable mouse and keyboard input to the remote machine"/>

                <!-- Quality Slider -->
                <TextBlock Text="Quality:" Foreground="#CCCCCC" VerticalAlignment="Center" Margin="0,0,4,0"/>
                <Slider Value="{Binding JpegQuality}" Minimum="10" Maximum="100"
                        Width="120" VerticalAlignment="Center" Margin="0,0,4,0"
                        TickFrequency="10" IsSnapToTickEnabled="False"
                        ToolTip="JPEG quality (lower = faster, higher = sharper)"/>
                <TextBlock Text="{Binding JpegQuality, StringFormat={}{0}%}" Foreground="#CCCCCC"
                           VerticalAlignment="Center" Margin="0,0,12,0" Width="30"/>

                <!-- FPS Slider -->
                <TextBlock Text="FPS:" Foreground="#CCCCCC" VerticalAlignment="Center" Margin="0,0,4,0"/>
                <Slider Value="{Binding MaxFps}" Minimum="1" Maximum="30"
                        Width="100" VerticalAlignment="Center" Margin="0,0,4,0"
                        TickFrequency="5" IsSnapToTickEnabled="False"
                        ToolTip="Maximum frames per second"/>
                <TextBlock Text="{Binding MaxFps}" Foreground="#CCCCCC"
                           VerticalAlignment="Center" Margin="0,0,12,0" Width="20"/>

                <!-- Monitor Selection -->
                <TextBlock Text="Monitor:" Foreground="#CCCCCC" VerticalAlignment="Center" Margin="0,0,4,0"/>
                <ComboBox x:Name="MonitorCombo" Width="120" VerticalAlignment="Center" Margin="0,0,12,0"
                          SelectedIndex="0" SelectionChanged="MonitorCombo_SelectionChanged">
                    <ComboBoxItem Content="All Monitors" Tag="-1"/>
                </ComboBox>

                <!-- Special Keys -->
                <Button Content="Ctrl+Alt+Del" Command="{Binding SendCtrlAltDelCommand}"
                        Background="#FFFF9800" Foreground="White"
                        Style="{StaticResource ToolbarButton}" MinWidth="100"
                        ToolTip="Send Ctrl+Alt+Del to the remote machine"/>
            </WrapPanel>
        </Border>

        <!-- â•â•â•â•â•â•â• Remote Desktop Viewport â•â•â•â•â•â•â• -->
        <Border Grid.Row="2" Background="#FF1E1E1E" CornerRadius="4" ClipToBounds="True">
            <Grid>
                <!-- Placeholder when not connected -->
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center"
                            Visibility="{Binding IsConnected, Converter={StaticResource BoolToVis},
                                        ConverterParameter=Inverted}">
                    <TextBlock Text="ðŸ–¥ï¸" FontSize="64" HorizontalAlignment="Center" Margin="0,0,0,16"/>
                    <TextBlock Text="Remote Desktop" FontSize="24" Foreground="#888888"
                               HorizontalAlignment="Center" Margin="0,0,0,8"/>
                    <TextBlock Text="Enter the remote machine's address and click Connect"
                               FontSize="14" Foreground="#666666" HorizontalAlignment="Center"/>
                    <TextBlock Text="Both machines must be running PlatypusTools with Remote Server enabled"
                               FontSize="12" Foreground="#555555" HorizontalAlignment="Center" Margin="0,8,0,0"/>
                </StackPanel>

                <!-- Remote desktop image -->
                <Viewbox x:Name="DesktopViewbox" Stretch="Uniform"
                         Visibility="{Binding IsConnected, Converter={StaticResource BoolToVis}}">
                    <Image x:Name="DesktopImage" Source="{Binding FrameImage}"
                           RenderOptions.BitmapScalingMode="LowQuality"
                           MouseMove="DesktopImage_MouseMove"
                           MouseDown="DesktopImage_MouseDown"
                           MouseUp="DesktopImage_MouseUp"
                           MouseWheel="DesktopImage_MouseWheel"
                           Cursor="Cross"/>
                </Viewbox>
            </Grid>
        </Border>

        <!-- â•â•â•â•â•â•â• Status Bar â•â•â•â•â•â•â• -->
        <Border Grid.Row="3" Background="#FF007ACC" CornerRadius="4" Padding="6,4" Margin="0,4,0,0">
            <DockPanel>
                <TextBlock Text="{Binding StatusMessage}" Foreground="White" VerticalAlignment="Center"
                           DockPanel.Dock="Left"/>

                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal" HorizontalAlignment="Right">
                    <TextBlock Foreground="#DDDDDD" VerticalAlignment="Center" Margin="0,0,16,0"
                               Visibility="{Binding IsConnected, Converter={StaticResource BoolToVis}}">
                        <Run Text="{Binding RemoteScreenWidth, Mode=OneWay}"/>
                        <Run Text="Ã—"/>
                        <Run Text="{Binding RemoteScreenHeight, Mode=OneWay}"/>
                    </TextBlock>
                    <TextBlock Foreground="#DDDDDD" VerticalAlignment="Center" Margin="0,0,16,0"
                               Visibility="{Binding IsConnected, Converter={StaticResource BoolToVis}}">
                        <Run Text="{Binding Fps, Mode=OneWay}"/>
                        <Run Text="FPS"/>
                    </TextBlock>
                    <TextBlock Foreground="#DDDDDD" VerticalAlignment="Center" Margin="0,0,16,0"
                               Visibility="{Binding IsConnected, Converter={StaticResource BoolToVis}}">
                        <Run Text="{Binding FramesReceived, Mode=OneWay}"/>
                        <Run Text="frames"/>
                    </TextBlock>
                    <TextBlock Text="{Binding BytesReceivedDisplay}" Foreground="#DDDDDD"
                               VerticalAlignment="Center"
                               Visibility="{Binding IsConnected, Converter={StaticResource BoolToVis}}"/>
                </StackPanel>
            </DockPanel>
        </Border>
    </Grid>
</UserControl>
