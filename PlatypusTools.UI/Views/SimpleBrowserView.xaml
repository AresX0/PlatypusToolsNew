<UserControl x:Class="PlatypusTools.UI.Views.SimpleBrowserView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:wv2="clr-namespace:Microsoft.Web.WebView2.Wpf;assembly=Microsoft.Web.WebView2.Wpf"
             mc:Ignorable="d" d:DesignHeight="600" d:DesignWidth="1000">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Border Grid.Row="0" Background="{DynamicResource ControlBackgroundBrush}" 
                BorderBrush="{DynamicResource ControlBorderBrush}" BorderThickness="0,0,0,1" Padding="8">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Navigation Buttons -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button Content="â—€" Command="{Binding GoBackCommand}" Width="36" Height="28" 
                            FontSize="14" Padding="4,2" Margin="0,0,4,0" ToolTip="Back"/>
                    <Button Content="â–¶" Command="{Binding GoForwardCommand}" Width="36" Height="28" 
                            FontSize="14" Padding="4,2" Margin="0,0,4,0" ToolTip="Forward"/>
                    <Button Content="âŸ³" Command="{Binding RefreshCommand}" Width="36" Height="28" 
                            FontSize="14" Padding="4,2" Margin="0,0,4,0" ToolTip="Refresh"/>
                    <Button Content="âŒ‚" Command="{Binding GoHomeCommand}" Width="36" Height="28" 
                            FontSize="14" Padding="4,2" Margin="0,0,8,0" ToolTip="Home"/>
                </StackPanel>

                <!-- Address Bar -->
                <Grid Grid.Column="1" Margin="0,0,8,0">
                    <TextBox x:Name="AddressBar" Text="{Binding Url, UpdateSourceTrigger=PropertyChanged}" 
                             FontSize="13" Padding="8,6" VerticalContentAlignment="Center">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding NavigateCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>
                    <Button Content="â†’" HorizontalAlignment="Right" Width="30" Margin="2"
                            Command="{Binding NavigateCommand}" Background="Transparent" BorderThickness="0"/>
                </Grid>

                <!-- Action Buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Width="36" Height="28" FontSize="12" Padding="4,2" Margin="0,0,4,0" ToolTip="Add to Favorites"
                            Command="{Binding AddFavoriteCommand}"
                            Content="{Binding IsFavorite, Converter={StaticResource BoolToFavoriteIconConverter}}"/>
                    <ToggleButton Content="â˜…" Width="36" Height="28" FontSize="14" Padding="4,2" Margin="0,0,4,0" 
                                  ToolTip="Favorites" IsChecked="{Binding ShowFavoritesPanel}"/>
                    <ToggleButton Content="â˜°" Width="36" Height="28" FontSize="14" Padding="4,2" Margin="0,0,4,0" 
                                  ToolTip="History" IsChecked="{Binding ShowHistoryPanel}"/>
                    <Button Content="â†“" Width="36" Height="28" FontSize="14" Padding="4,2" Margin="0,0,4,0" 
                            ToolTip="Import from Edge" Command="{Binding ImportFromEdgeCommand}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- WebView2 Browser - Source set in code-behind after initialization -->
            <wv2:WebView2 x:Name="webView" Grid.Column="0"/>

            <!-- Side Panel (Favorites/History) -->
            <Border Grid.Column="1" Width="280" 
                    Background="{DynamicResource WindowBackgroundBrush}"
                    BorderBrush="{DynamicResource ControlBorderBrush}" BorderThickness="1,0,0,0"
                    Visibility="{Binding ShowFavoritesPanel, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="{DynamicResource ControlBackgroundBrush}" Padding="12,8">
                        <TextBlock Text="â­ Favorites" FontSize="14" FontWeight="SemiBold"/>
                    </Border>

                    <ListBox Grid.Row="1" ItemsSource="{Binding Favorites}" BorderThickness="0"
                             Background="Transparent">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="4,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0" Margin="4,2">
                                        <TextBlock Text="{Binding Title}" TextTrimming="CharacterEllipsis" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Url}" FontSize="10" Opacity="0.6" TextTrimming="CharacterEllipsis"/>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                                        <Button Content="â–¶" Width="24" Height="24" FontSize="10"
                                                Command="{Binding DataContext.NavigateToFavoriteCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" ToolTip="Open"/>
                                        <Button Content="ðŸ—‘" Width="24" Height="24" FontSize="10" Margin="4,0,0,0"
                                                Command="{Binding DataContext.RemoveFavoriteCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                CommandParameter="{Binding}" ToolTip="Remove"/>
                                    </StackPanel>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <StackPanel Grid.Row="2" Margin="8">
                        <Button Content="ðŸ“¤ Export Favorites" Command="{Binding ExportFavoritesCommand}" Margin="0,0,0,4"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- History Panel -->
            <Border Grid.Column="1" Width="280" 
                    Background="{DynamicResource WindowBackgroundBrush}"
                    BorderBrush="{DynamicResource ControlBorderBrush}" BorderThickness="1,0,0,0"
                    Visibility="{Binding ShowHistoryPanel, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <Border Grid.Row="0" Background="{DynamicResource ControlBackgroundBrush}" Padding="12,8">
                        <TextBlock Text="ðŸ“œ History" FontSize="14" FontWeight="SemiBold"/>
                    </Border>

                    <ListBox Grid.Row="1" ItemsSource="{Binding History}" BorderThickness="0"
                             Background="Transparent">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="4,2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0" Margin="4,2">
                                        <TextBlock Text="{Binding Title}" TextTrimming="CharacterEllipsis" FontWeight="SemiBold"/>
                                        <TextBlock Text="{Binding Visited, StringFormat='{}{0:g}'}" FontSize="10" Opacity="0.6"/>
                                    </StackPanel>
                                    <Button Grid.Column="1" Content="â–¶" Width="24" Height="24" FontSize="10"
                                            Command="{Binding DataContext.NavigateToHistoryCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}" ToolTip="Open"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>

                    <Button Grid.Row="2" Content="ðŸ—‘ Clear History" Command="{Binding ClearHistoryCommand}" Margin="8"/>
                </Grid>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="2" Background="{DynamicResource ControlBackgroundBrush}" 
                BorderBrush="{DynamicResource ControlBorderBrush}" BorderThickness="0,1,0,0" Padding="8,4">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <TextBlock Grid.Column="0" Text="{Binding StatusMessage}" VerticalAlignment="Center"/>
                <ProgressBar Grid.Column="1" Width="100" Height="4" IsIndeterminate="True"
                             Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}"/>
            </Grid>
        </Border>
    </Grid>
</UserControl>
