<UserControl x:Class="PlatypusTools.UI.Views.FileCleanerView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="clr-namespace:PlatypusTools.UI.ViewModels"
             xmlns:models="clr-namespace:PlatypusTools.Core.Models;assembly=PlatypusTools.Core"
             mc:Ignorable="d" d:DesignHeight="700" d:DesignWidth="1000">
    <TabControl>
        <!-- Pattern-Based Cleaner Tab -->
        <TabItem Header="Pattern Cleaner">
            <Grid Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,8">
                    <TextBlock VerticalAlignment="Center" Margin="0,0,8,0">Target directory:</TextBlock>
                    <TextBox Width="400" Text="{Binding TargetDir, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>
                <StackPanel Grid.Row="1" Margin="0,0,0,8">
                    <StackPanel Orientation="Horizontal" Margin="0,0,4,4">
                        <TextBlock VerticalAlignment="Center" Margin="0,0,8,0">Patterns (semicolon separated):</TextBlock>
                        <TextBox Width="200" Text="{Binding Patterns, UpdateSourceTrigger=PropertyChanged}" />
                        <CheckBox IsChecked="{Binding DryRun}" Content="Dry run" VerticalAlignment="Center" Margin="8,0,8,0" />
                        <Button Content="Scan" Command="{Binding ScanCommand}" Width="80" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                        <TextBlock VerticalAlignment="Center" Margin="0,0,8,0">Backup path:</TextBlock>
                        <TextBox Width="200" Text="{Binding BackupPath, UpdateSourceTrigger=PropertyChanged}" />
                        <Button Content="Preview Backup" Command="{Binding PreviewBackupCommand}" Width="100" Margin="8,0,0,0" />
                        <Button Content="Delete" Command="{Binding DeleteCommand}" Width="80" Margin="8,0,0,0" />
                    </StackPanel>
                </StackPanel>
                <Grid Grid.Row="2">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="2*" />
                        <RowDefinition Height="3*" />
                    </Grid.RowDefinitions>
                    <ListView Grid.Row="0" ItemsSource="{Binding Results}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Path" Width="800" DisplayMemberBinding="{Binding}" />
                            </GridView>
                        </ListView.View>
                    </ListView>
                    <GroupBox Header="Backup Preview" Grid.Row="1" Margin="0,8,0,0">
                        <DataGrid ItemsSource="{Binding BackupPreviews}" AutoGenerateColumns="False" IsReadOnly="True">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Original" Binding="{Binding Original}" Width="*" />
                                <DataGridTextColumn Header="Backup" Binding="{Binding Backup}" Width="2*" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </GroupBox>
                </Grid>
            </Grid>
        </TabItem>

        <!-- File Renamer Tab -->
        <TabItem Header="Batch Renamer" DataContext="{Binding FileRenamer}">
            <Grid Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Folder Selection -->
                <GroupBox Header="Folder Selection" Grid.Row="0" Margin="0,0,0,8">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <TextBlock VerticalAlignment="Center" Width="100">Folder Path:</TextBlock>
                            <TextBox Width="500" Text="{Binding FolderPath, UpdateSourceTrigger=PropertyChanged}" />
                            <Button Content="Browse..." Command="{Binding BrowseFolderCommand}" Width="90" Margin="8,0,0,0" />
                            <Button Content="Scan" Command="{Binding ScanCommand}" Width="90" Margin="8,0,0,0" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <CheckBox IsChecked="{Binding IncludeSubfolders}" Margin="100,0,16,0">Include Subfolders</CheckBox>
                            <TextBlock VerticalAlignment="Center" Margin="0,0,8,0">File Type:</TextBlock>
                            <ComboBox Width="120" SelectedItem="{Binding FileTypeFilter}">
                                <ComboBox.ItemsSource>
                                    <x:Array Type="models:FileTypeFilter">
                                        <models:FileTypeFilter>All</models:FileTypeFilter>
                                        <models:FileTypeFilter>Video</models:FileTypeFilter>
                                        <models:FileTypeFilter>Picture</models:FileTypeFilter>
                                        <models:FileTypeFilter>Document</models:FileTypeFilter>
                                        <models:FileTypeFilter>Audio</models:FileTypeFilter>
                                        <models:FileTypeFilter>Archive</models:FileTypeFilter>
                                    </x:Array>
                                </ComboBox.ItemsSource>
                            </ComboBox>
                        </StackPanel>
                    </StackPanel>
                </GroupBox>

                <!-- Renaming Options Tabs -->
                <TabControl Grid.Row="1" Height="180" Margin="0,0,0,8">
                    <!-- Prefix Tab -->
                    <TabItem Header="Prefix">
                        <Grid Margin="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center">New Prefix:</TextBlock>
                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding NewPrefix, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,4" />

                            <TextBlock Grid.Row="1" Grid.Column="0" VerticalAlignment="Center">Old Prefix:</TextBlock>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding OldPrefix, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,4" />

                            <CheckBox Grid.Row="2" Grid.Column="1" IsChecked="{Binding NormalizeCasing}" Margin="0,4,0,4">Normalize Casing</CheckBox>
                            <CheckBox Grid.Row="3" Grid.Column="1" IsChecked="{Binding OnlyFilesWithOldPrefix}">Only Files With Old Prefix</CheckBox>
                        </Grid>
                    </TabItem>

                    <!-- Episode Tab -->
                    <TabItem Header="Episode">
                        <Grid Margin="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center">Season #:</TextBlock>
                            <TextBox Grid.Row="0" Grid.Column="1" Text="{Binding SeasonNumber}" Width="80" HorizontalAlignment="Left" Margin="0,0,0,4" />

                            <TextBlock Grid.Row="1" Grid.Column="0" VerticalAlignment="Center">Start Episode:</TextBlock>
                            <TextBox Grid.Row="1" Grid.Column="1" Text="{Binding StartEpisodeNumber}" Width="80" HorizontalAlignment="Left" Margin="0,0,0,4" />

                            <CheckBox Grid.Row="2" Grid.Column="1" IsChecked="{Binding RenumberAlphabetically}" Margin="0,4,0,4">Renumber Alphabetically</CheckBox>
                            <CheckBox Grid.Row="3" Grid.Column="1" IsChecked="{Binding IncludeSeasonInFormat}">Format as S01E001</CheckBox>
                        </Grid>
                    </TabItem>

                    <!-- Cleaning Tab -->
                    <TabItem Header="Cleaning">
                        <Grid Margin="8">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <CheckBox Grid.Row="0" IsChecked="{Binding RemoveCommonTokens}" Margin="0,0,0,8">Remove Quality Tokens (720p, 1080p, 4k, HD)</CheckBox>
                            
                            <StackPanel Grid.Row="1">
                                <TextBlock Margin="0,0,0,4">Custom Tokens (comma-separated):</TextBlock>
                                <TextBox Text="{Binding CustomTokens, UpdateSourceTrigger=PropertyChanged}" TextWrapping="Wrap" AcceptsReturn="True" Height="60" />
                            </StackPanel>
                        </Grid>
                    </TabItem>

                    <!-- Normalization Tab -->
                    <TabItem Header="Normalize">
                        <Grid Margin="8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Grid.Column="0" VerticalAlignment="Center" Margin="0,0,0,8">Spaces:</TextBlock>
                            <ComboBox Grid.Row="0" Grid.Column="1" Width="200" HorizontalAlignment="Left" 
                                      SelectedItem="{Binding SpaceHandling}" Margin="0,0,0,8">
                                <ComboBox.ItemsSource>
                                    <x:Array Type="models:SpaceHandling">
                                        <models:SpaceHandling>KeepSpaces</models:SpaceHandling>
                                        <models:SpaceHandling>SpacesToDashes</models:SpaceHandling>
                                        <models:SpaceHandling>SpacesToUnderscores</models:SpaceHandling>
                                        <models:SpaceHandling>RemoveSpaces</models:SpaceHandling>
                                    </x:Array>
                                </ComboBox.ItemsSource>
                            </ComboBox>

                            <TextBlock Grid.Row="1" Grid.Column="0" VerticalAlignment="Center">Symbols:</TextBlock>
                            <ComboBox Grid.Row="1" Grid.Column="1" Width="200" HorizontalAlignment="Left" 
                                      SelectedItem="{Binding SymbolConversion}">
                                <ComboBox.ItemsSource>
                                    <x:Array Type="models:SymbolConversion">
                                        <models:SymbolConversion>None</models:SymbolConversion>
                                        <models:SymbolConversion>DashesToSpaces</models:SymbolConversion>
                                        <models:SymbolConversion>UnderscoresToSpaces</models:SymbolConversion>
                                        <models:SymbolConversion>DashesToUnderscores</models:SymbolConversion>
                                        <models:SymbolConversion>UnderscoresToDashes</models:SymbolConversion>
                                    </x:Array>
                                </ComboBox.ItemsSource>
                            </ComboBox>
                        </Grid>
                    </TabItem>
                </TabControl>

                <!-- Preview Grid -->
                <GroupBox Header="Preview" Grid.Row="2" Margin="0,0,0,8">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal" Grid.Row="0" Margin="0,0,0,4">
                            <Button Content="Select All" Command="{Binding SelectAllCommand}" Width="80" Margin="0,0,4,0" />
                            <Button Content="Select None" Command="{Binding SelectNoneCommand}" Width="80" Margin="0,0,8,0" />
                            <Button Content="Preview Changes" Command="{Binding PreviewChangesCommand}" Width="120" Margin="0,0,8,0" />
                            <Button Content="Apply Changes" Command="{Binding ApplyChangesCommand}" Width="120" Margin="0,0,8,0" />
                            <Button Content="Undo Last" Command="{Binding UndoLastChangesCommand}" Width="90" Margin="0,0,8,0" />
                            <Button Content="Reset" Command="{Binding ResetOptionsCommand}" Width="80" />
                        </StackPanel>

                        <DataGrid Grid.Row="1" ItemsSource="{Binding Operations}" AutoGenerateColumns="False" 
                                  CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="False">
                            <DataGrid.Columns>
                                <DataGridCheckBoxColumn Header="Select" Binding="{Binding IsSelected}" Width="60" />
                                <DataGridTextColumn Header="Original Name" Binding="{Binding OriginalFileName}" Width="*" IsReadOnly="True" />
                                <DataGridTextColumn Header="Proposed Name" Binding="{Binding ProposedFileName}" Width="*" IsReadOnly="True" />
                                <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="80" IsReadOnly="True" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </GroupBox>

                <!-- Status Bar -->
                <StatusBar Grid.Row="3">
                    <StatusBarItem>
                        <TextBlock Text="{Binding StatusMessage}" />
                    </StatusBarItem>
                    <StatusBarItem HorizontalAlignment="Right">
                        <ProgressBar Width="150" Height="16" IsIndeterminate="{Binding IsProcessing}" />
                    </StatusBarItem>
                </StatusBar>
            </Grid>
        </TabItem>
    </TabControl>
</UserControl>
