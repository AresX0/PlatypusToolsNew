<Window x:Class="PlatypusTools.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:PlatypusTools.UI.Views"
        xmlns:vm="clr-namespace:PlatypusTools.UI.ViewModels"
        xmlns:views="clr-namespace:PlatypusTools.UI.Views"
        xmlns:controls="clr-namespace:PlatypusTools.UI.Controls"
        xmlns:services="clr-namespace:PlatypusTools.UI.Services"
        Title="PlatypusTools" Height="700" Width="1200" Icon="Assets/platypus.png"
        Background="{DynamicResource WindowBackgroundBrush}"
        Foreground="{DynamicResource WindowForegroundBrush}">
    <Window.DataContext>
        <vm:MainWindowViewModel />
    </Window.DataContext>
    <DockPanel Background="{DynamicResource WindowBackgroundBrush}">
        <Menu DockPanel.Dock="Top" Background="{DynamicResource ControlBackgroundBrush}">
            <MenuItem Header="File">
                <MenuItem Header="Open Folder..." Command="{Binding BrowseCommand}" InputGestureText="Ctrl+O" />
                <Separator />
                <MenuItem Header="Save Workspace..." Command="{Binding SaveWorkspaceCommand}" InputGestureText="Ctrl+S" />
                <MenuItem Header="Export Config..." Command="{Binding ExportConfigCommand}" InputGestureText="Ctrl+Shift+E" />
                <MenuItem Header="Import Config..." Command="{Binding ImportConfigCommand}" InputGestureText="Ctrl+Shift+I" />
                <Separator />
                <MenuItem Header="Recent Workspaces" x:Name="RecentWorkspacesMenu">
                    <MenuItem Header="(No recent workspaces)" IsEnabled="False" x:Name="NoRecentPlaceholder"/>
                </MenuItem>
                <MenuItem Header="Open Recent..." Command="{Binding OpenRecentWorkspacesCommand}" InputGestureText="Ctrl+R" />
                <MenuItem Header="Clear Recent List" Click="ClearRecentList_Click" />
                <Separator />
                <MenuItem Header="Backup Settings..." Click="BackupSettings" />
                <MenuItem Header="Restore Settings..." Click="RestoreSettings" />
                <Separator />
                <MenuItem Header="Exit" Command="{Binding ExitCommand}" InputGestureText="Alt+F4" />
            </MenuItem>
            <MenuItem Header="View">
                <MenuItem Header="Fullscreen Mode" Click="ToggleFullScreen_Click" InputGestureText="F11" />
                <Separator />
                <MenuItem Header="Toggle Staging Panel" Command="{Binding ToggleStagingInDuplicatesCommand}" IsCheckable="True" IsChecked="{Binding Duplicates.StagingVisible, Mode=TwoWay}" />
                <MenuItem Header="Show Preview Panel" IsCheckable="True" IsChecked="{Binding Duplicates.PreviewVisible, Mode=TwoWay}" Command="{Binding TogglePreviewPanelCommand}" />
                <Separator />
                <MenuItem Header="Dark Theme" IsCheckable="True" IsChecked="{Binding IsDarkTheme, Mode=TwoWay}" Command="{Binding ToggleThemeCommand}" InputGestureText="Ctrl+Shift+D" />
            </MenuItem>
            <MenuItem Header="Tools">
                <MenuItem Header="Open Archived Scripts" Command="{Binding OpenArchivedScriptsCommand}" />
                <Separator />
                <MenuItem Header="Run Archived Script..." Command="{Binding RunArchivedScriptCommand}" />
                <MenuItem Header="Run Parity Tests..." Command="{Binding RunParityTestsCommand}" />
                <MenuItem Header="Credential Manager..." Command="{Binding OpenCredentialManagerCommand}" />
                <Separator />
                <MenuItem Header="Validate DataContext" Click="ValidateDataContext_Click" />
                <Separator />
                <MenuItem Header="Settings..." Click="OpenSettings" InputGestureText="Ctrl+," />
            </MenuItem>
            <MenuItem Header="Help">
                <MenuItem Header="View Help Documentation" Command="{Binding OpenHelpCommand}" InputGestureText="F1" />
                <Separator />
                <MenuItem Header="File Cleaner - How to Use" Click="ShowFileCleanerHelp" />
                <MenuItem Header="Video Converter - How to Use" Click="ShowVideoConverterHelp" />
                <MenuItem Header="Video Combiner - How to Use" Click="ShowVideoCombinerHelp" />
                <MenuItem Header="Duplicates Finder - How to Use" Click="ShowDuplicatesHelp" />
                <MenuItem Header="System Cleaner - How to Use" Click="ShowSystemCleanerHelp" />
                <MenuItem Header="Folder Hider - How to Use" Click="ShowFolderHiderHelp" />
                <MenuItem Header="Robocopy - How to Use" Click="ShowRobocopyHelp" />
                <Separator />
                <MenuItem Header="View Logs..." Click="OpenLogViewer" />
                <MenuItem Header="Check for Updates..." Click="CheckForUpdates" />
                <Separator />
                <MenuItem Header="About PlatypusTools" Click="ShowAbout" InputGestureText="Shift+F1" />
            </MenuItem>
        </Menu>

        <Border DockPanel.Dock="Top" Background="{DynamicResource HeaderBrush}" Padding="12,8">
            <Grid>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                    <Image Source="{Binding HeaderImage}" Width="48" Height="48" Margin="0,0,12,0" />
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock FontSize="24" FontWeight="Bold" Foreground="{DynamicResource HeaderForegroundBrush}">PlatypusTools</TextBlock>
                        <TextBlock FontSize="12" Foreground="{DynamicResource HeaderForegroundBrush}" Opacity="0.8">Advanced File Management &amp; Media Tools</TextBlock>
                    </StackPanel>
                </StackPanel>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Button Command="{Binding ToggleThemeCommand}" 
                            Width="100" Height="32" Margin="0,0,8,0"
                            BorderThickness="0" FontWeight="SemiBold">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="ðŸŒ“" FontSize="14" Margin="0,0,6,0"/>
                            <TextBlock Text="{Binding CurrentThemeName, FallbackValue='Theme'}"/>
                        </StackPanel>
                    </Button>
                    <Button Content="âš™ Settings" Click="OpenSettings" 
                            Width="90" Height="32"
                            BorderThickness="0" FontWeight="SemiBold"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Status Bar -->
        <controls:StatusBarControl DockPanel.Dock="Bottom"/>

        <TabControl DockPanel.Dock="Top" Margin="8" 
                    Background="{DynamicResource WindowBackgroundBrush}"
                    BorderBrush="{DynamicResource ControlBorderBrush}">
            <!-- File Management -->
            <TabItem Header="ðŸ“ File Management" 
                     Visibility="{Binding FileManagement, Source={x:Static services:TabVisibilityService.Instance}}">
                <TabControl>
                    <TabItem Header="File Cleaner" 
                             Visibility="{Binding FileCleaner, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:FileCleanerView}" ViewDataContext="{Binding FileCleaner}" />
                    </TabItem>
                    <TabItem Header="Duplicates"
                             Visibility="{Binding Duplicates, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:DuplicatesView}" ViewDataContext="{Binding Duplicates}" />
                    </TabItem>
                    <TabItem Header="Empty Folder Scanner"
                             Visibility="{Binding EmptyFolderScanner, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:EmptyFolderScannerView}" ViewDataContext="{Binding EmptyFolderScanner}" />
                    </TabItem>
                    <TabItem Header="Robocopy"
                             Visibility="{Binding Robocopy, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:RobocopyView}" ViewDataContext="{Binding Robocopy}" />
                    </TabItem>
                </TabControl>
            </TabItem>

            <!-- Multimedia (hierarchical layout) -->
            <TabItem Header="ðŸŽ¬ Multimedia"
                     Visibility="{Binding Multimedia, Source={x:Static services:TabVisibilityService.Instance}}">
                <TabControl>
                    <!-- Audio -->
                    <TabItem Header="ðŸŽµ Audio">
                        <TabControl>
                            <TabItem Header="Audio Player"
                                     Visibility="{Binding EnhancedAudioPlayer, Source={x:Static services:TabVisibilityService.Instance}}">
                                <controls:LazyTabContent ViewType="{x:Type views:EnhancedAudioPlayerView}" ViewDataContext="{Binding EnhancedAudioPlayer}" />
                            </TabItem>
                            <TabItem Header="Audio Trim"
                                     Visibility="{Binding AudioTrim, Source={x:Static services:TabVisibilityService.Instance}}">
                                <views:NativeAudioTrimView />
                            </TabItem>
                        </TabControl>
                    </TabItem>
                    
                    <!-- Image -->
                    <TabItem Header="ðŸ–¼ï¸ Image">
                        <TabControl>
                            <TabItem Header="Image Edit"
                                     Visibility="{Binding ImageEdit, Source={x:Static services:TabVisibilityService.Instance}}">
                                <views:NativeImageEditView />
                            </TabItem>
                            <TabItem Header="Image Converter"
                                     Visibility="{Binding ImageConverter, Source={x:Static services:TabVisibilityService.Instance}}">
                                <controls:LazyTabContent ViewType="{x:Type views:ImageConverterView}" ViewDataContext="{Binding ImageConverter}" />
                            </TabItem>
                            <TabItem Header="Image Resizer"
                                     Visibility="{Binding ImageResizer, Source={x:Static services:TabVisibilityService.Instance}}">
                                <controls:LazyTabContent ViewType="{x:Type views:ImageResizerView}" ViewDataContext="{Binding ImageResizer}" />
                            </TabItem>
                            <TabItem Header="ICO Converter"
                                     Visibility="{Binding IconConverter, Source={x:Static services:TabVisibilityService.Instance}}">
                                <controls:LazyTabContent ViewType="{x:Type views:IconConverterView}" ViewDataContext="{Binding IconConverter}" />
                            </TabItem>
                            <TabItem Header="Batch Watermark"
                                     Visibility="{Binding BatchWatermark, Source={x:Static services:TabVisibilityService.Instance}}">
                                <controls:LazyTabContent ViewType="{x:Type views:BatchWatermarkView}" ViewDataContext="{Binding BatchWatermark}" />
                            </TabItem>
                            <TabItem Header="Image Scaler"
                                     Visibility="{Binding ImageScaler, Source={x:Static services:TabVisibilityService.Instance}}">
                                <controls:LazyTabContent ViewType="{x:Type views:BatchUpscaleView}" ViewDataContext="{Binding BatchUpscale}" />
                            </TabItem>
                            <TabItem Header="3D Model Editor"
                                     Visibility="{Binding Model3DEditor, Source={x:Static services:TabVisibilityService.Instance}}">
                                <views:Model3DEditorView />
                            </TabItem>
                        </TabControl>
                    </TabItem>
                    
                    <!-- Video -->
                    <TabItem Header="ðŸŽ¬ Video">
                        <TabControl>
                            <TabItem Header="Video Player"
                                     Visibility="{Binding VideoPlayer, Source={x:Static services:TabVisibilityService.Instance}}">
                                <views:NativeVideoPlayerView />
                            </TabItem>
                            <TabItem Header="Video Editor"
                                     Visibility="{Binding VideoEditor, Source={x:Static services:TabVisibilityService.Instance}}">
                                <views:ShotcutNativeEditorView />
                            </TabItem>
                            <TabItem Header="Upscaler"
                                     Visibility="{Binding Upscaler, Source={x:Static services:TabVisibilityService.Instance}}">
                                <controls:LazyTabContent ViewType="{x:Type views:UpscalerView}" ViewDataContext="{Binding Upscaler}" />
                            </TabItem>
                            <TabItem Header="Video Combiner"
                                     Visibility="{Binding VideoCombiner, Source={x:Static services:TabVisibilityService.Instance}}">
                                <controls:LazyTabContent ViewType="{x:Type views:VideoCombinerView}" ViewDataContext="{Binding VideoCombiner}" />
                            </TabItem>
                            <TabItem Header="Video Converter"
                                     Visibility="{Binding VideoConverter, Source={x:Static services:TabVisibilityService.Instance}}">
                                <controls:LazyTabContent ViewType="{x:Type views:VideoConverterView}" ViewDataContext="{Binding VideoConverter}" />
                            </TabItem>
                        </TabControl>
                    </TabItem>
                    
                    <!-- Media Library -->
                    <TabItem Header="ðŸ“š Media Library"
                             Visibility="{Binding MediaLibrary, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:MediaLibraryView}" ViewDataContext="{Binding MediaLibrary}" />
                    </TabItem>
                    
                    <!-- External Tools (VLC, Audacity, GIMP) -->
                    <TabItem Header="ðŸ”§ External Tools"
                             Visibility="{Binding ExternalTools, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:MultimediaEditorView}" ViewDataContext="{Binding MultimediaEditor}" />
                    </TabItem>
                </TabControl>
            </TabItem>

            <!-- System -->
            <TabItem Header="ðŸ–¥ï¸ System"
                     Visibility="{Binding System, Source={x:Static services:TabVisibilityService.Instance}}">
                <TabControl>
                    <TabItem Header="Disk Cleanup"
                             Visibility="{Binding DiskCleanup, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:DiskCleanupView}" ViewDataContext="{Binding DiskCleanup}" />
                    </TabItem>
                    <TabItem Header="Privacy Cleaner"
                             Visibility="{Binding PrivacyCleaner, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:PrivacyCleanerView}" ViewDataContext="{Binding PrivacyCleaner}" />
                    </TabItem>
                    <TabItem Header="Recent Cleaner"
                             Visibility="{Binding RecentCleaner, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:RecentCleanupView}" ViewDataContext="{Binding Recent}" />
                    </TabItem>
                    <TabItem Header="Startup Manager"
                             Visibility="{Binding StartupManager, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:StartupManagerView}" ViewDataContext="{Binding StartupManager}" />
                    </TabItem>
                    <TabItem Header="Process Manager"
                             Visibility="{Binding ProcessManager, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:ProcessManagerView}" ViewDataContext="{Binding ProcessManager}" />
                    </TabItem>
                    <TabItem Header="Registry Cleaner"
                             Visibility="{Binding RegistryCleaner, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:RegistryCleanerView}" ViewDataContext="{Binding RegistryCleaner}" />
                    </TabItem>
                    <TabItem Header="Scheduled Tasks"
                             Visibility="{Binding ScheduledTasks, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:ScheduledTasksView}" ViewDataContext="{Binding ScheduledTasks}" />
                    </TabItem>
                    <TabItem Header="System Restore"
                             Visibility="{Binding SystemRestore, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:SystemRestoreView}" ViewDataContext="{Binding SystemRestore}" />
                    </TabItem>
                </TabControl>
            </TabItem>

            <!-- Security -->
            <TabItem Header="ðŸ”’ Security"
                     Visibility="{Binding Security, Source={x:Static services:TabVisibilityService.Instance}}">
                <TabControl>
                    <TabItem Header="Folder Hider"
                             Visibility="{Binding FolderHider, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:HiderView}" ViewDataContext="{Binding Hider}" />
                    </TabItem>
                    <TabItem Header="System Audit"
                             Visibility="{Binding SystemAudit, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:SystemAuditView}" ViewDataContext="{Binding SystemAudit}" />
                    </TabItem>
                    <TabItem Header="Forensics Analyzer"
                             Visibility="{Binding ForensicsAnalyzer, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:ForensicsAnalyzerView}" ViewDataContext="{Binding ForensicsAnalyzer}" />
                    </TabItem>
                    <TabItem Header="ðŸ”¥ Secure Wipe"
                             Visibility="{Binding SecureWipe, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:SecureWipeView}" ViewDataContext="{Binding SecureWipe}" />
                    </TabItem>
                    <TabItem Header="ðŸ”¬ Advanced Forensics"
                             Visibility="{Binding AdvancedForensics, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:AdvancedForensicsView}" ViewDataContext="{Binding AdvancedForensics}" />
                    </TabItem>
                </TabControl>
            </TabItem>

            <!-- Metadata -->
            <TabItem Header="ðŸ“‹ Metadata"
                     Visibility="{Binding Metadata, Source={x:Static services:TabVisibilityService.Instance}}">
                <controls:LazyTabContent ViewType="{x:Type views:MetadataEditorView}" ViewDataContext="{Binding MetadataEditor}" />
            </TabItem>

            <!-- Tools -->
            <TabItem Header="ðŸ”§ Tools"
                     Visibility="{Binding Tools, Source={x:Static services:TabVisibilityService.Instance}}">
                <TabControl>
                    <TabItem Header="Website Downloader"
                             Visibility="{Binding WebsiteDownloader, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:WebsiteDownloaderView}" ViewDataContext="{Binding WebsiteDownloader}" />
                    </TabItem>
                    <TabItem Header="File Analyzer"
                             Visibility="{Binding FileAnalyzer, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:FileAnalyzerView}" ViewDataContext="{Binding FileAnalyzer}" />
                    </TabItem>
                    <TabItem Header="Disk Space Analyzer"
                             Visibility="{Binding DiskSpaceAnalyzer, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:DiskSpaceAnalyzerView}" ViewDataContext="{Binding DiskSpaceAnalyzer}" />
                    </TabItem>
                    <TabItem Header="Network Tools"
                             Visibility="{Binding NetworkTools, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:NetworkToolsView}" ViewDataContext="{Binding NetworkTools}" />
                    </TabItem>
                    <TabItem Header="Archive Manager"
                             Visibility="{Binding ArchiveManager, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:ArchiveManagerView}" ViewDataContext="{Binding ArchiveManager}" />
                    </TabItem>
                    <TabItem Header="PDF Tools"
                             Visibility="{Binding PdfTools, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:PdfToolsView}" ViewDataContext="{Binding PdfTools}" />
                    </TabItem>
                    <TabItem Header="Screenshot"
                             Visibility="{Binding Screenshot, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:ScreenshotView}" ViewDataContext="{Binding Screenshot}" />
                    </TabItem>
                    <TabItem Header="Bootable USB Creator"
                             Visibility="{Binding BootableUSB, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:BootableUSBView}" ViewDataContext="{Binding BootableUSB}" />
                    </TabItem>
                    <TabItem Header="Plugin Manager"
                             Visibility="{Binding PluginManager, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:PluginManagerView}" ViewDataContext="{Binding PluginManager}" />
                    </TabItem>
                    <TabItem Header="FTP/SFTP Client"
                             Visibility="{Binding FtpClient, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:FtpClientView}" ViewDataContext="{Binding FtpClient}" />
                    </TabItem>
                    <TabItem Header="Terminal (SSH/Telnet)"
                             Visibility="{Binding TerminalClient, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:TerminalClientView}" ViewDataContext="{Binding TerminalClient}" />
                    </TabItem>
                    <TabItem Header="Web Browser"
                             Visibility="{Binding SimpleBrowser, Source={x:Static services:TabVisibilityService.Instance}}">
                        <controls:LazyTabContent ViewType="{x:Type views:SimpleBrowserView}" ViewDataContext="{Binding SimpleBrowser}" />
                    </TabItem>
                </TabControl>
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>




